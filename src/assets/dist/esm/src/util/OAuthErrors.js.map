{"version":3,"file":"OAuthErrors.js","sources":["../../../../src/util/OAuthErrors.ts"],"sourcesContent":["import { loc } from 'okta';\n\nimport { AuthSdkError, OAuthError as SdkOAuthError} from '@okta/okta-auth-js';\nimport { OAuthError } from './Errors';\nimport { ErrorDetails } from 'types/errors';\n\ntype ErrorTraits = 'inline' | 'terminal';\n\ntype ErrorType = {\n  [key in ErrorTraits]?: boolean;\n};\n\nclass InlineErrorType implements ErrorType {\n  inline = true;\n}\n\nclass TerminalErrorType implements ErrorType {\n  terminal = true;\n}\n\nclass TypedOAuthError<T extends ErrorType> extends OAuthError {\n  errorType: T;\n  orginalError: AuthSdkError | SdkOAuthError;\n  errorDetails: ErrorDetails\n\n  constructor(originalError, errorTypeCtor: new () => T) {\n    super(originalError.message);\n    this.errorType = new errorTypeCtor();\n    this.orginalError = originalError;\n\n    this.errorDetails = {\n      errorSummary: this.getErrorSummary(),\n      errorCode: originalError.errorCode,\n      errorCauses: originalError.errorCauses,\n    }\n  }\n\n  protected getErrorSummary() {\n    return this.orginalError.errorSummary;\n  }\n\n  public is(errorTrait: ErrorTraits) {\n    return Boolean(Object.getOwnPropertyDescriptor(this.errorType, errorTrait as PropertyKey)?.value);\n  }\n}\n\nclass RecoverableError<T extends ErrorType> extends TypedOAuthError<T> {\n  \n}\n\nclass NonRecoverableError<T extends ErrorType> extends TypedOAuthError<T> {\n  \n}\n\nclass ClockDriftError extends RecoverableError<TerminalErrorType> {\n  constructor(error) {\n    super(error, TerminalErrorType);\n  }\n\n  getErrorSummary(): string {\n    return loc('error.unsynced.clock', 'login');\n  }\n}\n\nclass UserNotAssignedError extends RecoverableError<InlineErrorType> {\n  constructor(error) {\n    super(error, InlineErrorType);\n  }\n}\n\nclass JITProfileProvisioningError extends RecoverableError<InlineErrorType> {\n  constructor(error) {\n    super(error, InlineErrorType);\n  }\n  getErrorSummary(): string {\n    return loc('error.jit_failure', 'login');\n  }\n}\n\nclass MfaRequiredError extends NonRecoverableError<InlineErrorType> {\n  constructor(error) {\n    super(error, InlineErrorType);\n  }\n\n  getErrorSummary(): string {\n    return loc('error.mfa.required', 'login');\n  }\n}\n\nfunction getTypedOAuthError(error: AuthSdkError | SdkOAuthError) {\n  switch(error.errorCode) {\n    case 'access_denied':\n      return new UserNotAssignedError(error);\n\n    case 'jit_failure_missing_fields':\n    case 'jit_failure_invalid_login_format':\n    case 'jit_failure_values_not_match_pattern':\n    case 'jit_failure_values_too_long':\n    case 'jit_failure_invalid_locale':\n      return new JITProfileProvisioningError(error);\n\n    case 'login_required':\n      const mfaRequiredMsg = 'The client specified not to prompt, but the client app requires re-authentication or MFA.';\n      if (error.message === mfaRequiredMsg) {\n        return new MfaRequiredError(error);\n      }\n\n    case 'INTERNAL':\n      const clockDriftMsg = 'The JWT was issued in the future';\n      if (error.message === clockDriftMsg) {\n        return new ClockDriftError(error);\n      }\n\n    default:\n      return new RecoverableError(error, Object);\n  }\n}\n\nexport {\n  RecoverableError,\n  NonRecoverableError,\n  JITProfileProvisioningError,\n  ClockDriftError,\n  UserNotAssignedError,\n  MfaRequiredError,\n  TypedOAuthError,\n  getTypedOAuthError\n}\n"],"names":["InlineErrorType","inline","TerminalErrorType","terminal","TypedOAuthError","OAuthError","constructor","originalError","errorTypeCtor","message","errorType","orginalError","errorDetails","errorSummary","getErrorSummary","errorCode","errorCauses","is","errorTrait","Boolean","Object","getOwnPropertyDescriptor","value","RecoverableError","NonRecoverableError","ClockDriftError","error","loc","UserNotAssignedError","JITProfileProvisioningError","MfaRequiredError","getTypedOAuthError","mfaRequiredMsg","clockDriftMsg"],"mappings":"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"}
{"version":3,"file":"webauthn.js","sources":["../../../../src/util/webauthn.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport Q from 'q';\nimport FidoUtil from 'util/FidoUtil';\n\nfunction adaptToOkta(promise) {\n  return new Q(promise);\n}\n\nfunction makeCredential(accountInfo, cryptoParams, challenge) {\n  cryptoParams = cryptoParams.map(function(param) {\n    return { type: 'FIDO_2_0', algorithm: param.algorithm };\n  });\n\n  const promise = window.msCredentials.makeCredential(accountInfo, cryptoParams, challenge).then(function(cred) {\n    return Object.freeze({\n      credential: { id: cred.id },\n      publicKey: JSON.parse(cred.publicKey),\n      attestation: cred.attestation,\n    });\n  });\n\n  return adaptToOkta(promise);\n}\n\nfunction getAssertion(challenge, allowList) {\n  const accept = allowList.map(function(item) {\n    return { type: 'FIDO_2_0', id: item.id };\n  });\n  const filters = { accept: accept };\n  const promise = window.msCredentials.getAssertion(challenge, filters).then(function(attestation) {\n    const signature = attestation.signature;\n\n    return Object.freeze({\n      credential: { id: attestation.id },\n      clientData: signature.clientData,\n      authenticatorData: signature.authnrData,\n      signature: signature.signature,\n    });\n  });\n\n  return adaptToOkta(promise);\n}\n\nexport default {\n  makeCredential: makeCredential,\n  getAssertion: getAssertion,\n  isAvailable: function() {\n    return Object.prototype.hasOwnProperty.call(window, 'msCredentials');\n  },\n  isNewApiAvailable: function() {\n    // navigator.credentials is not supported in IE11\n    // eslint-disable-next-line compat/compat\n    return navigator && navigator.credentials && navigator.credentials.create;\n  },\n  isWebauthnOrU2fAvailable: function() {\n    return this.isNewApiAvailable() || FidoUtil.isU2fAvailable();\n  },\n};\n"],"names":["adaptToOkta","promise","Q","makeCredential","accountInfo","cryptoParams","challenge","map","param","type","algorithm","window","msCredentials","then","cred","Object","freeze","credential","id","publicKey","JSON","parse","attestation","getAssertion","allowList","accept","item","filters","signature","clientData","authenticatorData","authnrData","isAvailable","prototype","hasOwnProperty","call","isNewApiAvailable","navigator","credentials","create","isWebauthnOrU2fAvailable","FidoUtil","isU2fAvailable"],"mappings":"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"}
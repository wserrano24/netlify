{"version":3,"file":"ChallengePushView.js","sources":["../../../../../../../src/v2/view-builder/views/shared/ChallengePushView.js"],"sourcesContent":["// Common view for OV push and custom push.\nimport { loc, createButton, View } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport { BaseFormWithPolling } from '../../internals';\nimport polling from '../shared/polling';\nimport { WARNING_TIMEOUT } from '../../utils/Constants';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport { AUTHENTICATOR_KEY } from '../../../ion/RemediationConstants';\n\nconst warningTemplate = View.extend({\n  className: 'okta-form-infobox-warning infobox infobox-warning',\n  template: hbs`\n    <span class=\"icon warning-16\"></span>\n    <p>{{warning}}</p>\n  `\n});\nconst Body = BaseFormWithPolling.extend(Object.assign(\n  {\n    noButtonBar: true,\n\n    title() {\n      return this.isOV() ? loc('oie.okta_verify.push.title', 'login') :\n        loc('oie.verify.custom_app.title', 'login', [this.options.appState.getAuthenticatorDisplayName()]);\n    },\n\n    initialize() {\n      BaseFormWithPolling.prototype.initialize.apply(this, arguments);\n      // 'hasSavingState' would be true by default.\n      // Setting it to false when auth key is okta_verify or custom_app with autochallenge schema\n      // So that 'o-form-saving' css class is not added while polling and checkbox remains enabled.\n      if ((this.isOV() || this.isCustomApp()) && this.isAutoChallengeSupported()) {\n        this.hasSavingState = false;\n      }\n      this.listenTo(this.model, 'error', this.stopPoll);\n      this.addView();\n    },\n\n    addView() {\n      this.add(createButton({\n        className: 'button button-wide button-primary send-push link-button-disabled',\n        title: this.isOV() ? loc('oie.okta_verify.push.sent', 'login') : loc('oie.custom_app.push.sent', 'login'),\n        click: (e) => {\n          e.preventDefault();\n        }\n      }));\n      this.add(\n        `<span class='accessibility-text' role='alert'>\n        ${this.isOV() ? loc('oie.okta_verify.push.sent', 'login') : loc('oie.custom_app.push.sent', 'login')}</span>`,\n      );\n    },\n\n    render() {\n      BaseFormWithPolling.prototype.render.apply(this, arguments);\n\n      const checkbox = this.$el.find('[data-se=\"o-form-fieldset-autoChallenge\"]');\n\n      if (!this.isAutoChallengeSupported()) {\n        checkbox.length && checkbox.hide();\n      } else if (this.isOV() || this.isCustomApp()) {\n        // Move checkbox below the button\n        // Checkbox is rendered by BaseForm using remediation response and\n        // hence by default always gets added above buttons.\n        checkbox.length && this.$el.find('.o-form-fieldset-container').append(checkbox);\n      }\n    },\n\n    postRender() {\n      BaseFormWithPolling.prototype.postRender.apply(this, arguments);\n\n      const className = this.isOV() ?\n        'okta-verify-push-challenge' : ' custom-app-push-challenge';\n      this.$el.addClass(className);\n      this.startPoll();\n    },\n\n    startPoll() {\n      this.startPolling();\n      this.warningTimeout = setTimeout(() => {\n        const warningText = this.isOV() ? loc('oktaverify.warning', 'login') :\n          loc('oie.custom_app.push.warning', 'login', [this.options.appState.getAuthenticatorDisplayName()]);\n        this.showWarning(warningText);\n      }, WARNING_TIMEOUT);\n    },\n\n    stopPoll() {\n      this.stopPolling();\n      this.clearWarning();\n    },\n\n    showWarning(msg) {\n      this.clearWarning();\n      this.add(warningTemplate, '.o-form-error-container', {options: {warning: msg}});\n    },\n\n    clearWarning() {\n      if (this.$('.o-form-error-container div').hasClass('okta-form-infobox-warning')) {\n        this.$('.okta-form-infobox-warning').remove();\n      }\n      clearTimeout(this.warningTimeout);\n    },\n\n    remove() {\n      BaseFormWithPolling.prototype.remove.apply(this, arguments);\n      this.stopPolling();\n    },\n\n    isOV() {\n      return this.options.appState.get('authenticatorKey') === AUTHENTICATOR_KEY.OV;\n    },\n\n    isCustomApp() {\n      return this.options.appState.get('authenticatorKey') === AUTHENTICATOR_KEY.CUSTOM_APP;\n    },\n\n    isAutoChallengeSupported() {\n      return (this.options.appState.getSchemaByName('autoChallenge') !== null &&\n        this.options.appState.getSchemaByName('autoChallenge') !== undefined);\n    }\n  },\n\n  polling,\n));\n\nconst AuthenticatorView = BaseAuthenticatorView.extend({\n  Body,\n});\n\nexport {\n  AuthenticatorView as default,\n  Body,\n};\n"],"names":["warningTemplate","View","extend","className","template","Body","BaseFormWithPolling","Object","assign","noButtonBar","title","isOV","loc","options","appState","getAuthenticatorDisplayName","initialize","prototype","apply","arguments","isCustomApp","isAutoChallengeSupported","hasSavingState","listenTo","model","stopPoll","addView","add","createButton","click","e","preventDefault","render","checkbox","$el","find","length","hide","append","postRender","addClass","startPoll","startPolling","warningTimeout","setTimeout","warningText","showWarning","WARNING_TIMEOUT","stopPolling","clearWarning","msg","warning","$","hasClass","remove","clearTimeout","get","AUTHENTICATOR_KEY","OV","CUSTOM_APP","getSchemaByName","undefined","polling","AuthenticatorView","BaseAuthenticatorView"],"mappings":"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"}
{"version":3,"file":"polling.js","sources":["../../../../../../../src/v2/view-builder/views/shared/polling.js"],"sourcesContent":["import { _ } from 'okta';\nimport { MS_PER_SEC } from '../../utils/Constants';\n\nexport default {\n  startPolling(newRefreshInterval) {\n    this.fixedPollingInterval = this.options.currentViewState.refresh;\n    this.dynamicPollingInterval = newRefreshInterval;\n    this.countDownCounterValue = Math.ceil(this.pollingInterval / MS_PER_SEC);\n    // Poll is present in remediation form\n    if (this.fixedPollingInterval) {\n      this._startRemediationPolling();\n    } else {\n      // Poll is present in authenticator/ authenticator Enrollment obj.\n      // Authenticator won't co-exists hence it's safe to trigger both.\n      this._startAuthenticatorPolling();\n    }\n  },\n\n  _startAuthenticatorPolling() {\n    // Authenticator won't co-exists hence it's safe to trigger both.\n    [\n      'currentAuthenticator',\n      'currentAuthenticatorEnrollment',\n    ].some(responseKey => {\n      if (this.options.appState.has(responseKey)) {\n        const authenticator = this.options.appState.get(responseKey);\n        const authenticatorPollAction = `${responseKey}-poll`;\n        const pollInterval = this.dynamicPollingInterval || authenticator?.poll?.refresh;\n        if (_.isNumber(pollInterval)) {\n          this.polling = setTimeout(()=>{\n            this.options.appState.trigger('invokeAction', authenticatorPollAction);\n          }, pollInterval);\n        }\n        return true;\n      } else {\n        return false;\n      }\n    });\n  },\n\n  _startRemediationPolling() {\n    const pollInterval = this.dynamicPollingInterval || this.fixedPollingInterval;\n    if (_.isNumber(pollInterval)) {\n      this.polling = setTimeout(() => {\n        this.options.appState.trigger('saveForm', this.model);\n      }, pollInterval);\n    }\n  },\n\n  stopPolling() {\n    if (this.polling) {\n      clearTimeout(this.polling);\n      this.polling = null;\n    }\n  }\n};\n"],"names":["startPolling","newRefreshInterval","fixedPollingInterval","options","currentViewState","refresh","dynamicPollingInterval","countDownCounterValue","Math","ceil","pollingInterval","MS_PER_SEC","_startRemediationPolling","_startAuthenticatorPolling","some","responseKey","appState","has","authenticator","get","authenticatorPollAction","pollInterval","poll","_","isNumber","polling","setTimeout","trigger","model","stopPolling","clearTimeout"],"mappings":";;;;;;;;;;;;;;;;;;AAGA,cAAe;AACbA,EAAAA,YADa,EACAC,UAAAA,kBADA,EACoB;AAC/B,IAAA,IAAA,CAAKC,oBAAL,GAA4B,IAAA,CAAKC,OAAL,CAAaC,gBAAb,CAA8BC,OAA1D,CAAA;AACA,IAAKC,IAAAA,CAAAA,sBAAL,GAA8BL,kBAA9B,CAAA;AACA,IAAA,IAAA,CAAKM,qBAAL,GAA6BC,IAAI,CAACC,IAAL,CAAU,IAAKC,CAAAA,eAAL,GAAuBC,UAAjC,CAA7B,CAH+B;;AAK/B,IAAI,IAAA,IAAA,CAAKT,oBAAT,EAA+B;AAC7B,MAAA,IAAA,CAAKU,wBAAL,EAAA,CAAA;AACD,KAFD,MAEO;AACL;AACA;AACA,MAAA,IAAA,CAAKC,0BAAL,EAAA,CAAA;AACD,KAAA;AACF,GAbY;AAebA,EAAAA,0BAfa,EAegB,YAAA;AAC3B;AACA,IAAA,CACE,sBADF,EAEE,gCAFF,EAGEC,IAHF,CAGOC,WAAW,IAAI;AACpB,MAAI,IAAA,IAAA,CAAKZ,OAAL,CAAaa,QAAb,CAAsBC,GAAtB,CAA0BF,WAA1B,CAAJ,EAA4C;AAAA,QAAA,IAAA,mBAAA,CAAA;;AAC1C,QAAMG,MAAAA,aAAa,GAAG,IAAA,CAAKf,OAAL,CAAaa,QAAb,CAAsBG,GAAtB,CAA0BJ,WAA1B,CAAtB,CAAA;AACA,QAAA,MAAMK,uBAAuB,GAAI,CAAEL,EAAAA,WAAY,CAA/C,KAAA,CAAA,CAAA;AACA,QAAA,MAAMM,YAAY,GAAG,IAAKf,CAAAA,sBAAL,KAA+BY,aAA/B,KAAA,IAAA,IAA+BA,aAA/B,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAA,mBAAA,GAA+BA,aAAa,CAAEI,IAA9C,MAA+B,IAAA,IAAA,mBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,mBAAA,CAAqBjB,OAApD,CAArB,CAAA;;AACA,QAAA,IAAIkB,cAAC,CAACC,QAAF,CAAWH,YAAX,CAAJ,EAA8B;AAC5B,UAAA,IAAA,CAAKI,OAAL,GAAeC,UAAU,CAAC,MAAI;AAC5B,YAAKvB,IAAAA,CAAAA,OAAL,CAAaa,QAAb,CAAsBW,OAAtB,CAA8B,cAA9B,EAA8CP,uBAA9C,CAAA,CAAA;AACD,WAFwB,EAEtBC,YAFsB,CAAzB,CAAA;AAGD,SAAA;;AACD,QAAA,OAAO,IAAP,CAAA;AACD,OAVD,MAUO;AACL,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;AACF,KAjBD,CAAA,CAAA;AAkBD,GAnCY;AAqCbT,EAAAA,wBArCa,EAqCc,YAAA;AACzB,IAAA,MAAMS,YAAY,GAAG,IAAA,CAAKf,sBAAL,IAA+B,KAAKJ,oBAAzD,CAAA;;AACA,IAAA,IAAIqB,cAAC,CAACC,QAAF,CAAWH,YAAX,CAAJ,EAA8B;AAC5B,MAAA,IAAA,CAAKI,OAAL,GAAeC,UAAU,CAAC,MAAM;AAC9B,QAAKvB,IAAAA,CAAAA,OAAL,CAAaa,QAAb,CAAsBW,OAAtB,CAA8B,UAA9B,EAA0C,IAAA,CAAKC,KAA/C,CAAA,CAAA;AACD,OAFwB,EAEtBP,YAFsB,CAAzB,CAAA;AAGD,KAAA;AACF,GA5CY;AA8CbQ,EAAAA,WA9Ca,EA8CC,YAAA;AACZ,IAAI,IAAA,IAAA,CAAKJ,OAAT,EAAkB;AAChBK,MAAAA,YAAY,CAAC,IAAKL,CAAAA,OAAN,CAAZ,CAAA;AACA,MAAKA,IAAAA,CAAAA,OAAL,GAAe,IAAf,CAAA;AACD,KAAA;AACF,GAAA;AAnDY,CAAf;;;;"}
{"version":3,"file":"SignInWithDeviceOption.js","sources":["../../../../../../../src/v2/view-builder/views/signin/SignInWithDeviceOption.js"],"sourcesContent":["import { View, createButton, loc } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport Util from '../../../../util/Util';\nimport Enums from '../../../../util/Enums';\nimport { UNIVERSAL_LINK_POST_DELAY } from '../../utils/Constants';\nimport { FORMS } from '../../../ion/RemediationConstants';\nimport { appendLoginHint } from '../../utils/ChallengeViewUtil';\n\nexport default View.extend({\n  className: 'sign-in-with-device-option',\n  template: hbs`\n    <div class=\"okta-verify-container\">\n    {{#if signInWithDeviceIsRequired}}\n      <div class=\"signin-with-ov-description\">\n      </div>\n    {{/if}}\n    </div>\n    {{#unless signInWithDeviceIsRequired}}\n    <div class=\"separation-line\">\n      <span>{{i18n code=\"authbutton.divider.text\" bundle=\"login\"}}</span>\n    </div>\n    {{/unless}}\n  `,\n  initialize() {\n    const appState = this.options.appState;\n    const deviceChallengePollRemediation = appState.hasRemediationObject(FORMS.LAUNCH_AUTHENTICATOR);\n    \n    const deviceChallenge = deviceChallengePollRemediation?.relatesTo?.value;\n    this.add(createButton({\n      className: 'button',\n      icon: 'okta-verify-authenticator',\n      title: loc('oktaVerify.button', 'login'),\n      click() {\n        if (this.settings.get('features.engFastpassMultipleAccounts') && this.model.get('identifier')) {\n          this.options.settings.set('identifier', encodeURIComponent(this.model.get('identifier')));\n        }\n\n        const isUVapproach = deviceChallenge?.challengeMethod === Enums.UNIVERSAL_LINK_CHALLENGE;\n        if (isUVapproach) {\n          // launch the Okta Verify app\n          let deviceChallengeUrl = appendLoginHint(deviceChallenge.href, this.options?.settings?.get('identifier'));\n          Util.redirect(deviceChallengeUrl);\n        }\n\n        const isAppLinkapproach = deviceChallenge?.challengeMethod === Enums.APP_LINK_CHALLENGE;\n        if (isAppLinkapproach) {\n          // launch the Okta Verify app\n          let deviceChallengeUrl = appendLoginHint(deviceChallenge.href, this.options?.settings?.get('identifier'));\n          Util.redirect(deviceChallengeUrl, window, true);\n        }\n\n        // OKTA-350084\n        // For the universal link (iOS) and app link (Android) approach,\n        // we need to 1. launch the Okta Verify app\n        // and 2. take the enduser to the next step right away\n        // In Safari, when Okta Verify app is not installed, step 1 responds with error immediately,\n        // then step 2 will respond with error.\n        // To avoid showing the error right before switching to the next UI,\n        // wait for 500 milliseconds before invoking step 2\n        Util.callAfterTimeout(() => {\n          if (this.options.isRequired) {\n            appState.trigger('saveForm', this.model);\n          } else {\n            appState.trigger('invokeAction', FORMS.LAUNCH_AUTHENTICATOR);\n          }\n        }, isUVapproach || isAppLinkapproach ? UNIVERSAL_LINK_POST_DELAY : 0);\n      }\n    }), '.okta-verify-container');\n  },\n\n  getTemplateData() {\n    return {\n      signInWithDeviceIsRequired: !!this.options.isRequired,\n    };\n  },\n\n  postRender() {\n    if(this.options.isRequired) {\n      const appLabel = this.options.appState.attributes?.app?.label;\n      const resourceLabel = appLabel ? loc('oktaVerify.appDescription', 'login', [appLabel]) : \n        loc('oktaVerify.description', 'login');\n      const ovDescContainer = this.$el.find('.signin-with-ov-description');\n      ovDescContainer.text(resourceLabel);\n    }\n  }\n});\n"],"names":["View","extend","className","template","initialize","appState","options","deviceChallengePollRemediation","hasRemediationObject","FORMS","LAUNCH_AUTHENTICATOR","deviceChallenge","relatesTo","value","add","createButton","icon","title","loc","click","settings","get","model","set","encodeURIComponent","isUVapproach","challengeMethod","Enums","UNIVERSAL_LINK_CHALLENGE","deviceChallengeUrl","appendLoginHint","href","Util","redirect","isAppLinkapproach","APP_LINK_CHALLENGE","window","callAfterTimeout","isRequired","trigger","UNIVERSAL_LINK_POST_DELAY","getTemplateData","signInWithDeviceIsRequired","postRender","appLabel","attributes","app","label","resourceLabel","ovDescContainer","$el","find","text"],"mappings":"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"}
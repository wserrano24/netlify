{"version":3,"file":"EnrollAuthenticatorDataPhoneView.js","sources":["../../../../../../../src/v2/view-builder/views/phone/EnrollAuthenticatorDataPhoneView.js"],"sourcesContent":["import { _, loc, Model } from 'okta';\nimport { BaseForm, BaseView } from '../../internals';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport CountryUtil from '../../../../util/CountryUtil';\n\nconst Body = BaseForm.extend({\n\n  className: 'phone-authenticator-enroll',\n\n  title() {\n    return loc('oie.phone.enroll.title', 'login');\n  },\n\n  subtitle() {\n    return this.model.get('authenticator.methodType') === 'voice'\n      ? loc('oie.phone.enroll.call.subtitle', 'login')\n      : loc('oie.phone.enroll.sms.subtitle', 'login');\n  },\n\n  render() {\n    BaseForm.prototype.render.apply(this, arguments);\n    const selectedMethod = this.model.get('authenticator.methodType');\n    const phoneField = this.el.querySelector('.phone-authenticator-enroll__phone');\n    const extensionField = this.el.querySelector('.phone-authenticator-enroll__phone-ext');\n\n    if (selectedMethod === 'voice') {\n      if (!phoneField.classList.contains('phone-authenticator-enroll__phone--small')) {\n        phoneField.classList.add('phone-authenticator-enroll__phone--small');\n      }\n      extensionField.classList.remove('hide');\n    }\n\n    if (selectedMethod === 'sms') {\n      phoneField.classList.remove('phone-authenticator-enroll__phone--small');\n      if (!extensionField.classList.contains('hide')) {\n        extensionField.classList.add('hide');\n      }\n    }\n\n    this.el.querySelector('.phone-authenticator-enroll__phone-code').innerText = `+${this.model.get('phoneCode')}`;\n  },\n\n  handlePhoneCodeChange() {\n    const countryCodeField = this.el.querySelector('.phone-authenticator-enroll__phone-code');\n    countryCodeField.innerText = `+${this.model.get('phoneCode')}`;\n  },\n\n  save() {\n    return this.model.get('authenticator.methodType') === 'voice'\n      ? loc('oie.phone.call.primaryButton', 'login')\n      : loc('oie.phone.sms.primaryButton', 'login');\n  },\n\n  getUISchema() {\n    const uiSchemas = BaseForm.prototype.getUISchema.apply(this, arguments);\n\n    // TODO: Using underscore to support IE, replace with Array.prototype methods (find, findIndex) when IE\n    // support is removed\n    const phoneNumberUISchemaIndex = _.findIndex(uiSchemas, ({ name }) => name === 'authenticator.phoneNumber');\n\n    const countryUISchema = {\n      'label-top': true,\n      label: loc('country.label', 'login'),\n      type: 'select',\n      options: CountryUtil.getCountries(),\n      name: 'country',\n      wide: true,\n    };\n\n    // Create an input group - serves as a display wrapper\n    const phoneNumberWithCodeUISchema = {\n      label: loc('mfa.phoneNumber.placeholder', 'login'),\n      type: 'group',\n      modelType: 'string',\n      'label-top': true,\n      name: 'phoneCode',\n      className : 'phone-authenticator-enroll__phone',\n      input: [\n        {\n          type: 'label',\n          /* eslint-disable-next-line @okta/okta/no-unlocalized-text */\n          label: `+${this.model.get('phoneCode')}`,\n          className: 'phone-authenticator-enroll__phone-code no-translate',\n        },\n        Object.assign({}, uiSchemas[phoneNumberUISchemaIndex]),\n      ],\n    };\n\n    const extensionUISchema = {\n      label: loc('phone.extention.label', 'login'),\n      type: 'text',\n      // Need to manually hide and show\n      // - toggleWhen puts display: block on the element when it unhides hence can't be used.\n      //   Because in this case, the element needs to be rendered as an inline-block.\n      // - showWhen has an animation on the element when unhiding\n      //   The animation makes the element look weird because of the way it is positioned,\n      //   hence can't be used\n      className: 'phone-authenticator-enroll__phone-ext hide',\n      'label-top': true,\n      name: 'extension',\n    };\n\n    if (phoneNumberUISchemaIndex !== -1) {\n      // Replace phoneNumberUISchema..\n      uiSchemas.splice(phoneNumberUISchemaIndex, 1, phoneNumberWithCodeUISchema);\n      // Add countryUISchema before & extensionUISchema after phone..\n      uiSchemas.splice(phoneNumberUISchemaIndex, 0, countryUISchema);\n      uiSchemas.splice(phoneNumberUISchemaIndex + 2, 0, extensionUISchema);\n    }\n\n    const methodType = _.find(uiSchemas,  ({ name }) => name === 'authenticator.methodType');\n\n    if (methodType && methodType.options.length === 1) {\n      methodType.className = 'hide';\n    }\n\n    return uiSchemas;\n  },\n\n  initialize() {\n    BaseForm.prototype.initialize.apply(this, arguments);\n    this.listenTo(this.model, 'change:authenticator.methodType', this.render.bind(this));\n    this.listenTo(this.model, 'change:phoneCode', this.handlePhoneCodeChange.bind(this));\n  },\n});\n\nexport default BaseAuthenticatorView.extend({\n\n  Body,\n\n  createModelClass() {\n    const ModelClass = BaseView.prototype.createModelClass.apply(this, arguments);\n    const local = Object.assign(\n      {\n        country: {\n          // Set default country to \"US\"\n          'value': 'US',\n          'type': 'string',\n        },\n        extension: {\n          'type': 'string',\n        },\n      },\n      ModelClass.prototype.local,\n    );\n    const derived = Object.assign(\n      {\n        phoneCode: {\n          deps: [ 'country' ],\n          fn: function(country) {\n            return CountryUtil.getCallingCodeForCountry(country);\n          },\n        },\n      },\n      ModelClass.prototype.derived,\n    );\n    return ModelClass.extend({\n      local,\n      derived,\n      toJSON: function() {\n        const modelJSON = Model.prototype.toJSON.call(this, arguments);\n        const extension = this.get('extension');\n        const phoneCode = this.get('phoneCode');\n\n        // Add country code..\n        let formattedPhoneNumber = `+${phoneCode}${modelJSON.authenticator.phoneNumber}`;\n\n        // Add extension if present..\n        if (modelJSON.authenticator.methodType === 'voice' && extension?.trim().length) {\n          formattedPhoneNumber = `${formattedPhoneNumber}x${extension}`;\n        }\n        // Override phone with formatted number..\n        modelJSON.authenticator.phoneNumber = formattedPhoneNumber;\n        return modelJSON;\n      },\n    });\n  },\n});\n"],"names":["Body","BaseForm","extend","className","title","loc","subtitle","model","get","render","prototype","apply","arguments","selectedMethod","phoneField","el","querySelector","extensionField","classList","contains","add","remove","innerText","handlePhoneCodeChange","countryCodeField","save","getUISchema","uiSchemas","phoneNumberUISchemaIndex","_","findIndex","name","countryUISchema","label","type","options","CountryUtil","getCountries","wide","phoneNumberWithCodeUISchema","modelType","input","Object","assign","extensionUISchema","splice","methodType","find","length","initialize","listenTo","bind","BaseAuthenticatorView","createModelClass","ModelClass","BaseView","local","country","extension","derived","phoneCode","deps","fn","getCallingCodeForCountry","toJSON","modelJSON","Model","call","formattedPhoneNumber","authenticator","phoneNumber","trim"],"mappings":"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"}
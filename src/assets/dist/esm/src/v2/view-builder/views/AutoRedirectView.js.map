{"version":3,"file":"AutoRedirectView.js","sources":["../../../../../../src/v2/view-builder/views/AutoRedirectView.js"],"sourcesContent":["import { _, loc, createCallout } from 'okta';\nimport { BaseForm, BaseView } from '../internals';\nimport { INTERSTITIAL_REDIRECT_VIEW } from '../../ion/RemediationConstants';\nimport CustomAccessDeniedErrorMessage from '../views/shared/CustomAccessDeniedErrorMessage';\n\nconst CUSTOM_ACCESS_DENIED_KEY = 'security.access_denied_custom_message';\nconst UNLOCK_USER_SUCCESS_MESSAGE = 'oie.selfservice.unlock_user.landing.to.app.success.message';\n\nconst Body = BaseForm.extend({\n  title() {\n    let titleString = loc('oie.success.text.signingIn', 'login');\n    // For more info on the API response available in appState, see IdxResponseBuilder.java\n    const app = this.options.appState.get('app');\n    const user = this.options.appState.get('user');\n\n    // If the option is not set, we treat that as being the case where we don't render the spinner.\n    // This is to account for the customer hosted scenario, because by default okta-core will pass in\n    // the correct value as set by the option in the Admin UI (which by default is \"DEFAULT\").\n    if (!this.redirectView || this.redirectView === INTERSTITIAL_REDIRECT_VIEW.NONE) {\n      titleString = loc('oie.success.text.signingIn.with.ellipsis', 'login');\n      return titleString;\n    }\n\n    if (_.isEmpty(app)) {\n      return titleString;\n    }\n\n    const { label: appInstanceName, name: appDisplayName } = app;\n    const { identifier: userEmail } = user || {};\n\n    const appName = appInstanceName ? appInstanceName : appDisplayName;\n\n    if (appName && userEmail && !this.settings.get('features.showIdentifier')) {\n      titleString = loc('oie.success.text.signingIn.with.appName.and.identifier', 'login', [appName, userEmail]);\n    } else if (appName) {\n      titleString = loc('oie.success.text.signingIn.with.appName', 'login', [appName]);\n    }\n\n    return titleString;\n  },\n  showMessages() {\n    if (this.isUnlockSuccess()) {\n      const container = '.o-form-error-container';\n      const text = loc('oie.selfservice.unlock_user.landing.to.app.signing.in.message', 'login');\n      this.add(`<div class=\"ion-messages-container\"><p>${text}</p></div>`, container);\n      return;\n    } else if (this.options.appState.containsMessageStartingWithI18nKey(CUSTOM_ACCESS_DENIED_KEY)) {\n      const { message, links } = this.options.appState.get('messages').value.find(\n        msg => msg.i18n.key === CUSTOM_ACCESS_DENIED_KEY);\n      this.add(createCallout({\n        type: 'error',\n        content: new CustomAccessDeniedErrorMessage({ message, links })\n      }));\n      return;\n    }\n    BaseForm.prototype.showMessages.call(this);\n  },\n  isUnlockSuccess() {\n    return this.options.appState.containsMessageWithI18nKey(UNLOCK_USER_SUCCESS_MESSAGE);\n  },\n  noButtonBar: true,\n  initialize() {\n    BaseForm.prototype.initialize.apply(this, arguments);\n    this.redirectView = this.settings.get('interstitialBeforeLoginRedirect');\n    this.model.set('useRedirect', true);\n    this.trigger('save', this.model);\n  },\n\n  render() {\n    BaseForm.prototype.render.apply(this, arguments);\n    if (this.redirectView === INTERSTITIAL_REDIRECT_VIEW.DEFAULT) {\n      this.add('<div class=\"okta-waiting-spinner\"></div>');\n    }\n  }\n});\n\nexport default BaseView.extend({\n  Body\n});\n"],"names":["CUSTOM_ACCESS_DENIED_KEY","UNLOCK_USER_SUCCESS_MESSAGE","Body","BaseForm","extend","title","titleString","loc","app","options","appState","get","user","redirectView","INTERSTITIAL_REDIRECT_VIEW","NONE","_","isEmpty","label","appInstanceName","name","appDisplayName","identifier","userEmail","appName","settings","showMessages","isUnlockSuccess","container","text","add","containsMessageStartingWithI18nKey","message","links","value","find","msg","i18n","key","createCallout","type","content","CustomAccessDeniedErrorMessage","prototype","call","containsMessageWithI18nKey","noButtonBar","initialize","apply","arguments","model","set","trigger","render","DEFAULT","BaseView"],"mappings":"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"}
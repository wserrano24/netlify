{"version":3,"file":"ChallengeAuthenticatorDataPhoneView.js","sources":["../../../../../../../src/v2/view-builder/views/phone/ChallengeAuthenticatorDataPhoneView.js"],"sourcesContent":["import { _, loc } from 'okta';\nimport { BaseForm, BaseView } from '../../internals';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\n\nconst Body = BaseForm.extend(\n  {\n    className: 'phone-authenticator-challenge',\n    events: {\n      'click a.phone-authenticator-challenge__link' : 'handleSecondaryLinkClick'\n    },\n\n    title() {\n      return loc('oie.phone.verify.title', 'login');\n    },\n\n    save() {\n      return (this.model.get('primaryMode') === 'sms')\n        ? loc('oie.phone.sms.primaryButton', 'login')\n        : loc('oie.phone.call.primaryButton', 'login');\n    },\n\n    handleSecondaryLinkClick(e) {\n      e.preventDefault();\n      // Call the API to send a code via secondary mode\n      const secondaryMode = this.model.get('secondaryMode');\n      this.model.set('authenticator.methodType', secondaryMode);\n      this.saveForm(this.model);\n    },\n\n    initialize() {\n      // This is needed when user clicks on secondary (say voice) and call fails with ratelimit server-side error.\n      // Then the user clicks primary button (say sms) and right methodType needs to be sent.\n      this.model.on('error', () => this.model.set('authenticator.methodType', this.model.get('primaryMode')));\n      BaseForm.prototype.initialize.apply(this, arguments);\n      const sendText = ( this.model.get('primaryMode') === 'sms' )\n        ? loc('oie.phone.verify.sms.sendText', 'login')\n        : loc('oie.phone.verify.call.sendText', 'login');\n      const carrierChargesText = loc('oie.phone.carrier.charges', 'login');\n      const extraCssClasses =\n        this.model.get('phoneNumber') !== loc('oie.phone.alternate.title', 'login') ?\n          'strong no-translate' : '';\n      // Courage doesn't support HTML, hence creating a subtitle here.\n      this.add(`<div class=\"okta-form-subtitle\" data-se=\"o-form-explain\">${sendText}\n        <span ${ extraCssClasses ? 'class=\"' + extraCssClasses + '\"' : ''}>${this.model.escape('phoneNumber')}</span>\n        <p>${carrierChargesText}</p>\n      </div>`);\n    },\n\n    getUISchema() {\n      // Change the UI schema to not display radios here.\n      const uiSchemas = BaseForm.prototype.getUISchema.apply(this, arguments);\n      return uiSchemas.filter(schema => schema.name !== 'authenticator.methodType');\n    },\n\n    render() {\n      BaseForm.prototype.render.apply(this, arguments);\n      const secondaryMode = this.model.get('secondaryMode');\n      if (secondaryMode) {\n        const secondaryButtonTitle = (secondaryMode === 'sms')\n          ? loc('oie.phone.sms.secondaryButton', 'login')\n          : loc('oie.phone.call.secondaryButton', 'login');\n        this.add(\n          `<a href=\"#\"\n            class=\"link phone-authenticator-challenge__link\"\n            data-se=\"phone-authenticator-challenge__link\">${secondaryButtonTitle}</a>`,\n          '.o-form-button-bar');\n      }\n    },\n  },\n);\n\nexport default BaseAuthenticatorView.extend({\n  Body,\n\n  createModelClass({ uiSchema }) {\n    // It is important to get methods from here to maintain single source of truth.\n    const { options: methods } = _.find(uiSchema, schema => schema.name === 'authenticator.methodType');\n    const relatesToObject = this.options.currentViewState.relatesTo;\n    const { profile } = relatesToObject?.value || {};\n    const ModelClass = BaseView.prototype.createModelClass.apply(this, arguments);\n    const local = Object.assign({\n      primaryMode: {\n        'value': methods[0].value,\n        'type': 'string',\n      },\n      secondaryMode: {\n        'value': methods[1] && methods[1].value,\n        'type': 'string',\n      },\n      phoneNumber: {\n        'value': profile?.phoneNumber ? profile.phoneNumber : loc('oie.phone.alternate.title', 'login'),\n        'type': 'string',\n      },\n    }, ModelClass.prototype.local);\n    return ModelClass.extend({ local });\n  },\n});\n"],"names":["Body","BaseForm","extend","className","events","title","loc","save","model","get","handleSecondaryLinkClick","e","preventDefault","secondaryMode","set","saveForm","initialize","on","prototype","apply","arguments","sendText","carrierChargesText","extraCssClasses","add","escape","getUISchema","uiSchemas","filter","schema","name","render","secondaryButtonTitle","BaseAuthenticatorView","createModelClass","uiSchema","options","methods","_","find","relatesToObject","currentViewState","relatesTo","profile","value","ModelClass","BaseView","local","Object","assign","primaryMode","phoneNumber"],"mappings":"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"}
{"version":3,"file":"PollView.js","sources":["../../../../../../src/v2/view-builder/views/PollView.js"],"sourcesContent":["import { loc, View } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport { BaseForm, BaseView } from '../internals';\nimport { MS_PER_SEC } from '../utils/Constants';\n\nconst PollMessageView = View.extend({\n  template: hbs`\n    <div class=\"ion-messages-container\">\n      <p>{{i18n code=\"poll.form.message\"\n        bundle=\"login\" arguments=\"countDownCounterValue\" $1=\"<span class='strong'>$1</span>\"}} </p>\n    </div>\n    <div class=\"hide okta-waiting-spinner\"></div>\n    `\n  ,\n  getTemplateData() {\n    const countDownCounterValue = this.options;\n    return {\n      countDownCounterValue,\n    };\n  },\n});\n\nconst Body = BaseForm.extend(Object.assign(\n  {\n    title() {\n      return  loc('poll.form.title', 'login');\n    },\n\n    noButtonBar: true,\n\n    initialize() {\n      BaseForm.prototype.initialize.apply(this, arguments);\n      const refreshInterval = this.options.appState.getCurrentViewState().refresh;\n      this.refreshTimeout = setTimeout(() => {\n        this.$el.find('.okta-waiting-spinner').show();\n        // start after a small delay so that the spinner does not get hidden too soon\n        setTimeout(() => this.saveForm(this.model), 200);\n      }, refreshInterval);\n    },\n\n    render() {\n      BaseForm.prototype.render.apply(this, arguments);\n      this.countDownCounterValue = Math.ceil(this.options.appState.getCurrentViewState().refresh / MS_PER_SEC);\n      this.add(new PollMessageView(this.countDownCounterValue));\n      this.startCountDown('.ion-messages-container span', MS_PER_SEC);\n    },\n\n    remove() {\n      BaseForm.prototype.remove.apply(this, arguments);\n      clearTimeout(this.refreshTimeout);\n    },\n\n    triggerAfterError() {\n      BaseForm.prototype.triggerAfterError.apply(this, arguments);\n      clearTimeout(this.refreshTimeout);\n      this.stopCountDown();\n      this.$el.find('.o-form-fieldset-container').empty();\n    },\n\n    startCountDown(selector , interval) {\n      if (this.countDown) {\n        clearInterval(this.countDown);\n      }\n      this.counterEl = this.$el.find(selector);\n      this.countDown = setInterval(() => {\n        if(this.counterEl.text() !== '0') {\n          this.counterEl.text(this.counterEl.text() - 1);\n        }\n      }, interval, this);\n    },\n\n    stopCountDown() {\n      if (this.countDown) {\n        clearInterval(this.countDown);\n      }\n    },\n  },\n));\n\nexport default BaseView.extend({\n  Body\n});\n"],"names":["PollMessageView","View","extend","template","getTemplateData","countDownCounterValue","options","Body","BaseForm","Object","assign","title","loc","noButtonBar","initialize","prototype","apply","arguments","refreshInterval","appState","getCurrentViewState","refresh","refreshTimeout","setTimeout","$el","find","show","saveForm","model","render","Math","ceil","MS_PER_SEC","add","startCountDown","remove","clearTimeout","triggerAfterError","stopCountDown","empty","selector","interval","countDown","clearInterval","counterEl","setInterval","text","BaseView"],"mappings":"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"}
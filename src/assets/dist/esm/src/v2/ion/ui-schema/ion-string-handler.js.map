{"version":3,"file":"ion-string-handler.js","sources":["../../../../../../src/v2/ion/ui-schema/ion-string-handler.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint max-depth: [2, 3] */\n/* eslint complexity: [2, 20] */\nimport { loc } from 'okta';\nimport { HINTS, ATTR_FORMAT } from '../RemediationConstants';\nimport CountryUtil from 'util/CountryUtil';\nimport TimeZone from '../../view-builder/utils/TimeZone';\n\nconst ionOptionsToUiOptions = (options) => {\n  const result = {};\n  options.forEach(({ value, label }) => {\n    result[value] = label;\n  });\n  return result;\n};\n\nconst getPasswordUiSchema = (settings) => ({\n  type: 'password',\n  params: {\n    showPasswordToggle: settings.get('showPasswordToggle'),\n  },\n});\n\nconst getCaptchaUiSchema = () => {\n  return {\n    type: 'captcha',\n  };\n};\n\nconst timezoneUISchema = {\n  type: 'select',\n  wide: true\n};\n\nconst shouldRenderAsRadio = (name) => name.indexOf('methodType') >= 0 || name.indexOf('channel') >= 0;\n\nconst optionalType = ['text', 'radio', 'select'];\n\nconst populateUISchemaForDisplay = (uiSchema, ionField) => {\n  const display = ionField?.value?.value;\n  uiSchema.type = display.inputType;\n  if (display.inputType === 'radio') {\n    uiSchema.options = display.options;\n  } else if (display.inputType === 'select') {\n    uiSchema.wide = true;\n    if (display.format === ATTR_FORMAT.COUNTRY_CODE) {\n      uiSchema.options = Object.assign({'': ''}, CountryUtil.getCountryCode());\n    } else {\n      //it will create a placeholder for dropdowns, by default it will show 'Select an Option'\n      uiSchema.options = Object.assign({'': ''}, ionOptionsToUiOptions(display.options));\n    }\n  }\n};\n\nconst populateUISchemaForRadio = (uiSchema, ionFormField) => {\n  // e.g. { name: 'methodType', options: [ {label: 'sms'} ], type: 'string' | null }\n  uiSchema.type = 'radio';\n  // set the default value to the first value.\n  ionFormField.value = ionFormField.options[0].value;\n};\n\nconst createUiSchemaForString = (ionFormField, remediationForm, transformedResp, createUISchema, settings) => {\n  const uiSchema = {\n    type: 'text'\n  };\n\n  // e.g. { name: 'password', secret: true }\n  if (ionFormField.secret === true) {\n    Object.assign(uiSchema, getPasswordUiSchema(settings));\n  }\n\n  if (ionFormField.hint === HINTS.CAPTCHA) {\n    Object.assign(uiSchema, getCaptchaUiSchema());\n  }\n\n  if(ionFormField.name === 'userProfile.timezone'){\n    Object.assign(uiSchema, timezoneUISchema);\n    uiSchema.options = Object.assign({'': ''}, TimeZone);\n  }\n\n  if (Array.isArray(ionFormField.options) && ionFormField.options[0] && ionFormField.options[0].value) {\n    const ionField = ionFormField.options[0];\n    if (ionField.label === 'display') {\n      populateUISchemaForDisplay(uiSchema, ionField);\n    } else if (shouldRenderAsRadio(ionFormField.name)) {\n      populateUISchemaForRadio(uiSchema, ionFormField);\n    } else {\n      // default to select (dropdown). no particular reason (certainly can default to radio.)\n      // e.g. { name: 'questionKey', options: [], type: 'string' | null }\n      uiSchema.type = 'select';\n      uiSchema.wide = true;\n      uiSchema.options = ionOptionsToUiOptions(ionFormField.options);\n    }\n  }\n\n  // set a label as 'Optional' for supported optional element types\n  if(ionFormField.required === false && optionalType.includes(uiSchema.type)) {\n    uiSchema.sublabel = loc('oie.form.field.optional', 'login');\n  }\n\n  return uiSchema;\n};\n\nexport default createUiSchemaForString;\n"],"names":["ionOptionsToUiOptions","options","result","forEach","value","label","getPasswordUiSchema","settings","type","params","showPasswordToggle","get","getCaptchaUiSchema","timezoneUISchema","wide","shouldRenderAsRadio","name","indexOf","optionalType","populateUISchemaForDisplay","uiSchema","ionField","display","inputType","format","ATTR_FORMAT","COUNTRY_CODE","Object","assign","CountryUtil","getCountryCode","populateUISchemaForRadio","ionFormField","createUiSchemaForString","remediationForm","transformedResp","createUISchema","secret","hint","HINTS","CAPTCHA","TimeZone","Array","isArray","required","includes","sublabel","loc"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AASA,MAAMA,qBAAqB,GAAIC,OAAD,IAAa;AACzC,EAAMC,MAAAA,MAAM,GAAG,EAAf,CAAA;AACAD,EAAAA,OAAO,CAACE,OAAR,CAAgB,CAAC;AAAEC,IAAAA,KAAK,EAALA,KAAF;AAASC,IAAAA,KAAK,EAALA,KAAAA;AAAT,GAAD,KAAsB;AACpCH,IAAAA,MAAM,CAACE,KAAD,CAAN,GAAgBC,KAAhB,CAAA;AACD,GAFD,CAAA,CAAA;AAGA,EAAA,OAAOH,MAAP,CAAA;AACD,CAND,CAAA;;AAQA,MAAMI,mBAAmB,GAAIC,QAAD,KAAe;AACzCC,EAAAA,IAAI,EAAE,UADmC;AAEzCC,EAAAA,MAAM,EAAE;AACNC,IAAAA,kBAAkB,EAAEH,QAAQ,CAACI,GAAT,CAAa,oBAAb,CAAA;AADd,GAAA;AAFiC,CAAf,CAA5B,CAAA;;AAOA,MAAMC,kBAAkB,GAAG,MAAM;AAC/B,EAAO,OAAA;AACLJ,IAAAA,IAAI,EAAE,SAAA;AADD,GAAP,CAAA;AAGD,CAJD,CAAA;;AAMA,MAAMK,gBAAgB,GAAG;AACvBL,EAAAA,IAAI,EAAE,QADiB;AAEvBM,EAAAA,IAAI,EAAE,IAAA;AAFiB,CAAzB,CAAA;;AAKA,MAAMC,mBAAmB,GAAIC,IAAD,IAAUA,IAAI,CAACC,OAAL,CAAa,YAAb,CAA8B,IAAA,CAA9B,IAAmCD,IAAI,CAACC,OAAL,CAAa,SAAb,KAA2B,CAApG,CAAA;;AAEA,MAAMC,YAAY,GAAG,CAAC,MAAD,EAAS,OAAT,EAAkB,QAAlB,CAArB,CAAA;;AAEA,MAAMC,0BAA0B,GAAG,CAACC,QAAD,EAAWC,QAAX,KAAwB;AAAA,EAAA,IAAA,eAAA,CAAA;;AACzD,EAAMC,MAAAA,OAAO,GAAGD,QAAH,KAAGA,IAAAA,IAAAA,QAAH,KAAGA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,CAAAA,eAAAA,GAAAA,QAAQ,CAAEjB,KAAb,MAAG,IAAA,IAAA,eAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,eAAA,CAAiBA,KAAjC,CAAA;AACAgB,EAAAA,QAAQ,CAACZ,IAAT,GAAgBc,OAAO,CAACC,SAAxB,CAAA;;AACA,EAAA,IAAID,OAAO,CAACC,SAAR,KAAsB,OAA1B,EAAmC;AACjCH,IAAAA,QAAQ,CAACnB,OAAT,GAAmBqB,OAAO,CAACrB,OAA3B,CAAA;AACD,GAFD,MAEO,IAAIqB,OAAO,CAACC,SAAR,KAAsB,QAA1B,EAAoC;AACzCH,IAAAA,QAAQ,CAACN,IAAT,GAAgB,IAAhB,CAAA;;AACA,IAAA,IAAIQ,OAAO,CAACE,MAAR,KAAmBC,WAAW,CAACC,YAAnC,EAAiD;AAC/CN,MAAAA,QAAQ,CAACnB,OAAT,GAAmB0B,MAAM,CAACC,MAAP,CAAc;AAAC,QAAI,EAAA,EAAA,EAAA;AAAL,OAAd,EAAwBC,EAAW,CAACC,cAAZ,EAAxB,CAAnB,CAAA;AACD,KAFD,MAEO;AACL;AACAV,MAAAA,QAAQ,CAACnB,OAAT,GAAmB0B,MAAM,CAACC,MAAP,CAAc;AAAC,QAAI,EAAA,EAAA,EAAA;AAAL,OAAd,EAAwB5B,qBAAqB,CAACsB,OAAO,CAACrB,OAAT,CAA7C,CAAnB,CAAA;AACD,KAAA;AACF,GAAA;AACF,CAdD,CAAA;;AAgBA,MAAM8B,wBAAwB,GAAG,CAACX,QAAD,EAAWY,YAAX,KAA4B;AAC3D;AACAZ,EAAAA,QAAQ,CAACZ,IAAT,GAAgB,OAAhB,CAF2D;;AAI3DwB,EAAAA,YAAY,CAAC5B,KAAb,GAAqB4B,YAAY,CAAC/B,OAAb,CAAqB,CAArB,CAAA,CAAwBG,KAA7C,CAAA;AACD,CALD,CAAA;;AAOA,MAAM6B,uBAAuB,GAAG,CAACD,YAAD,EAAeE,eAAf,EAAgCC,eAAhC,EAAiDC,cAAjD,EAAiE7B,QAAjE,KAA8E;AAC5G,EAAA,MAAMa,QAAQ,GAAG;AACfZ,IAAAA,IAAI,EAAE,MAAA;AADS,GAAjB,CAD4G;;AAM5G,EAAA,IAAIwB,YAAY,CAACK,MAAb,KAAwB,IAA5B,EAAkC;AAChCV,IAAAA,MAAM,CAACC,MAAP,CAAcR,QAAd,EAAwBd,mBAAmB,CAACC,QAAD,CAA3C,CAAA,CAAA;AACD,GAAA;;AAED,EAAA,IAAIyB,YAAY,CAACM,IAAb,KAAsBC,KAAK,CAACC,OAAhC,EAAyC;AACvCb,IAAAA,MAAM,CAACC,MAAP,CAAcR,QAAd,EAAwBR,kBAAkB,EAA1C,CAAA,CAAA;AACD,GAAA;;AAED,EAAA,IAAGoB,YAAY,CAAChB,IAAb,KAAsB,sBAAzB,EAAgD;AAC9CW,IAAAA,MAAM,CAACC,MAAP,CAAcR,QAAd,EAAwBP,gBAAxB,CAAA,CAAA;AACAO,IAAAA,QAAQ,CAACnB,OAAT,GAAmB0B,MAAM,CAACC,MAAP,CAAc;AAAC,MAAI,EAAA,EAAA,EAAA;AAAL,KAAd,EAAwBa,QAAxB,CAAnB,CAAA;AACD,GAAA;;AAED,EAAIC,IAAAA,KAAK,CAACC,OAAN,CAAcX,YAAY,CAAC/B,OAA3B,CAAuC+B,IAAAA,YAAY,CAAC/B,OAAb,CAAqB,CAArB,CAAvC,IAAkE+B,YAAY,CAAC/B,OAAb,CAAqB,CAArB,CAAwBG,CAAAA,KAA9F,EAAqG;AACnG,IAAA,MAAMiB,QAAQ,GAAGW,YAAY,CAAC/B,OAAb,CAAqB,CAArB,CAAjB,CAAA;;AACA,IAAA,IAAIoB,QAAQ,CAAChB,KAAT,KAAmB,SAAvB,EAAkC;AAChCc,MAAAA,0BAA0B,CAACC,QAAD,EAAWC,QAAX,CAA1B,CAAA;AACD,KAFD,MAEO,IAAIN,mBAAmB,CAACiB,YAAY,CAAChB,IAAd,CAAvB,EAA4C;AACjDe,MAAAA,wBAAwB,CAACX,QAAD,EAAWY,YAAX,CAAxB,CAAA;AACD,KAFM,MAEA;AACL;AACA;AACAZ,MAAAA,QAAQ,CAACZ,IAAT,GAAgB,QAAhB,CAAA;AACAY,MAAAA,QAAQ,CAACN,IAAT,GAAgB,IAAhB,CAAA;AACAM,MAAAA,QAAQ,CAACnB,OAAT,GAAmBD,qBAAqB,CAACgC,YAAY,CAAC/B,OAAd,CAAxC,CAAA;AACD,KAAA;AACF,GAhC2G;;;AAmC5G,EAAA,IAAG+B,YAAY,CAACY,QAAb,KAA0B,KAA1B,IAAmC1B,YAAY,CAAC2B,QAAb,CAAsBzB,QAAQ,CAACZ,IAA/B,CAAtC,EAA4E;AAC1EY,IAAAA,QAAQ,CAAC0B,QAAT,GAAoBC,GAAG,CAAC,yBAAD,EAA4B,OAA5B,CAAvB,CAAA;AACD,GAAA;;AAED,EAAA,OAAO3B,QAAP,CAAA;AACD;;;;"}
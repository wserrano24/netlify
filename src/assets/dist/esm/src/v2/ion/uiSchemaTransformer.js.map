{"version":3,"file":"uiSchemaTransformer.js","sources":["../../../../../src/v2/ion/uiSchemaTransformer.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/**\n * Create UI Schema into remedation object base on remediation values\n */\nimport { _ } from 'okta';\nimport createUiSchemaForBoolean from './ui-schema/ion-boolean-handler';\nimport createUiSchemaForObject from './ui-schema/ion-object-handler';\nimport createUiSchemaForString from './ui-schema/ion-string-handler';\n\nconst UISchemaHandlers = {\n  string: createUiSchemaForString,\n  boolean: createUiSchemaForBoolean,\n  object: createUiSchemaForObject,\n};\n\n/**\n *\n * @param {AuthResult} transformedResp\n * @param {IONForm} remeditationForm\n */\nconst createUISchema = (transformedResp, remediationForm, settings) => {\n\n  // For cases where field itself is a form, it has a formname and we are appending the formname to each field.\n  // Sort of flat the structure in order to align Courage flatten Model. The flatten structure will be converted\n  // back to object hierarchy through `Model.toJSON`.\n  // For simplicity we are assuming that when field itself is a form its only one level deep.\n  const remediationValue = _.chain(remediationForm.value || [])\n    .filter(v => v.visible !== false)\n    .map(v => {\n      let nestedForm;\n      if (v.form) {\n        nestedForm = v.form;\n      } else if (v.value?.form) {\n        nestedForm = v.value.form;\n      }\n\n      if (nestedForm) {\n        const inputGroupName = v.name;\n        return nestedForm.value.map(input => {\n          return Object.assign({}, input, { name: inputGroupName + '.' + input.name });\n        });\n      } else {\n        return v;\n      }\n    })\n    .flatten()\n    .value();\n\n  return remediationValue.map(ionFormField => {\n    const uiSchemaDefaultConfig = {\n      'label-top': true,\n      'multirowError': true,\n      'data-se': `o-form-fieldset-${ionFormField.name}`,\n    };\n    const fieldType = ionFormField.type || 'string';\n    const uiSchemaHandler = UISchemaHandlers[fieldType];\n    const uiSchemaResult = uiSchemaHandler(ionFormField, remediationForm, transformedResp, createUISchema, settings);\n\n    return Object.assign(\n      {},\n      ionFormField,\n      uiSchemaDefaultConfig,\n      uiSchemaResult,\n    );\n  });\n};\n\n/**\n *\n * @param {AuthResult} transformedResp\n */\nconst insertUISchema = (settings, transformedResp) => {\n  if (transformedResp) {\n    transformedResp.remediations = transformedResp.remediations.map(obj => {\n      obj.uiSchema = createUISchema(transformedResp, obj, settings);\n      return obj;\n    });\n  }\n  return transformedResp;\n};\n\nexport default insertUISchema;\n\n/**\n * @typedef {Object} Authenticator\n * @property {string} label\n * @property {AuthenticatorValue} value\n */\n/**\n * @typedef {Object} AuthenticatorValue\n * @property {string} type Authenticator Type\n * @property {string} id Authenticator Org Authenticator ID\n * @property {AuthenticatorMethod[]} methods\n */\n/**\n * @typedef {Object} AuthenticatorEnrollment\n * @property {string} label\n * @property {AuthenticatorEnrollmentValue} value\n */\n/**\n * @typedef {Object} AuthenticatorEnrollmentValue\n * @property {string} authenticatorId Org Authenticator ID\n * @property {string} type Authenticator Type\n * @property {string} id Authenticator Enrollment ID\n * @property {AuthenticatorMethod[]} methods\n */\n/**\n * @typedef {Object} AuthenticatorMethod\n * @property {string} type Authenticator method type\n */\n/**\n * @typedef {Object} AuthenticatorOption\n * @property {string} label\n * @property {Object} form\n * @property {AuthenticatorOption[]} form.value\n */\n/**\n * @typedef {Object} AuthenticatorOptionValue\n * @property {string} name\n * @property {boolean} required\n * @property {string} value\n * @property {boolean} mutable\n */\n/**\n * @typedef {Object} IONForm\n * @property {string} name\n * @property {string[]} rel\n * @property {string} method\n * @property {string} href\n * @property {string} accepts\n * @property {IONFormField[]} value\n */\n/**\n * @typedef {Object} IONFormField\n * @property {string} name\n * @property {string=} type\n * @property {string=} required\n * @property {string=} secret\n * @property {string=} label\n * @property {Object[]} options\n * @property {Object=} form\n * @property {IONFormField[]} form.value\n */\n"],"names":["UISchemaHandlers","string","createUiSchemaForString","boolean","createUiSchemaForBoolean","object","createUiSchemaForObject","createUISchema","transformedResp","remediationForm","settings","remediationValue","_","chain","value","filter","v","visible","map","nestedForm","form","inputGroupName","name","input","Object","assign","flatten","ionFormField","uiSchemaDefaultConfig","fieldType","type","uiSchemaHandler","uiSchemaResult","insertUISchema","remediations","obj","uiSchema"],"mappings":"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"}
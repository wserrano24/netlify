{"version":3,"file":"RegistrationSchema.js","sources":["../../../../../src/v1/models/RegistrationSchema.js"],"sourcesContent":["/*!\n * Copyright (c) 2017, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, BaseModel, internal } from 'okta';\nlet { BaseSchema, SchemaProperty } = internal.models;\nconst RegistrationSchemaRegistrationSchemaPropertyCollection = SchemaProperty.Collection.extend({\n  createModelProperties: function() {\n    const modelProperties = SchemaProperty.Collection.prototype.createModelProperties.apply(this);\n\n    _.each(\n      modelProperties,\n      function(modelProperty, name) {\n        modelProperty.required = !!this.get(name).get('required');\n      },\n      this\n    );\n    return modelProperties;\n  },\n});\nexport default BaseSchema.Model.extend({\n  expand: ['schema'],\n\n  constructor: function() {\n    this.properties = new RegistrationSchemaRegistrationSchemaPropertyCollection();\n    BaseModel.apply(this, arguments);\n  },\n\n  parse: function(resp) {\n    const parseResponseData = resp => {\n      const requireFields = resp.schema.required;\n\n      if (_.isArray(requireFields)) {\n        _.each(\n          requireFields,\n          function(requireField) {\n            const field = this.properties.get(requireField);\n\n            if (field) {\n              field.set('required', true);\n            }\n          },\n          this\n        );\n      }\n\n      const fieldOrderIds = resp.schema.fieldOrder;\n\n      if (_.isArray(fieldOrderIds)) {\n        _.each(\n          fieldOrderIds,\n          function(fieldOrderId, sortOrder) {\n            const field = this.properties.get(fieldOrderId);\n\n            if (field) {\n              field.set('sortOrder', sortOrder);\n            }\n          },\n          this\n        );\n        this.properties.comparator = 'sortOrder';\n        this.properties.sort();\n      }\n      this.properties.defaultPolicyId = resp.policyId;\n      return resp;\n    };\n\n    const self = this;\n    this.settings.parseRegistrationSchema(\n      resp,\n      function(resp) {\n        if (resp.profileSchema) {\n          resp.schema = resp.profileSchema;\n          BaseSchema.Model.prototype.parse.apply(self, [resp]);\n          resp = parseResponseData(resp);\n        }\n        self.trigger('parseComplete', { properties: self.properties });\n      },\n      function(error) {\n        self.trigger('parseComplete', { properties: self.properties, error: error });\n      }\n    );\n  },\n});\n"],"names":["BaseSchema","SchemaProperty","internal","models","RegistrationSchemaRegistrationSchemaPropertyCollection","Collection","extend","createModelProperties","modelProperties","prototype","apply","_","each","modelProperty","name","required","get","Model","expand","constructor","properties","BaseModel","arguments","parse","resp","parseResponseData","requireFields","schema","isArray","requireField","field","set","fieldOrderIds","fieldOrder","fieldOrderId","sortOrder","comparator","sort","defaultPolicyId","policyId","self","settings","parseRegistrationSchema","profileSchema","trigger","error"],"mappings":"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"}
{"version":3,"file":"EnrollUser.js","sources":["../../../../../src/v1/models/EnrollUser.js"],"sourcesContent":["/*!\n * Copyright (c) 2019, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the 'License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc } from 'okta';\nimport BaseLoginModel from './BaseLoginModel';\nexport default BaseLoginModel.extend({\n  initialize: function(options) {\n    this.options = options || {};\n    this.appState = this.options.appState;\n  },\n  constructPostData: function(profileAttributes) {\n    const postData = {\n      registration: {\n        profile: profileAttributes,\n      },\n    };\n\n    // send createNewAccount flag for new user creation\n    if (this.appState.get('policy').registration.createNewAccount) {\n      postData.registration['createNewAccount'] = true;\n    }\n    return postData;\n  },\n  getEnrollFormData: function() {\n    return this.manageTransaction(function(transaction, setTransaction) {\n      return transaction.enroll().then(function(trans) {\n        setTransaction(trans);\n      });\n    });\n  },\n  save: function() {\n    let data = BaseLoginModel.prototype.toJSON.apply(this, arguments);\n\n    data = _.omit(data, ['appState', 'settings', 'createNewAccount']);\n    if (_.isEmpty(data)) {\n      const error = {\n        errorSummary: loc('oform.errorbanner.title', 'login'),\n      };\n\n      this.trigger('error', this, {\n        responseJSON: error,\n      });\n    } else {\n      return this.manageTransaction(function(transaction, setTransaction) {\n        transaction.enroll(this.constructPostData(data)).then(function(trans) {\n          setTransaction(trans);\n        });\n      });\n    }\n  },\n});\n"],"names":["BaseLoginModel","extend","initialize","options","appState","constructPostData","profileAttributes","postData","registration","profile","get","createNewAccount","getEnrollFormData","manageTransaction","transaction","setTransaction","enroll","then","trans","save","data","prototype","toJSON","apply","arguments","_","omit","isEmpty","error","errorSummary","loc","trigger","responseJSON"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,iBAAeA,cAAc,CAACC,MAAf,CAAsB;AACnCC,EAAAA,UAAU,EAAE,UAASC,OAAT,EAAkB;AAC5B,IAAA,IAAA,CAAKA,OAAL,GAAeA,OAAO,IAAI,EAA1B,CAAA;AACA,IAAA,IAAA,CAAKC,QAAL,GAAgB,IAAKD,CAAAA,OAAL,CAAaC,QAA7B,CAAA;AACD,GAJkC;AAKnCC,EAAAA,iBAAiB,EAAE,UAASC,iBAAT,EAA4B;AAC7C,IAAA,MAAMC,QAAQ,GAAG;AACfC,MAAAA,YAAY,EAAE;AACZC,QAAAA,OAAO,EAAEH,iBAAAA;AADG,OAAA;AADC,KAAjB,CAD6C;;AAQ7C,IAAI,IAAA,IAAA,CAAKF,QAAL,CAAcM,GAAd,CAAkB,QAAlB,CAA4BF,CAAAA,YAA5B,CAAyCG,gBAA7C,EAA+D;AAC7DJ,MAAAA,QAAQ,CAACC,YAAT,CAAsB,kBAAtB,IAA4C,IAA5C,CAAA;AACD,KAAA;;AACD,IAAA,OAAOD,QAAP,CAAA;AACD,GAjBkC;AAkBnCK,EAAAA,iBAAiB,EAAE,YAAW;AAC5B,IAAA,OAAO,KAAKC,iBAAL,CAAuB,UAASC,WAAT,EAAsBC,cAAtB,EAAsC;AAClE,MAAOD,OAAAA,WAAW,CAACE,MAAZ,EAAA,CAAqBC,IAArB,CAA0B,UAASC,KAAT,EAAgB;AAC/CH,QAAAA,cAAc,CAACG,KAAD,CAAd,CAAA;AACD,OAFM,CAAP,CAAA;AAGD,KAJM,CAAP,CAAA;AAKD,GAxBkC;AAyBnCC,EAAAA,IAAI,EAAE,YAAW;AACf,IAAA,IAAIC,IAAI,GAAGpB,cAAc,CAACqB,SAAf,CAAyBC,MAAzB,CAAgCC,KAAhC,CAAsC,IAAtC,EAA4CC,SAA5C,CAAX,CAAA;AAEAJ,IAAAA,IAAI,GAAGK,cAAC,CAACC,IAAF,CAAON,IAAP,EAAa,CAAC,UAAD,EAAa,UAAb,EAAyB,kBAAzB,CAAb,CAAP,CAAA;;AACA,IAAA,IAAIK,cAAC,CAACE,OAAF,CAAUP,IAAV,CAAJ,EAAqB;AACnB,MAAA,MAAMQ,KAAK,GAAG;AACZC,QAAAA,YAAY,EAAEC,GAAG,CAAC,yBAAD,EAA4B,OAA5B,CAAA;AADL,OAAd,CAAA;AAIA,MAAA,IAAA,CAAKC,OAAL,CAAa,OAAb,EAAsB,IAAtB,EAA4B;AAC1BC,QAAAA,YAAY,EAAEJ,KAAAA;AADY,OAA5B,CAAA,CAAA;AAGD,KARD,MAQO;AACL,MAAA,OAAO,KAAKf,iBAAL,CAAuB,UAASC,WAAT,EAAsBC,cAAtB,EAAsC;AAClED,QAAAA,WAAW,CAACE,MAAZ,CAAmB,KAAKX,iBAAL,CAAuBe,IAAvB,CAAnB,CAAiDH,CAAAA,IAAjD,CAAsD,UAASC,KAAT,EAAgB;AACpEH,UAAAA,cAAc,CAACG,KAAD,CAAd,CAAA;AACD,SAFD,CAAA,CAAA;AAGD,OAJM,CAAP,CAAA;AAKD,KAAA;AACF,GAAA;AA5CkC,CAAtB,CAAf;;;;"}
{"version":3,"file":"BaseLoginModel.js","sources":["../../../../../src/v1/models/BaseLoginModel.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, Model } from 'okta';\nimport Q from 'q';\nimport Enums from 'util/Enums';\nconst KNOWN_ERRORS = ['OAuthError', 'AuthSdkError', 'AuthPollStopError', 'AuthApiError'];\nexport default Model.extend({\n  // May return either a \"standard\" promise or a Q promise\n  doTransaction: function(fn, rethrow) {\n    const self = this;\n\n    return fn\n      .call(this, this.appState.get('transaction'))\n      .then(function(trans) {\n        self.trigger('setTransaction', trans);\n        return trans;\n      })\n      .catch(function(err) {\n        // Q may still consider AuthPollStopError to be unhandled\n        if (\n          err.name === 'AuthPollStopError' ||\n          err.name === Enums.AUTH_STOP_POLL_INITIATION_ERROR ||\n          err.name === Enums.WEBAUTHN_ABORT_ERROR\n        ) {\n          return;\n        }\n        self.trigger('error', self, err.xhr);\n        self.trigger('setTransactionError', err);\n        if (rethrow || _.indexOf(KNOWN_ERRORS, err.name) === -1) {\n          throw err;\n        }\n      });\n  },\n\n  manageTransaction: function(fn) {\n    const self = this;\n    const res = fn.call(this, this.appState.get('transaction'), _.bind(this.setTransaction, this));\n\n    // If it's a promise, listen for failures\n    if (Q.isPromiseAlike(res)) {\n      return res.catch(function(err) {\n        if (\n          err.name === 'AuthPollStopError' ||\n          err.name === Enums.AUTH_STOP_POLL_INITIATION_ERROR ||\n          err.name === Enums.WEBAUTHN_ABORT_ERROR\n        ) {\n          return;\n        }\n        self.trigger('error', self, err.xhr);\n        self.trigger('setTransactionError', err);\n      });\n    }\n\n    return Q.resolve(res);\n  },\n\n  startTransaction: function(fn) {\n    const self = this;\n    const res = fn.call(this, this.settings.getAuthClient());\n\n    // If it's a promise, then chain to it\n    if (Q.isPromiseAlike(res)) {\n      return res\n        .then(function(trans) {\n          self.trigger('setTransaction', trans);\n          return trans;\n        })\n        .catch(function(err) {\n          self.trigger('error', self, err.xhr);\n          self.trigger('setTransactionError', err);\n          throw err;\n        });\n    }\n\n    return Q.resolve(res);\n  },\n\n  setTransaction: function(trans) {\n    this.appState.set('transaction', trans);\n  },\n});\n"],"names":["KNOWN_ERRORS","Model","extend","doTransaction","fn","rethrow","self","call","appState","get","then","trans","trigger","catch","err","name","Enums","AUTH_STOP_POLL_INITIATION_ERROR","WEBAUTHN_ABORT_ERROR","xhr","_","indexOf","manageTransaction","res","bind","setTransaction","Q","isPromiseAlike","resolve","startTransaction","settings","getAuthClient","set"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA,MAAMA,YAAY,GAAG,CAAC,YAAD,EAAe,cAAf,EAA+B,mBAA/B,EAAoD,cAApD,CAArB,CAAA;AACA,qBAAeC,KAAK,CAACC,MAAN,CAAa;AAC1B;AACAC,EAAAA,aAAa,EAAE,UAASC,EAAT,EAAaC,OAAb,EAAsB;AACnC,IAAMC,MAAAA,IAAI,GAAG,IAAb,CAAA;AAEA,IAAA,OAAOF,EAAE,CACNG,IADI,CACC,IADD,EACO,KAAKC,QAAL,CAAcC,GAAd,CAAkB,aAAlB,CADP,CAAA,CAEJC,IAFI,CAEC,UAASC,KAAT,EAAgB;AACpBL,MAAAA,IAAI,CAACM,OAAL,CAAa,gBAAb,EAA+BD,KAA/B,CAAA,CAAA;AACA,MAAA,OAAOA,KAAP,CAAA;AACD,KALI,CAMJE,CAAAA,KANI,CAME,UAASC,GAAT,EAAc;AACnB;AACA,MACEA,IAAAA,GAAG,CAACC,IAAJ,KAAa,mBAAb,IACAD,GAAG,CAACC,IAAJ,KAAaC,KAAK,CAACC,+BADnB,IAEAH,GAAG,CAACC,IAAJ,KAAaC,KAAK,CAACE,oBAHrB,EAIE;AACA,QAAA,OAAA;AACD,OAAA;;AACDZ,MAAAA,IAAI,CAACM,OAAL,CAAa,OAAb,EAAsBN,IAAtB,EAA4BQ,GAAG,CAACK,GAAhC,CAAA,CAAA;AACAb,MAAAA,IAAI,CAACM,OAAL,CAAa,qBAAb,EAAoCE,GAApC,CAAA,CAAA;;AACA,MAAA,IAAIT,OAAO,IAAIe,cAAC,CAACC,OAAF,CAAUrB,YAAV,EAAwBc,GAAG,CAACC,IAA5B,CAAsC,KAAA,CAAC,CAAtD,EAAyD;AACvD,QAAA,MAAMD,GAAN,CAAA;AACD,OAAA;AACF,KApBI,CAAP,CAAA;AAqBD,GA1ByB;AA4B1BQ,EAAAA,iBAAiB,EAAE,UAASlB,EAAT,EAAa;AAC9B,IAAME,MAAAA,IAAI,GAAG,IAAb,CAAA;AACA,IAAMiB,MAAAA,GAAG,GAAGnB,EAAE,CAACG,IAAH,CAAQ,IAAR,EAAc,IAAA,CAAKC,QAAL,CAAcC,GAAd,CAAkB,aAAlB,CAAd,EAAgDW,cAAC,CAACI,IAAF,CAAO,IAAA,CAAKC,cAAZ,EAA4B,IAA5B,CAAhD,CAAZ,CAF8B;;AAK9B,IAAA,IAAIC,CAAC,CAACC,cAAF,CAAiBJ,GAAjB,CAAJ,EAA2B;AACzB,MAAA,OAAOA,GAAG,CAACV,KAAJ,CAAU,UAASC,GAAT,EAAc;AAC7B,QACEA,IAAAA,GAAG,CAACC,IAAJ,KAAa,mBAAb,IACAD,GAAG,CAACC,IAAJ,KAAaC,KAAK,CAACC,+BADnB,IAEAH,GAAG,CAACC,IAAJ,KAAaC,KAAK,CAACE,oBAHrB,EAIE;AACA,UAAA,OAAA;AACD,SAAA;;AACDZ,QAAAA,IAAI,CAACM,OAAL,CAAa,OAAb,EAAsBN,IAAtB,EAA4BQ,GAAG,CAACK,GAAhC,CAAA,CAAA;AACAb,QAAAA,IAAI,CAACM,OAAL,CAAa,qBAAb,EAAoCE,GAApC,CAAA,CAAA;AACD,OAVM,CAAP,CAAA;AAWD,KAAA;;AAED,IAAA,OAAOY,CAAC,CAACE,OAAF,CAAUL,GAAV,CAAP,CAAA;AACD,GAhDyB;AAkD1BM,EAAAA,gBAAgB,EAAE,UAASzB,EAAT,EAAa;AAC7B,IAAME,MAAAA,IAAI,GAAG,IAAb,CAAA;AACA,IAAA,MAAMiB,GAAG,GAAGnB,EAAE,CAACG,IAAH,CAAQ,IAAR,EAAc,IAAA,CAAKuB,QAAL,CAAcC,aAAd,EAAd,CAAZ,CAF6B;;AAK7B,IAAA,IAAIL,CAAC,CAACC,cAAF,CAAiBJ,GAAjB,CAAJ,EAA2B;AACzB,MAAA,OAAOA,GAAG,CACPb,IADI,CACC,UAASC,KAAT,EAAgB;AACpBL,QAAAA,IAAI,CAACM,OAAL,CAAa,gBAAb,EAA+BD,KAA/B,CAAA,CAAA;AACA,QAAA,OAAOA,KAAP,CAAA;AACD,OAJI,CAKJE,CAAAA,KALI,CAKE,UAASC,GAAT,EAAc;AACnBR,QAAAA,IAAI,CAACM,OAAL,CAAa,OAAb,EAAsBN,IAAtB,EAA4BQ,GAAG,CAACK,GAAhC,CAAA,CAAA;AACAb,QAAAA,IAAI,CAACM,OAAL,CAAa,qBAAb,EAAoCE,GAApC,CAAA,CAAA;AACA,QAAA,MAAMA,GAAN,CAAA;AACD,OATI,CAAP,CAAA;AAUD,KAAA;;AAED,IAAA,OAAOY,CAAC,CAACE,OAAF,CAAUL,GAAV,CAAP,CAAA;AACD,GArEyB;AAuE1BE,EAAAA,cAAc,EAAE,UAASd,KAAT,EAAgB;AAC9B,IAAA,IAAA,CAAKH,QAAL,CAAcwB,GAAd,CAAkB,aAAlB,EAAiCrB,KAAjC,CAAA,CAAA;AACD,GAAA;AAzEyB,CAAb,CAAf;;;;"}
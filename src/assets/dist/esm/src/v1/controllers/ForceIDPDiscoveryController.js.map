{"version":3,"file":"ForceIDPDiscoveryController.js","sources":["../../../../../src/v1/controllers/ForceIDPDiscoveryController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2017, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport Spinner from 'v1/views/shared/Spinner';\nimport BaseLoginController from 'v1/util/BaseLoginController';\nimport Util from 'util/Util';\n\nexport default BaseLoginController.extend({\n  className: 'force-idp-discovery',\n\n  View: Spinner,\n\n  Model: {},\n\n  initialize: function() {\n    const OKTA_IDP_TYPE = 'OKTA';\n    const RESOURCE = 'okta:acct:';\n\n    const options = this.options;\n    const lastAuthResponse = options.appState.get('lastAuthResponse');\n    const stateToken = lastAuthResponse && lastAuthResponse?.stateToken;\n\n    const webfingerArgs = {\n      resource: RESOURCE,\n      requestContext: stateToken,\n    };\n\n    options.appState.settings.authClient\n      .webfinger(webfingerArgs)\n      .then(res => {\n        if (res?.links && res.links[0]) {\n          if (res.links[0].properties['okta:idp:type'] !== OKTA_IDP_TYPE && res.links[0].href) {\n            const redirectFn = res.links[0].href.includes('OKTA_INVALID_SESSION_REPOST%3Dtrue')\n              ? Util.redirectWithFormGet.bind(Util)\n              : this.settings.get('redirectUtilFn');\n            //override redirectFn to only use Util.redirectWithFormGet if OKTA_INVALID_SESSION_REPOST is included\n            //it will be encoded since it will be included in the encoded fromURI\n\n            redirectFn(res.links[0].href);\n            return;\n          }\n        }\n        options.appState.trigger('navigate', '');\n      })\n      .catch(() => {\n        // TODO: OKTA-436775 Show error instead of navigating to default route\n        options.appState.trigger('navigate', '');\n      });\n  },\n\n});\n"],"names":["BaseLoginController","extend","className","View","Spinner","Model","initialize","OKTA_IDP_TYPE","RESOURCE","options","lastAuthResponse","appState","get","stateToken","webfingerArgs","resource","requestContext","settings","authClient","webfinger","then","res","links","properties","href","redirectFn","includes","Util","redirectWithFormGet","bind","trigger","catch"],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA,kCAAeA,mBAAmB,CAACC,MAApB,CAA2B;AACxCC,EAAAA,SAAS,EAAE,qBAD6B;AAGxCC,EAAAA,IAAI,EAAEC,OAHkC;AAKxCC,EAAAA,KAAK,EAAE,EALiC;AAOxCC,EAAAA,UAAU,EAAE,YAAW;AACrB,IAAMC,MAAAA,aAAa,GAAG,MAAtB,CAAA;AACA,IAAMC,MAAAA,QAAQ,GAAG,YAAjB,CAAA;AAEA,IAAMC,MAAAA,OAAO,GAAG,IAAA,CAAKA,OAArB,CAAA;AACA,IAAMC,MAAAA,gBAAgB,GAAGD,OAAO,CAACE,QAAR,CAAiBC,GAAjB,CAAqB,kBAArB,CAAzB,CAAA;AACA,IAAMC,MAAAA,UAAU,GAAGH,gBAAgB,KAAIA,gBAAJ,KAAIA,IAAAA,IAAAA,gBAAJ,KAAIA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,gBAAgB,CAAEG,UAAtB,CAAnC,CAAA;AAEA,IAAA,MAAMC,aAAa,GAAG;AACpBC,MAAAA,QAAQ,EAAEP,QADU;AAEpBQ,MAAAA,cAAc,EAAEH,UAAAA;AAFI,KAAtB,CAAA;AAKAJ,IAAAA,OAAO,CAACE,QAAR,CAAiBM,QAAjB,CAA0BC,UAA1B,CACGC,SADH,CACaL,aADb,CAAA,CAEGM,IAFH,CAEQC,GAAG,IAAI;AACX,MAAA,IAAIA,GAAG,KAAH,IAAA,IAAAA,GAAG,KAAA,KAAA,CAAH,IAAAA,GAAG,CAAEC,KAAL,IAAcD,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAlB,EAAgC;AAC9B,QAAA,IAAID,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAA,CAAaC,UAAb,CAAwB,eAAxB,MAA6ChB,aAA7C,IAA8Dc,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAA,CAAaE,IAA/E,EAAqF;AACnF,UAAA,MAAMC,UAAU,GAAGJ,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAA,CAAaE,IAAb,CAAkBE,QAAlB,CAA2B,oCAA3B,CACfC,GAAAA,IAAI,CAACC,mBAAL,CAAyBC,IAAzB,CAA8BF,IAA9B,CADe,GAEf,IAAA,CAAKV,QAAL,CAAcL,GAAd,CAAkB,gBAAlB,CAFJ,CADmF;AAKnF;;AAEAa,UAAAA,UAAU,CAACJ,GAAG,CAACC,KAAJ,CAAU,CAAV,CAAaE,CAAAA,IAAd,CAAV,CAAA;AACA,UAAA,OAAA;AACD,SAAA;AACF,OAAA;;AACDf,MAAAA,OAAO,CAACE,QAAR,CAAiBmB,OAAjB,CAAyB,UAAzB,EAAqC,EAArC,CAAA,CAAA;AACD,KAhBH,CAAA,CAiBGC,KAjBH,CAiBS,MAAM;AACX;AACAtB,MAAAA,OAAO,CAACE,QAAR,CAAiBmB,OAAjB,CAAyB,UAAzB,EAAqC,EAArC,CAAA,CAAA;AACD,KApBH,CAAA,CAAA;AAqBD,GAAA;AAzCuC,CAA3B,CAAf;;;;"}
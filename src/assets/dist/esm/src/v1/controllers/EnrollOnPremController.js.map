{"version":3,"file":"EnrollOnPremController.js","sources":["../../../../../src/v1/controllers/EnrollOnPremController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc } from 'okta';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport Util from 'util/Util';\nimport Footer from 'v1/views/enroll-factors/Footer';\nimport TextBox from 'v1/views/shared/TextBox';\n\nfunction isRSA(provider) {\n  return provider === 'RSA';\n}\n\nfunction getClassName(provider) {\n  return isRSA(provider) ? 'enroll-rsa' : 'enroll-onprem';\n}\n\nexport default FormController.extend({\n  className: function() {\n    return getClassName(this.options.provider);\n  },\n  Model: function() {\n    const provider = this.options.provider;\n    const factors = this.options.appState.get('factors');\n    const factor = factors.findWhere(_.pick(this.options, 'provider', 'factorType'));\n    const profile = factor.get('profile');\n    const credentialId = profile && profile.credentialId ? profile.credentialId : '';\n\n    return {\n      props: {\n        credentialId: ['string', true, credentialId],\n        passCode: ['string', true],\n        factorId: 'string',\n      },\n      save: function() {\n        return this.doTransaction(function(transaction) {\n          const factor = _.findWhere(transaction.factors, {\n            factorType: 'token',\n            provider: provider,\n          });\n\n          return factor.enroll({\n            passCode: this.get('passCode'),\n            profile: { credentialId: this.get('credentialId') },\n          });\n        });\n      },\n    };\n  },\n\n  Form: function() {\n    const provider = this.options.provider;\n    const factors = this.options.appState.get('factors');\n    const factor = factors.findWhere(_.pick(this.options, 'provider', 'factorType'));\n    const vendorName = factor.get('vendorName');\n    const title = isRSA(provider) ? loc('factor.totpHard.rsaSecurId', 'login') : vendorName;\n\n    return {\n      title: title,\n      noButtonBar: true,\n      autoSave: true,\n      className: getClassName(provider),\n      initialize: function() {\n        this.listenTo(this.model, 'error', (source, error) => {\n          if (error && error.status === 409) {\n            // 409 means we are in change pin, so we should clear out answer input\n            this.$('.o-form-input-name-passCode input').val('');\n            this.$('.o-form-input-name-passCode input').trigger('change');\n            this.$('.o-form-input-name-passCode input').focus();\n          }\n        });\n      },\n      formChildren: [\n        FormType.Input({\n          label: loc('enroll.onprem.username.placeholder', 'login', [vendorName]),\n          'label-top': true,\n          explain: Util.createInputExplain(\n            'enroll.onprem.username.tooltip',\n            'enroll.onprem.username.placeholder',\n            'login',\n            [vendorName],\n            [vendorName]\n          ),\n          'explain-top': true,\n          name: 'credentialId',\n          input: TextBox,\n          type: 'text',\n        }),\n        FormType.Input({\n          label: loc('enroll.onprem.passcode.placeholder', 'login', [vendorName]),\n          'label-top': true,\n          explain: Util.createInputExplain(\n            'enroll.onprem.passcode.tooltip',\n            'enroll.onprem.passcode.placeholder',\n            'login',\n            [vendorName],\n            [vendorName]\n          ),\n          'explain-top': true,\n          name: 'passCode',\n          input: TextBox,\n          type: 'password',\n        }),\n        FormType.Toolbar({\n          noCancelButton: true,\n          save: loc('mfa.challenge.verify', 'login'),\n        }),\n      ],\n    };\n  },\n\n  Footer: Footer,\n});\n"],"names":["isRSA","provider","getClassName","FormController","extend","className","options","Model","factors","appState","get","factor","findWhere","_","pick","profile","credentialId","props","passCode","factorId","save","doTransaction","transaction","factorType","enroll","Form","vendorName","title","loc","noButtonBar","autoSave","initialize","listenTo","model","source","error","status","$","val","trigger","focus","formChildren","FormType","Input","label","explain","Util","createInputExplain","name","input","TextBox","type","Toolbar","noCancelButton","Footer"],"mappings":"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"}
{"version":3,"file":"EnrollTotpController.js","sources":["../../../../../src/v1/controllers/EnrollTotpController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, View, loc } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport FactorUtil from 'util/FactorUtil';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport StoreLinks from 'v1/util/StoreLinks';\nimport Footer from 'v1/views/enroll-factors/Footer';\nconst showWhenDeviceTypeSelected = {\n  __deviceType__: function(val) {\n    return val !== undefined;\n  },\n};\nconst EnrollTotpControllerAppDownloadInstructionsView = View.extend({\n  attributes: { 'data-se': 'app-download-instructions' },\n  className: 'app-download-instructions',\n  template: hbs(\n    '\\\n      <span class=\"app-logo {{appIcon}}\"></span>\\\n      <p class=\"instructions\">{{{appStoreLinkText}}}</p>\\\n    '\n  ),\n  initialize: function() {\n    this.listenTo(this.model, 'change:__deviceType__', this.render);\n  },\n  postRender: function() {\n    const link  = this.$el.find('.instructions a');\n    if (link.length) {\n      link[0].setAttribute('target', '_blank');\n      link[0].setAttribute('rel', 'noreferer noopener');\n    }\n  },\n  getTemplateData: function() {\n    let appStoreLink;\n    let appIcon;\n    let appStoreName;\n    const factorName = FactorUtil.getFactorLabel(this.model.get('__provider__'), this.model.get('__factorType__'));\n\n    appStoreName = StoreLinks.STORE[this.model.get('__deviceType__')];\n    if (this.model.get('__provider__') === 'GOOGLE') {\n      appStoreLink = StoreLinks.GOOGLE[this.model.get('__deviceType__')];\n      appIcon = 'google-auth-38';\n    } else {\n      appStoreLink = StoreLinks.OKTA[this.model.get('__deviceType__')];\n      appIcon = 'okta-verify-download-icon';\n    }\n    return {\n      appStoreLinkText: loc('enroll.totp.downloadApp', 'login', [appStoreLink, factorName, appStoreName]),\n      appIcon: appIcon,\n    };\n  },\n});\nconst EnrollTotpControllerEnrollTotpController = FormController.extend({\n  className: 'enroll-totp',\n  Model: function() {\n    return {\n      local: {\n        __deviceType__: 'string',\n        __factorType__: ['string', false, this.options.factorType],\n        __provider__: ['string', false, this.options.provider],\n      },\n      save: function() {\n        return this.doTransaction(function(transaction) {\n          const factor = _.findWhere(transaction.factors, {\n            factorType: this.get('__factorType__'),\n            provider: this.get('__provider__'),\n          });\n\n          return factor.enroll();\n        });\n      },\n    };\n  },\n\n  Form: {\n    title: function() {\n      const factorName = FactorUtil.getFactorLabel(this.model.get('__provider__'), this.model.get('__factorType__'));\n\n      return loc('enroll.totp.title', 'login', [factorName]);\n    },\n    noButtonBar: true,\n    attributes: { 'data-se': 'step-device-type' },\n\n    formChildren: function() {\n      const inputOptions = {\n        APPLE: loc('iphone', 'login'),\n        ANDROID: loc('android', 'login'),\n      };\n      const children = [\n        FormType.Input({\n          name: '__deviceType__',\n          type: 'radio',\n          options: inputOptions,\n          group: true,\n          label: _.partial(loc, 'enroll.totp.selectDevice', 'login'),\n        }),\n        FormType.Divider({ showWhen: showWhenDeviceTypeSelected }),\n        FormType.View({\n          View: EnrollTotpControllerAppDownloadInstructionsView,\n          showWhen: showWhenDeviceTypeSelected,\n        }),\n        FormType.Button({\n          title: loc('oform.next', 'login'),\n          attributes: {\n            'data-type': 'save'\n          },\n          className: 'button button-primary default-custom-button',\n          click: function() {\n            this.model.save();\n          },\n          showWhen: showWhenDeviceTypeSelected,\n        }),\n      ];\n\n      return children;\n    },\n  },\n\n  Footer: Footer,\n});\nexport default EnrollTotpControllerEnrollTotpController;\n"],"names":["showWhenDeviceTypeSelected","__deviceType__","val","undefined","EnrollTotpControllerAppDownloadInstructionsView","View","extend","attributes","className","template","initialize","listenTo","model","render","postRender","link","$el","find","length","setAttribute","getTemplateData","appStoreLink","appIcon","appStoreName","factorName","FactorUtil","getFactorLabel","get","StoreLinks","STORE","GOOGLE","OKTA","appStoreLinkText","loc","EnrollTotpControllerEnrollTotpController","FormController","Model","local","__factorType__","options","factorType","__provider__","provider","save","doTransaction","transaction","factor","_","findWhere","factors","enroll","Form","title","noButtonBar","formChildren","inputOptions","APPLE","ANDROID","children","FormType","Input","name","type","group","label","partial","Divider","showWhen","Button","click","Footer"],"mappings":"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"}
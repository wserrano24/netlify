{"version":3,"file":"ManualSetupPushController.js","sources":["../../../../../src/v1/controllers/ManualSetupPushController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc, View } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport CountryUtil from 'util/CountryUtil';\nimport FactorUtil from 'util/FactorUtil';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport RouterUtil from 'v1/util/RouterUtil';\nimport Footer from 'v1/views/enroll-factors/ManualSetupPushFooter';\nimport PhoneTextBox from 'v1/views/enroll-factors/PhoneTextBox';\n\nfunction goToFactorActivation(view, step) {\n  const url = RouterUtil.createActivateFactorUrl(\n    view.options.appState.get('activatedFactorProvider'),\n    view.options.appState.get('activatedFactorType'),\n    step\n  );\n\n  view.options.appState.trigger('navigate', url);\n}\n\nfunction setStateValues(view) {\n  let userPhoneNumber;\n  let userCountryCode;\n\n  if (view.model.get('activationType') === 'SMS') {\n    userCountryCode = view.model.get('countryCode');\n    userPhoneNumber = view.model.get('phoneNumber');\n  }\n  view.options.appState.set({\n    factorActivationType: view.model.get('activationType'),\n    userCountryCode: userCountryCode,\n    userPhoneNumber: userPhoneNumber,\n  });\n}\n\nfunction enrollFactor(view, factorType) {\n  return view.model.doTransaction(function(transaction) {\n    return transaction\n      .prev()\n      .then(function(trans) {\n        const factor = _.findWhere(trans.factors, {\n          factorType: factorType,\n          provider: 'OKTA',\n        });\n\n        return factor.enroll();\n      })\n      .then(function(trans) {\n        let textActivationLinkUrl;\n        let emailActivationLinkUrl;\n        let sharedSecret;\n        const res = trans.data;\n\n        if (\n          res &&\n          res._embedded &&\n          res._embedded.factor &&\n          res._embedded.factor._embedded &&\n          res._embedded.factor._embedded.activation\n        ) {\n          const factor = res._embedded.factor;\n\n          // Shared secret\n          sharedSecret = factor._embedded.activation.sharedSecret;\n\n          if (factor._embedded.activation._links && factor._embedded.activation._links.send) {\n            const activationSendLinks = factor._embedded.activation._links.send;\n\n            const smsItem = _.findWhere(activationSendLinks, { name: 'sms' });\n\n            // SMS activation url\n\n            textActivationLinkUrl = smsItem ? smsItem.href : null;\n\n            // Email activation url\n\n            const emailItem = _.findWhere(activationSendLinks, { name: 'email' });\n\n            emailActivationLinkUrl = emailItem ? emailItem.href : null;\n          }\n        }\n\n        view.model.set({\n          SMS: textActivationLinkUrl,\n          EMAIL: emailActivationLinkUrl,\n          sharedSecret: sharedSecret,\n        });\n\n        return trans;\n      });\n  });\n}\n\nexport default FormController.extend({\n  className: 'enroll-manual-push',\n  Model: function() {\n    return {\n      local: {\n        activationType: ['string', true, this.options.appState.get('factorActivationType') || 'SMS'],\n        countryCode: ['string', false, this.options.appState.get('userCountryCode')],\n        phoneNumber: 'string',\n        SMS: ['string', false, this.options.appState.get('textActivationLinkUrl')],\n        EMAIL: ['string', false, this.options.appState.get('emailActivationLinkUrl')],\n        sharedSecret: ['string', false, this.options.appState.get('sharedSecret')],\n        __factorType__: ['string', false, this.options.factorType],\n        __provider__: ['string', false, this.options.provider],\n      },\n      derived: {\n        countryCallingCode: {\n          deps: ['countryCode'],\n          fn: function(countryCode) {\n            return '+' + CountryUtil.getCallingCodeForCountry(countryCode);\n          },\n        },\n        fullPhoneNumber: {\n          deps: ['countryCallingCode', 'phoneNumber'],\n          fn: function(countryCallingCode, phoneNumber) {\n            return countryCallingCode + phoneNumber;\n          },\n        },\n      },\n    };\n  },\n\n  Form: {\n    title: function() {\n      const factorName = FactorUtil.getFactorLabel(this.model.get('__provider__'), this.model.get('__factorType__'));\n\n      return loc('enroll.totp.title', 'login', [factorName]);\n    },\n    subtitle: _.partial(loc, 'enroll.totp.cannotScanBarcode', 'login'),\n    noButtonBar: true,\n    attributes: { 'data-se': 'step-manual-setup' },\n\n    formChildren: function() {\n      const instructions = this.settings.get('brandName')\n        ? loc('enroll.totp.sharedSecretInstructions.specific', 'login', [this.settings.get('brandName')])\n        : loc('enroll.totp.sharedSecretInstructions.generic', 'login');\n      const children = [\n        FormType.Input({\n          name: 'activationType',\n          label:loc('mfa.setupOptions', 'login'),\n          type: 'select',\n          wide: true,\n          options: {\n            SMS: loc('enroll.totp.sendSms', 'login'),\n            EMAIL: loc('enroll.totp.sendEmail', 'login'),\n            MANUAL: loc('enroll.totp.setupManually', 'login'),\n          },\n        }),\n        FormType.Input({\n          label:loc('mfa.country', 'login'),\n          name: 'countryCode',\n          type: 'select',\n          wide: true,\n          options: CountryUtil.getCountries(),\n          showWhen: { activationType: 'SMS' },\n        }),\n        FormType.Input({\n          label: loc('mfa.phoneNumber.placeholder', 'login'),\n          'label-top': true,\n          className: 'enroll-sms-phone',\n          name: 'phoneNumber',\n          input: PhoneTextBox,\n          type: 'text',\n          showWhen: { activationType: 'SMS' },\n        }),\n        FormType.View({\n          View: View.extend({\n            className: 'secret-key-instructions',\n            attributes: { 'data-se': 'secret-key-instructions'},\n            template: hbs`\n             <section aria-live=\"assertive\">\n                <p  class=\"okta-form-subtitle o-form-explain text-align-c\">\n                  {{instructions}}\n                </p>\n                <p class=\"shared-key margin-top-10\" tabindex=0 \n                aria-label=\"{{i18n code=\"enroll.totp.sharedSecretInstructions.aria.secretKey\" bundle=\"login\"\n                arguments=\"sharedSecretKey\"}}\">{{sharedSecretKey}}</p>\n              </section>\n              `,\n            initialize: function(){\n              this.listenTo(this.model, 'change:sharedSecret', this.render);\n            },\n            getTemplateData: function() {\n              return {\n                instructions: instructions,\n                sharedSecretKey: this.model.get('sharedSecret')\n              };\n            },\n          }),\n          showWhen: { activationType: 'MANUAL' },\n        }),\n        FormType.View({\n          View: View.extend({\n            template: hbs('<div data-type=\"next-button-wrap\"></div>'),\n          }),\n          showWhen: { activationType: 'MANUAL' },\n        }),\n        FormType.Button(\n          {\n            title: loc('oform.next', 'login'),\n            className: 'button button-primary button-wide button-next',\n            attributes: { 'data-se': 'next-button' },\n            click: () => {\n              setStateValues(this);\n              goToFactorActivation(this, 'passcode');\n            },\n          },\n          '[data-type=\"next-button-wrap\"]'\n        ),\n        FormType.Toolbar({\n          noCancelButton: true,\n          save: loc('oform.send', 'login'),\n          showWhen: {\n            activationType: function(val) {\n              return val === 'SMS' || val === 'EMAIL';\n            },\n          },\n        }),\n      ];\n\n      return children;\n    },\n  },\n\n  Footer: Footer,\n\n  initialize: function() {\n    this.setInitialModel();\n    // Move this logic to a model when AuthClient supports sending email and sms\n    this.listenTo(this.form, 'save', function() {\n      const self = this;\n\n      this.model.doTransaction(function(transaction) {\n        const activationType = this.get('activationType').toLowerCase();\n        const opts = {};\n\n        if (activationType === 'sms') {\n          opts.profile = { phoneNumber: this.get('fullPhoneNumber') };\n        }\n\n        return transaction.factor.activation.send(activationType, opts).then(function(trans) {\n          setStateValues(self);\n          // Note: Need to defer because OktaAuth calls our router success\n          // handler on the next tick - if we immediately called, appState would\n          // still be populated with the last response\n          _.defer(function() {\n            goToFactorActivation(self, 'sent');\n          });\n          return trans;\n        });\n      });\n    });\n\n    this.listenTo(this.model, 'change:activationType', function(model, value) {\n      this.form.clearErrors();\n      if (value === 'MANUAL' && this.options.appState.get('activatedFactorType') !== 'token:software:totp') {\n        enrollFactor(this, 'token:software:totp');\n      } else if (this.options.appState.get('activatedFactorType') !== 'push') {\n        enrollFactor(this, 'push');\n      }\n    });\n  },\n\n  setInitialModel: function() {\n    if (this.options.appState.get('factorActivationType') === 'SMS') {\n      this.model.set({\n        countryCode: this.options.appState.get('userCountryCode') || 'US',\n        phoneNumber: this.options.appState.get('userPhoneNumber'),\n      });\n    }\n  },\n\n  trapAuthResponse: function() {\n    if (this.options.appState.get('isMfaEnrollActivate') || this.options.appState.get('isMfaEnroll')) {\n      return true;\n    }\n  },\n});\n"],"names":["goToFactorActivation","view","step","url","RouterUtil","createActivateFactorUrl","options","appState","get","trigger","setStateValues","userPhoneNumber","userCountryCode","model","set","factorActivationType","enrollFactor","factorType","doTransaction","transaction","prev","then","trans","factor","_","findWhere","factors","provider","enroll","textActivationLinkUrl","emailActivationLinkUrl","sharedSecret","res","data","_embedded","activation","_links","send","activationSendLinks","smsItem","name","href","emailItem","SMS","EMAIL","FormController","extend","className","Model","local","activationType","countryCode","phoneNumber","__factorType__","__provider__","derived","countryCallingCode","deps","fn","CountryUtil","getCallingCodeForCountry","fullPhoneNumber","Form","title","factorName","FactorUtil","getFactorLabel","loc","subtitle","partial","noButtonBar","attributes","formChildren","instructions","settings","children","FormType","Input","label","type","wide","MANUAL","getCountries","showWhen","input","PhoneTextBox","View","template","initialize","listenTo","render","getTemplateData","sharedSecretKey","Button","click","Toolbar","noCancelButton","save","val","Footer","setInitialModel","form","self","toLowerCase","opts","profile","defer","value","clearErrors","trapAuthResponse"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAsBA,SAASA,oBAAT,CAA8BC,IAA9B,EAAoCC,IAApC,EAA0C;AACxC,EAAA,MAAMC,GAAG,GAAGC,IAAU,CAACC,uBAAX,CACVJ,IAAI,CAACK,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,yBAA1B,CADU,EAEVP,IAAI,CAACK,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,qBAA1B,CAFU,EAGVN,IAHU,CAAZ,CAAA;AAMAD,EAAAA,IAAI,CAACK,OAAL,CAAaC,QAAb,CAAsBE,OAAtB,CAA8B,UAA9B,EAA0CN,GAA1C,CAAA,CAAA;AACD,CAAA;;AAED,SAASO,cAAT,CAAwBT,IAAxB,EAA8B;AAC5B,EAAA,IAAIU,eAAJ,CAAA;AACA,EAAA,IAAIC,eAAJ,CAAA;;AAEA,EAAIX,IAAAA,IAAI,CAACY,KAAL,CAAWL,GAAX,CAAe,gBAAf,CAAqC,KAAA,KAAzC,EAAgD;AAC9CI,IAAAA,eAAe,GAAGX,IAAI,CAACY,KAAL,CAAWL,GAAX,CAAe,aAAf,CAAlB,CAAA;AACAG,IAAAA,eAAe,GAAGV,IAAI,CAACY,KAAL,CAAWL,GAAX,CAAe,aAAf,CAAlB,CAAA;AACD,GAAA;;AACDP,EAAAA,IAAI,CAACK,OAAL,CAAaC,QAAb,CAAsBO,GAAtB,CAA0B;AACxBC,IAAAA,oBAAoB,EAAEd,IAAI,CAACY,KAAL,CAAWL,GAAX,CAAe,gBAAf,CADE;AAExBI,IAAAA,eAAe,EAAEA,eAFO;AAGxBD,IAAAA,eAAe,EAAEA,eAAAA;AAHO,GAA1B,CAAA,CAAA;AAKD,CAAA;;AAED,SAASK,YAAT,CAAsBf,IAAtB,EAA4BgB,UAA5B,EAAwC;AACtC,EAAOhB,OAAAA,IAAI,CAACY,KAAL,CAAWK,aAAX,CAAyB,UAASC,WAAT,EAAsB;AACpD,IAAOA,OAAAA,WAAW,CACfC,IADI,EAAA,CAEJC,IAFI,CAEC,UAASC,KAAT,EAAgB;AACpB,MAAMC,MAAAA,MAAM,GAAGC,cAAC,CAACC,SAAF,CAAYH,KAAK,CAACI,OAAlB,EAA2B;AACxCT,QAAAA,UAAU,EAAEA,UAD4B;AAExCU,QAAAA,QAAQ,EAAE,MAAA;AAF8B,OAA3B,CAAf,CAAA;;AAKA,MAAOJ,OAAAA,MAAM,CAACK,MAAP,EAAP,CAAA;AACD,KATI,CAUJP,CAAAA,IAVI,CAUC,UAASC,KAAT,EAAgB;AACpB,MAAA,IAAIO,qBAAJ,CAAA;AACA,MAAA,IAAIC,sBAAJ,CAAA;AACA,MAAA,IAAIC,YAAJ,CAAA;AACA,MAAA,MAAMC,GAAG,GAAGV,KAAK,CAACW,IAAlB,CAAA;;AAEA,MAAA,IACED,GAAG,IACHA,GAAG,CAACE,SADJ,IAEAF,GAAG,CAACE,SAAJ,CAAcX,MAFd,IAGAS,GAAG,CAACE,SAAJ,CAAcX,MAAd,CAAqBW,SAHrB,IAIAF,GAAG,CAACE,SAAJ,CAAcX,MAAd,CAAqBW,SAArB,CAA+BC,UALjC,EAME;AACA,QAAMZ,MAAAA,MAAM,GAAGS,GAAG,CAACE,SAAJ,CAAcX,MAA7B,CADA;;AAIAQ,QAAAA,YAAY,GAAGR,MAAM,CAACW,SAAP,CAAiBC,UAAjB,CAA4BJ,YAA3C,CAAA;;AAEA,QAAA,IAAIR,MAAM,CAACW,SAAP,CAAiBC,UAAjB,CAA4BC,MAA5B,IAAsCb,MAAM,CAACW,SAAP,CAAiBC,UAAjB,CAA4BC,MAA5B,CAAmCC,IAA7E,EAAmF;AACjF,UAAMC,MAAAA,mBAAmB,GAAGf,MAAM,CAACW,SAAP,CAAiBC,UAAjB,CAA4BC,MAA5B,CAAmCC,IAA/D,CAAA;;AAEA,UAAA,MAAME,OAAO,GAAGf,cAAC,CAACC,SAAF,CAAYa,mBAAZ,EAAiC;AAAEE,YAAAA,IAAI,EAAE,KAAA;AAAR,WAAjC,CAAhB,CAHiF;;;AAOjFX,UAAAA,qBAAqB,GAAGU,OAAO,GAAGA,OAAO,CAACE,IAAX,GAAkB,IAAjD,CAPiF;;AAWjF,UAAA,MAAMC,SAAS,GAAGlB,cAAC,CAACC,SAAF,CAAYa,mBAAZ,EAAiC;AAAEE,YAAAA,IAAI,EAAE,OAAA;AAAR,WAAjC,CAAlB,CAAA;;AAEAV,UAAAA,sBAAsB,GAAGY,SAAS,GAAGA,SAAS,CAACD,IAAb,GAAoB,IAAtD,CAAA;AACD,SAAA;AACF,OAAA;;AAEDxC,MAAAA,IAAI,CAACY,KAAL,CAAWC,GAAX,CAAe;AACb6B,QAAAA,GAAG,EAAEd,qBADQ;AAEbe,QAAAA,KAAK,EAAEd,sBAFM;AAGbC,QAAAA,YAAY,EAAEA,YAAAA;AAHD,OAAf,CAAA,CAAA;AAMA,MAAA,OAAOT,KAAP,CAAA;AACD,KApDI,CAAP,CAAA;AAqDD,GAtDM,CAAP,CAAA;AAuDD,CAAA;;AAED,gCAAeuB,cAAc,CAACC,MAAf,CAAsB;AACnCC,EAAAA,SAAS,EAAE,oBADwB;AAEnCC,EAAAA,KAAK,EAAE,YAAW;AAChB,IAAO,OAAA;AACLC,MAAAA,KAAK,EAAE;AACLC,QAAAA,cAAc,EAAE,CAAC,QAAD,EAAW,IAAX,EAAiB,IAAA,CAAK5C,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,sBAA1B,CAAA,IAAqD,KAAtE,CADX;AAEL2C,QAAAA,WAAW,EAAE,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAA,CAAK7C,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,iBAA1B,CAAlB,CAFR;AAGL4C,QAAAA,WAAW,EAAE,QAHR;AAILT,QAAAA,GAAG,EAAE,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAA,CAAKrC,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,uBAA1B,CAAlB,CAJA;AAKLoC,QAAAA,KAAK,EAAE,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAA,CAAKtC,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,wBAA1B,CAAlB,CALF;AAMLuB,QAAAA,YAAY,EAAE,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAA,CAAKzB,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,cAA1B,CAAlB,CANT;AAOL6C,QAAAA,cAAc,EAAE,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAK/C,CAAAA,OAAL,CAAaW,UAA/B,CAPX;AAQLqC,QAAAA,YAAY,EAAE,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAA,CAAKhD,OAAL,CAAaqB,QAA/B,CAAA;AART,OADF;AAWL4B,MAAAA,OAAO,EAAE;AACPC,QAAAA,kBAAkB,EAAE;AAClBC,UAAAA,IAAI,EAAE,CAAC,aAAD,CADY;AAElBC,UAAAA,EAAE,EAAE,UAASP,WAAT,EAAsB;AACxB,YAAA,OAAO,MAAMQ,EAAW,CAACC,wBAAZ,CAAqCT,WAArC,CAAb,CAAA;AACD,WAAA;AAJiB,SADb;AAOPU,QAAAA,eAAe,EAAE;AACfJ,UAAAA,IAAI,EAAE,CAAC,oBAAD,EAAuB,aAAvB,CADS;AAEfC,UAAAA,EAAE,EAAE,UAASF,kBAAT,EAA6BJ,WAA7B,EAA0C;AAC5C,YAAOI,OAAAA,kBAAkB,GAAGJ,WAA5B,CAAA;AACD,WAAA;AAJc,SAAA;AAPV,OAAA;AAXJ,KAAP,CAAA;AA0BD,GA7BkC;AA+BnCU,EAAAA,IAAI,EAAE;AACJC,IAAAA,KAAK,EAAE,YAAW;AAChB,MAAMC,MAAAA,UAAU,GAAGC,IAAU,CAACC,cAAX,CAA0B,IAAA,CAAKrD,KAAL,CAAWL,GAAX,CAAe,cAAf,CAA1B,EAA0D,IAAKK,CAAAA,KAAL,CAAWL,GAAX,CAAe,gBAAf,CAA1D,CAAnB,CAAA;AAEA,MAAO2D,OAAAA,GAAG,CAAC,mBAAD,EAAsB,OAAtB,EAA+B,CAACH,UAAD,CAA/B,CAAV,CAAA;AACD,KALG;AAMJI,IAAAA,QAAQ,EAAE5C,cAAC,CAAC6C,OAAF,CAAUF,GAAV,EAAe,+BAAf,EAAgD,OAAhD,CANN;AAOJG,IAAAA,WAAW,EAAE,IAPT;AAQJC,IAAAA,UAAU,EAAE;AAAE,MAAW,SAAA,EAAA,mBAAA;AAAb,KARR;AAUJC,IAAAA,YAAY,EAAE,YAAW;AACvB,MAAA,MAAMC,YAAY,GAAG,IAAKC,CAAAA,QAAL,CAAclE,GAAd,CAAkB,WAAlB,CACjB2D,GAAAA,GAAG,CAAC,+CAAD,EAAkD,OAAlD,EAA2D,CAAC,IAAA,CAAKO,QAAL,CAAclE,GAAd,CAAkB,WAAlB,CAAD,CAA3D,CADc,GAEjB2D,GAAG,CAAC,8CAAD,EAAiD,OAAjD,CAFP,CAAA;AAGA,MAAA,MAAMQ,QAAQ,GAAG,CACfC,QAAQ,CAACC,KAAT,CAAe;AACbrC,QAAAA,IAAI,EAAE,gBADO;AAEbsC,QAAAA,KAAK,EAACX,GAAG,CAAC,kBAAD,EAAqB,OAArB,CAFI;AAGbY,QAAAA,IAAI,EAAE,QAHO;AAIbC,QAAAA,IAAI,EAAE,IAJO;AAKb1E,QAAAA,OAAO,EAAE;AACPqC,UAAAA,GAAG,EAAEwB,GAAG,CAAC,qBAAD,EAAwB,OAAxB,CADD;AAEPvB,UAAAA,KAAK,EAAEuB,GAAG,CAAC,uBAAD,EAA0B,OAA1B,CAFH;AAGPc,UAAAA,MAAM,EAAEd,GAAG,CAAC,2BAAD,EAA8B,OAA9B,CAAA;AAHJ,SAAA;AALI,OAAf,CADe,EAYfS,QAAQ,CAACC,KAAT,CAAe;AACbC,QAAAA,KAAK,EAACX,GAAG,CAAC,aAAD,EAAgB,OAAhB,CADI;AAEb3B,QAAAA,IAAI,EAAE,aAFO;AAGbuC,QAAAA,IAAI,EAAE,QAHO;AAIbC,QAAAA,IAAI,EAAE,IAJO;AAKb1E,QAAAA,OAAO,EAAEqD,EAAW,CAACuB,YAAZ,EALI;AAMbC,QAAAA,QAAQ,EAAE;AAAEjC,UAAAA,cAAc,EAAE,KAAA;AAAlB,SAAA;AANG,OAAf,CAZe,EAoBf0B,QAAQ,CAACC,KAAT,CAAe;AACbC,QAAAA,KAAK,EAAEX,GAAG,CAAC,6BAAD,EAAgC,OAAhC,CADG;AAEb,QAAA,WAAA,EAAa,IAFA;AAGbpB,QAAAA,SAAS,EAAE,kBAHE;AAIbP,QAAAA,IAAI,EAAE,aAJO;AAKb4C,QAAAA,KAAK,EAAEC,YALM;AAMbN,QAAAA,IAAI,EAAE,MANO;AAObI,QAAAA,QAAQ,EAAE;AAAEjC,UAAAA,cAAc,EAAE,KAAA;AAAlB,SAAA;AAPG,OAAf,CApBe,EA6Bf0B,QAAQ,CAACU,IAAT,CAAc;AACZA,QAAAA,IAAI,EAAEA,IAAI,CAACxC,MAAL,CAAY;AAChBC,UAAAA,SAAS,EAAE,yBADK;AAEhBwB,UAAAA,UAAU,EAAE;AAAE,YAAW,SAAA,EAAA,yBAAA;AAAb,WAFI;AAGhBgB,UAAAA,QAAQ,EAAA,YAAA,CAAA,QAAA,CAAA;AAAA,YAAA,UAAA,EAAA,CAAA,CAAA,EAAA,UAAA,CAAA;AAAA,YAAA,MAAA,EAAA,UAAA,SAAA,EAAA,MAAA,EAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAA;AAAA,cAAA,IAAA,MAAA;AAAA,kBAAA,MAAA,GAAA,MAAA,IAAA,IAAA,GAAA,MAAA,GAAA,SAAA,CAAA,WAAA,IAAA,EAAA;AAAA,kBAAA,MAAA,GAAA,SAAA,CAAA,KAAA,CAAA,aAAA;AAAA,kBAAA,MAAA,GAAA,UAAA;AAAA,kBAAA,MAAA,GAAA,SAAA,CAAA,gBAAA;AAAA,kBAAA,cAAA,GAAA,SAAA,CAAA,cAAA,IAAA,UAAA,MAAA,EAAA,YAAA,EAAA;AAAA,gBAAA,IAAA,MAAA,CAAA,SAAA,CAAA,cAAA,CAAA,IAAA,CAAA,MAAA,EAAA,YAAA,CAAA,EAAA;AAAA,kBAAA,OAAA,MAAA,CAAA,YAAA,CAAA,CAAA;AAAA,iBAAA;;AAAA,gBAAA,OAAA,SAAA,CAAA;AAAA,eAAA,CAAA;;AAAA,cAAA,OAAA,+FAAA,GAAA,MAAA,EAAA,MAAA,GAAA,CAAA,MAAA,GAAA,cAAA,CAAA,OAAA,EAAA,cAAA,CAAA,KAAA,MAAA,IAAA,IAAA,GAAA,cAAA,CAAA,MAAA,EAAA,cAAA,CAAA,GAAA,MAAA,CAAA,KAAA,IAAA,GAAA,MAAA,GAAA,MAAA,EAAA,OAAA,MAAA,KAAA,MAAA,GAAA,MAAA,CAAA,IAAA,CAAA,MAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,cAAA;AAAA,gBAAA,MAAA,EAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,IAAA;AAAA,gBAAA,KAAA,EAAA;AAAA,kBAAA,OAAA,EAAA;AAAA,oBAAA,MAAA,EAAA,CAAA;AAAA,oBAAA,QAAA,EAAA,EAAA;AAAA,mBAAA;AAAA,kBAAA,KAAA,EAAA;AAAA,oBAAA,MAAA,EAAA,CAAA;AAAA,oBAAA,QAAA,EAAA,GAAA;AAAA,mBAAA;AAAA,iBAAA;AAAA,eAAA,CAAA,GAAA,MAAA,EAAA,GAAA,oEAAA,GAAA,MAAA,CAAA,CAAA,cAAA,CAAA,OAAA,EAAA,MAAA,CAAA,IAAA,MAAA,IAAA,cAAA,CAAA,MAAA,EAAA,MAAA,CAAA,IAAA,MAAA,EAAA,IAAA,CAAA,MAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,MAAA;AAAA,gBAAA,MAAA,EAAA;AAAA,kBAAA,WAAA,EAAA,iBAAA;AAAA,kBAAA,QAAA,EAAA,OAAA;AAAA,kBAAA,MAAA,EAAA,qDAAA;AAAA,iBAAA;AAAA,gBAAA,MAAA,EAAA,IAAA;AAAA,gBAAA,KAAA,EAAA;AAAA,kBAAA,OAAA,EAAA;AAAA,oBAAA,MAAA,EAAA,CAAA;AAAA,oBAAA,QAAA,EAAA,GAAA;AAAA,mBAAA;AAAA,kBAAA,KAAA,EAAA;AAAA,oBAAA,MAAA,EAAA,CAAA;AAAA,oBAAA,QAAA,EAAA,GAAA;AAAA,mBAAA;AAAA,iBAAA;AAAA,eAAA,CAAA,CAAA,GAAA,KAAA,GAAA,MAAA,EAAA,MAAA,GAAA,CAAA,MAAA,GAAA,cAAA,CAAA,OAAA,EAAA,iBAAA,CAAA,KAAA,MAAA,IAAA,IAAA,GAAA,cAAA,CAAA,MAAA,EAAA,iBAAA,CAAA,GAAA,MAAA,CAAA,KAAA,IAAA,GAAA,MAAA,GAAA,MAAA,EAAA,OAAA,MAAA,KAAA,MAAA,GAAA,MAAA,CAAA,IAAA,CAAA,MAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,iBAAA;AAAA,gBAAA,MAAA,EAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,IAAA;AAAA,gBAAA,KAAA,EAAA;AAAA,kBAAA,OAAA,EAAA;AAAA,oBAAA,MAAA,EAAA,CAAA;AAAA,oBAAA,QAAA,EAAA,GAAA;AAAA,mBAAA;AAAA,kBAAA,KAAA,EAAA;AAAA,oBAAA,MAAA,EAAA,CAAA;AAAA,oBAAA,QAAA,EAAA,GAAA;AAAA,mBAAA;AAAA,iBAAA;AAAA,eAAA,CAAA,GAAA,MAAA,EAAA,GAAA,gBAAA,CAAA;AAAA,aAAA;AAAA,YAAA,SAAA,EAAA,IAAA;AAAA,WAHQ,CAAA;AAahBC,UAAAA,UAAU,EAAE,YAAU;AACpB,YAAKC,IAAAA,CAAAA,QAAL,CAAc,IAAK5E,CAAAA,KAAnB,EAA0B,qBAA1B,EAAiD,KAAK6E,MAAtD,CAAA,CAAA;AACD,WAfe;AAgBhBC,UAAAA,eAAe,EAAE,YAAW;AAC1B,YAAO,OAAA;AACLlB,cAAAA,YAAY,EAAEA,YADT;AAELmB,cAAAA,eAAe,EAAE,IAAA,CAAK/E,KAAL,CAAWL,GAAX,CAAe,cAAf,CAAA;AAFZ,aAAP,CAAA;AAID,WAAA;AArBe,SAAZ,CADM;AAwBZ2E,QAAAA,QAAQ,EAAE;AAAEjC,UAAAA,cAAc,EAAE,QAAA;AAAlB,SAAA;AAxBE,OAAd,CA7Be,EAuDf0B,QAAQ,CAACU,IAAT,CAAc;AACZA,QAAAA,IAAI,EAAEA,IAAI,CAACxC,MAAL,CAAY;AAChByC,UAAAA,QAAQ,EAAA,YAAA,CAAA,QAAA,CAAA;AAAA,YAAA,UAAA,EAAA,CAAA,CAAA,EAAA,UAAA,CAAA;AAAA,YAAA,MAAA,EAAA,UAAA,SAAA,EAAA,MAAA,EAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAA;AAAA,cAAA,OAAA,4CAAA,CAAA;AAAA,aAAA;AAAA,YAAA,SAAA,EAAA,IAAA;AAAA,WAAA,CAAA;AADQ,SAAZ,CADM;AAIZJ,QAAAA,QAAQ,EAAE;AAAEjC,UAAAA,cAAc,EAAE,QAAA;AAAlB,SAAA;AAJE,OAAd,CAvDe,EA6Df0B,QAAQ,CAACiB,MAAT,CACE;AACE9B,QAAAA,KAAK,EAAEI,GAAG,CAAC,YAAD,EAAe,OAAf,CADZ;AAEEpB,QAAAA,SAAS,EAAE,+CAFb;AAGEwB,QAAAA,UAAU,EAAE;AAAE,UAAW,SAAA,EAAA,aAAA;AAAb,SAHd;AAIEuB,QAAAA,KAAK,EAAE,MAAM;AACXpF,UAAAA,cAAc,CAAC,IAAD,CAAd,CAAA;AACAV,UAAAA,oBAAoB,CAAC,IAAD,EAAO,UAAP,CAApB,CAAA;AACD,SAAA;AAPH,OADF,EAUE,gCAVF,CA7De,EAyEf4E,QAAQ,CAACmB,OAAT,CAAiB;AACfC,QAAAA,cAAc,EAAE,IADD;AAEfC,QAAAA,IAAI,EAAE9B,GAAG,CAAC,YAAD,EAAe,OAAf,CAFM;AAGfgB,QAAAA,QAAQ,EAAE;AACRjC,UAAAA,cAAc,EAAE,UAASgD,GAAT,EAAc;AAC5B,YAAA,OAAOA,GAAG,KAAK,KAAR,IAAiBA,GAAG,KAAK,OAAhC,CAAA;AACD,WAAA;AAHO,SAAA;AAHK,OAAjB,CAzEe,CAAjB,CAAA;AAoFA,MAAA,OAAOvB,QAAP,CAAA;AACD,KAAA;AAnGG,GA/B6B;AAqInCwB,EAAAA,MAAM,EAAEA,MArI2B;AAuInCX,EAAAA,UAAU,EAAE,YAAW;AACrB,IAAKY,IAAAA,CAAAA,eAAL,GADqB;;AAGrB,IAAA,IAAA,CAAKX,QAAL,CAAc,IAAA,CAAKY,IAAnB,EAAyB,MAAzB,EAAiC,YAAW;AAC1C,MAAMC,MAAAA,IAAI,GAAG,IAAb,CAAA;AAEA,MAAA,IAAA,CAAKzF,KAAL,CAAWK,aAAX,CAAyB,UAASC,WAAT,EAAsB;AAC7C,QAAM+B,MAAAA,cAAc,GAAG,IAAK1C,CAAAA,GAAL,CAAS,gBAAT,CAAA,CAA2B+F,WAA3B,EAAvB,CAAA;AACA,QAAMC,MAAAA,IAAI,GAAG,EAAb,CAAA;;AAEA,QAAItD,IAAAA,cAAc,KAAK,KAAvB,EAA8B;AAC5BsD,UAAAA,IAAI,CAACC,OAAL,GAAe;AAAErD,YAAAA,WAAW,EAAE,IAAK5C,CAAAA,GAAL,CAAS,iBAAT,CAAA;AAAf,WAAf,CAAA;AACD,SAAA;;AAED,QAAA,OAAOW,WAAW,CAACI,MAAZ,CAAmBY,UAAnB,CAA8BE,IAA9B,CAAmCa,cAAnC,EAAmDsD,IAAnD,CAAyDnF,CAAAA,IAAzD,CAA8D,UAASC,KAAT,EAAgB;AACnFZ,UAAAA,cAAc,CAAC4F,IAAD,CAAd,CADmF;AAGnF;AACA;;AACA9E,UAAAA,cAAC,CAACkF,KAAF,CAAQ,YAAW;AACjB1G,YAAAA,oBAAoB,CAACsG,IAAD,EAAO,MAAP,CAApB,CAAA;AACD,WAFD,CAAA,CAAA;;AAGA,UAAA,OAAOhF,KAAP,CAAA;AACD,SATM,CAAP,CAAA;AAUD,OAlBD,CAAA,CAAA;AAmBD,KAtBD,CAAA,CAAA;AAwBA,IAAKmE,IAAAA,CAAAA,QAAL,CAAc,IAAA,CAAK5E,KAAnB,EAA0B,uBAA1B,EAAmD,UAASA,KAAT,EAAgB8F,KAAhB,EAAuB;AACxE,MAAKN,IAAAA,CAAAA,IAAL,CAAUO,WAAV,EAAA,CAAA;;AACA,MAAA,IAAID,KAAK,KAAK,QAAV,IAAsB,KAAKrG,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,qBAA1B,CAAA,KAAqD,qBAA/E,EAAsG;AACpGQ,QAAAA,YAAY,CAAC,IAAD,EAAO,qBAAP,CAAZ,CAAA;AACD,OAFD,MAEO,IAAI,IAAKV,CAAAA,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,qBAA1B,CAAqD,KAAA,MAAzD,EAAiE;AACtEQ,QAAAA,YAAY,CAAC,IAAD,EAAO,MAAP,CAAZ,CAAA;AACD,OAAA;AACF,KAPD,CAAA,CAAA;AAQD,GA1KkC;AA4KnCoF,EAAAA,eAAe,EAAE,YAAW;AAC1B,IAAI,IAAA,IAAA,CAAK9F,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,sBAA1B,CAAsD,KAAA,KAA1D,EAAiE;AAC/D,MAAKK,IAAAA,CAAAA,KAAL,CAAWC,GAAX,CAAe;AACbqC,QAAAA,WAAW,EAAE,IAAA,CAAK7C,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,iBAA1B,CAAA,IAAgD,IADhD;AAEb4C,QAAAA,WAAW,EAAE,IAAK9C,CAAAA,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,iBAA1B,CAAA;AAFA,OAAf,CAAA,CAAA;AAID,KAAA;AACF,GAnLkC;AAqLnCqG,EAAAA,gBAAgB,EAAE,YAAW;AAC3B,IAAA,IAAI,KAAKvG,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,qBAA1B,CAAA,IAAoD,IAAKF,CAAAA,OAAL,CAAaC,QAAb,CAAsBC,GAAtB,CAA0B,aAA1B,CAAxD,EAAkG;AAChG,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;AACF,GAAA;AAzLkC,CAAtB,CAAf;;;;"}
{"version":3,"file":"EnrollCustomFactorController.js","sources":["../../../../../src/v1/controllers/EnrollCustomFactorController.js"],"sourcesContent":["/*!\n * Copyright (c) 2018-2019, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc, internal } from 'okta';\nimport FormController from 'v1/util/FormController';\nimport Footer from 'v1/views/enroll-factors/Footer';\nconst { Util } = internal.util;\nexport default FormController.extend({\n  className: 'enroll-custom-factor',\n  Model: {\n    local: {\n      provider: 'string',\n      factorType: 'string',\n    },\n    save: function() {\n      return this.manageTransaction((transaction, setTransaction) => {\n        const factor = _.findWhere(transaction.factors, {\n          provider: this.get('provider'),\n          factorType: this.get('factorType'),\n        });\n\n        return factor\n          .enroll()\n          .then(trans => {\n            setTransaction(trans);\n            const url = this.appState.get('enrollCustomFactorRedirectUrl');\n\n            if (url !== null) {\n              Util.redirect(url);\n            }\n          })\n          .catch(function(err) {\n            throw err;\n          });\n      });\n    },\n  },\n\n  Form: function() {\n    const factors = this.options.appState.get('factors');\n    const factor = factors.findWhere({\n      provider: this.options.provider,\n      factorType: this.options.factorType,\n    });\n    const vendorName = factor.get('vendorName');\n    const subtitle = loc('enroll.customFactor.subtitle', 'login', [vendorName]);\n    const saveText = loc('enroll.customFactor.save', 'login');\n\n    return {\n      autoSave: true,\n      title: vendorName,\n      subtitle: subtitle,\n      save: saveText,\n    };\n  },\n\n  trapAuthResponse: function() {\n    if (this.options.appState.get('isMfaEnrollActivate')) {\n      return true;\n    }\n  },\n\n  initialize: function() {\n    this.model.set('provider', this.options.provider);\n    this.model.set('factorType', this.options.factorType);\n  },\n\n  Footer: Footer,\n});\n"],"names":["Util","internal","util","FormController","extend","className","Model","local","provider","factorType","save","manageTransaction","transaction","setTransaction","factor","_","findWhere","factors","get","enroll","then","trans","url","appState","redirect","catch","err","Form","options","vendorName","subtitle","loc","saveText","autoSave","title","trapAuthResponse","initialize","model","set","Footer"],"mappings":"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"}
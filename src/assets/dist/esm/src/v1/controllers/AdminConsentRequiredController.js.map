{"version":3,"file":"AdminConsentRequiredController.js","sources":["../../../../../src/v1/controllers/AdminConsentRequiredController.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, View, loc } from 'okta';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport ScopeList from 'v1/views/admin-consent/ScopeList';\nimport consentLogoHeaderTemplate from 'v1/views/shared/templates/consentLogoHeaderTemplate';\n\nconst ConsentModel = {\n  props: {\n    scopes: ['array', true]\n  },\n  save: function() {\n    return this.doTransaction(function(transaction) {\n      return transaction.consent({\n        consent: {\n          scopes: _.pluck(this.get('scopes'), 'name')\n        }\n      });\n    });\n  },\n  cancel: function() {\n    var self = this;\n    return this.doTransaction(function(transaction) {\n      return transaction.cancel();\n    }).then(function() {\n      var consentCancelFn = self.settings.get('consent.cancel');\n      if (_.isFunction(consentCancelFn)) {\n        consentCancelFn();\n      }\n    });\n  }\n};\n\nconst ConsentHeader = View.extend({\n  className: 'consent-title detail-row',\n  template: consentLogoHeaderTemplate,\n  getTemplateData: function() {\n    var appState = this.options.appState;\n    return {\n      appName: appState.escape('targetLabel'),\n      customLogo: appState.get('targetLogo') && appState.get('targetLogo').href,\n      defaultLogo: appState.get('defaultAppLogo'),\n      clientURI: appState.get('targetClientURI') && appState.get('targetClientURI').href,\n      issuer: appState.get('issuer'),\n    };\n  }\n});\n\nconst ConsentForm = {\n  noCancelButton: false,\n  buttonOrder: ['cancel', 'save'],\n  autoSave: true,\n  save: _.partial(loc, 'consent.required.consentButton', 'login'),\n  cancel: _.partial(loc, 'consent.required.cancelButton', 'login'),\n  formChildren: [\n    FormType.View({\n      View: ConsentHeader\n    }),\n    FormType.View({\n      View: ScopeList,\n    }),\n  ],\n};\n\nconst AdminConsentRequiredController = FormController.extend({\n  Model: ConsentModel,\n\n  Form: ConsentForm,\n\n  className: 'admin-consent-required',\n\n  initialize: function() {\n    this.model.set('scopes', this.options.appState.get('scopes'));\n    this.listenTo(this.form, 'cancel', () => {\n      this.model.cancel();\n    });\n  },\n});\n\nexport default AdminConsentRequiredController;\n"],"names":["ConsentModel","props","scopes","save","doTransaction","transaction","consent","_","pluck","get","cancel","self","then","consentCancelFn","settings","isFunction","ConsentHeader","View","extend","className","template","consentLogoHeaderTemplate","getTemplateData","appState","options","appName","escape","customLogo","href","defaultLogo","clientURI","issuer","ConsentForm","noCancelButton","buttonOrder","autoSave","partial","loc","formChildren","FormType","ScopeList","AdminConsentRequiredController","FormController","Model","Form","initialize","model","set","listenTo","form"],"mappings":"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"}
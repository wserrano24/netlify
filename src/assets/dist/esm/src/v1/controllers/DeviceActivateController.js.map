{"version":3,"file":"DeviceActivateController.js","sources":["../../../../../src/v1/controllers/DeviceActivateController.js"],"sourcesContent":["/*!\n * Copyright (c) 2017, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint max-len: [2, 160] */\nimport hbs from 'handlebars-inline-precompile';\nimport {loc, View} from 'okta';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport TextBox from 'v1/views/shared/TextBox';\n\nconst InvalidUserCodeErrorView = View.extend({\n  template: hbs`\n      <div class=\"okta-form-infobox-error infobox infobox-error\" role=\"alert\">\n          <span class=\"icon error-16\"></span>\n           <p>{{i18n code=\"api.authn.error.PASSCODE_INVALID\" bundle=\"login\"}}</p>\n      </div>\n    `\n});\n\nexport default FormController.extend({\n  className: 'device-code-activate',\n  Model: function() {\n    return {\n      props: {\n        userCode: ['string', true, this.options?.appState?.get('userCode')],\n        stateToken: 'string',\n      },\n      save: function() {\n        const self = this;\n        return this.doTransaction(function(transaction) {\n          return transaction.deviceActivate({\n            userCode: self.get('userCode')\n          });\n        });\n      }\n    };\n  },\n  Form: {\n    noCancelButton: true,\n    autoSave: true,\n    save: function() {\n      return loc('oform.next', 'login');\n    },\n    title: function() {\n      return loc('device.code.activate.title', 'login');\n    },\n    subtitle() {\n      return loc('device.code.activate.subtitle', 'login');\n    },\n    formChildren: function() {\n      if (this.options.appState.get('deviceActivationStatus') === 'INVALID_USER_CODE') {\n        this.add(InvalidUserCodeErrorView, '.o-form-error-container');\n      }\n\n      return [\n        FormType.Input({\n          label: loc('device.code.activate.label', 'login'),\n          'label-top': true,\n          name: 'userCode',\n          input: TextBox,\n          inputId: 'user-code',\n          type: 'text',\n          inlineValidation: false,\n        })\n      ];\n    },\n    events: {\n      'keyup input[name=\"userCode\"]': function(e) {\n        e.preventDefault();\n        this.addHyphen(e);\n      }\n    },\n    addHyphen(evt) {\n      const currentVal = evt.target.value;\n      // add hyphen after 4th character\n      if (currentVal && currentVal.length === 4 && !['Backspace', 'Delete', '-'].includes(evt.key)) {\n        evt.target.value = currentVal.concat('-');\n      }\n    }\n  },\n});\n"],"names":["InvalidUserCodeErrorView","View","extend","template","FormController","className","Model","props","userCode","options","appState","get","stateToken","save","self","doTransaction","transaction","deviceActivate","Form","noCancelButton","autoSave","loc","title","subtitle","formChildren","add","FormType","Input","label","name","input","TextBox","inputId","type","inlineValidation","events","e","preventDefault","addHyphen","evt","currentVal","target","value","length","includes","key","concat"],"mappings":"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"}
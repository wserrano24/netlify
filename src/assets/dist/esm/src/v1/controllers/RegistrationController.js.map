{"version":3,"file":"RegistrationController.js","sources":["../../../../../src/v1/controllers/RegistrationController.js"],"sourcesContent":["/*!\n * Copyright (c) 2017, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport { _, Backbone, Model, loc, Form, View } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport LoginModel from 'v1/models/LoginModel';\nimport RegistrationSchema from 'v1/models/RegistrationSchema';\nimport Q from 'q';\nimport BaseLoginController from 'v1/util/BaseLoginController';\nimport Enums from 'util/Enums';\nimport { RegistrationError } from 'util/Errors';\nimport RegistrationFormFactory from 'v1/util/RegistrationFormFactory';\nimport Util from 'util/Util';\nimport SubSchema from 'v1/views/registration/SubSchema';\nconst RegistrationControllerFooter = View.extend({\n  template: hbs(\n    '\\\n      <a href=\"#\" class=\"link help\" data-se=\"back-link\">\\\n        {{i18n code=\"goback\" bundle=\"login\"}}\\\n      </a>\\\n    '\n  ),\n  className: 'auth-footer',\n  events: {\n    'click .help': function(e) {\n      e.preventDefault();\n      this.back();\n    },\n  },\n  back: function() {\n    this.state.set('navigateDir', Enums.DIRECTION_BACK);\n    this.options.appState.trigger('navigate', '');\n  },\n});\nexport default BaseLoginController.extend({\n  className: 'registration',\n  initialize: function() {\n    const RegistrationControllerSchema = RegistrationSchema.extend({\n      settings: this.options.settings,\n      url: this.options.settings.get('baseUrl') + '/api/v1/registration/form',\n    });\n    // setup schema\n\n    const schema = new RegistrationControllerSchema();\n\n    this.state.set('schema', schema);\n  },\n  getRegistrationApiUrl: function() {\n    const defaultPolicyId = this.settings.get('defaultPolicyId');\n    // default policyId\n\n    const orgPolicyId = this.options.settings.get('policyId');\n    // org policyId\n\n    const apiUrl = defaultPolicyId\n      ? this.getRegistrationPolicyApi(defaultPolicyId)\n      : this.getRegistrationPolicyApi(orgPolicyId);\n\n    return apiUrl;\n  },\n  getRegistrationPolicyApi: function(policyId) {\n    return this.options.settings.get('baseUrl') + '/api/v1/registration/' + policyId;\n  },\n  doPostSubmit: function() {\n    if (this.model.get('activationToken')) {\n      const self = this;\n      // register via activation token\n\n      self.settings.callGlobalSuccess(Enums.REGISTRATION_COMPLETE, {\n        activationToken: this.model.get('activationToken'),\n      });\n\n      const loginModel = new LoginModel({\n        settings: self.model.appState.settings,\n      });\n\n      loginModel.loginWithActivationToken(this.model.get('activationToken')).then(function(transaction) {\n        self.model.trigger('setTransaction', transaction);\n      });\n    } else {\n      // register via activation email\n      this.model.appState.set('username', this.model.get('email'));\n      this.model.appState.trigger('navigate', 'signin/register-complete');\n    }\n  },\n  registerUser: function(postData) {\n    const self = this;\n\n    Object.keys(postData).forEach((k) =>\n      (_.isNull(postData[k]) || _.isUndefined(postData[k]) || postData[k] === '') && delete postData[k]);\n    this.model.attributes = postData;\n    // Model.save returns a jqXHR\n    Backbone.Model.prototype.save\n      .call(this.model)\n      .then(function() {\n        self.model.trigger('startSaving');\n        const activationToken = self.model.get('activationToken');\n        const postSubmitData = activationToken ? activationToken : self.model.get('email');\n\n        self.settings.postRegistrationSubmit(\n          postSubmitData,\n          function() {\n            self.doPostSubmit();\n          },\n          function(errors) {\n            self.showErrors(errors);\n          }\n        );\n      })\n      .fail((err) => {\n        const responseJSON = err.responseJSON;\n\n        if (responseJSON && responseJSON.errorCauses.length) {\n          const { errorCode, errorCauses } = responseJSON;\n          const { errorSummary, reason, location } = errorCauses[0];\n\n          const isNotUniqueValue =\n            errorCode === 'E0000001' &&\n            reason === 'UNIQUE_CONSTRAINT';\n\n          if (isNotUniqueValue) {\n            this.renderIsNotUniqueError(responseJSON);\n          }\n\n          this.renderLegacyLocationErrorIfNeeded(location, errorSummary);\n\n          Util.triggerAfterError(\n            this,\n            new RegistrationError(errorSummary)\n          );\n        }\n      });\n  },\n\n  renderIsNotUniqueError: function(error) {\n    const { location } = error.errorCauses[0];\n    const errorSummary = loc(\n      'registration.error.userName.notUniqueWithinOrg',\n      'login',\n      [location]\n    );\n    // replace generic error message with more specific one\n    // without using backbone events because there was a race condition\n    // between clearing and triggering errors\n    this.$el.find('.okta-form-infobox-error p').text(errorSummary);\n  },\n\n  renderLegacyLocationErrorIfNeeded: function(location, errorSummary) {\n    // replace generic error message with errorSummary for v1 SIW\n    // this makes sure that with legacy location that starts with `data.userProfile`\n    // we still see the errorSummary in the error banner instead of only a generic error\n    // See example in https://developer.okta.com/docs/reference/registration-hook/#sample-json-payload-of-request\n    if (location && /^data\\.userProfile.*/.test(location)) {\n      this.$el.find('.okta-form-infobox-error p').text(errorSummary);\n    }\n  },\n\n  createRegistrationModel: function(modelProperties) {\n    const self = this;\n    const RegistrationControllerModel = Model.extend({\n      url: self.getRegistrationApiUrl() + '/register',\n      settings: this.settings,\n      appState: this.options.appState,\n      props: modelProperties,\n      local: {\n        activationToken: 'string',\n      },\n      toJSON: function() {\n        const data = Model.prototype.toJSON.apply(this, arguments);\n\n        return {\n          userProfile: data,\n          relayState: this.settings.get('relayState'),\n        };\n      },\n      parse: function(resp) {\n        this.set('activationToken', resp.activationToken);\n        delete resp.activationToken;\n        return resp;\n      },\n      save: function() {\n        this.settings.preRegistrationSubmit(\n          this.attributes,\n          function(postData) {\n            self.registerUser(postData);\n          },\n          function(errors) {\n            self.showErrors(errors);\n          }\n        );\n      },\n    });\n\n    return new RegistrationControllerModel();\n  },\n  showErrors: function(error, hideRegisterButton) {\n    //for parseSchema error hide form and show error at form level\n    if (error.callback === 'parseRegistrationSchema' && error.errorCauses) {\n      error.errorSummary = _.clone(error.errorCauses[0].errorSummary);\n      delete error.errorCauses;\n    }\n    //show error on form\n    this.model.trigger('error', this.model, {\n      responseJSON: error,\n    });\n\n    //throw registration error\n    const errMsg = error.callback ? error.callback + ':' + error.errorSummary : error.errorSummary;\n\n    Util.triggerAfterError(this, new RegistrationError(errMsg));\n\n    if (hideRegisterButton) {\n      this.$el.find('.button-primary').hide();\n    }\n  },\n  fetchInitialData: function() {\n    const self = this;\n\n    // register parse complete event listener\n    self.state.get('schema').on('parseComplete', function(updatedSchema) {\n      const modelProperties = updatedSchema.properties.createModelProperties();\n\n      self.settings.set('defaultPolicyId', updatedSchema.properties.defaultPolicyId);\n\n      // create model\n      self.model = self.createRegistrationModel(modelProperties);\n      // create form\n      const RegistrationControllerForm = Form.extend({\n        layout: 'o-form-theme',\n        autoSave: true,\n        noCancelButton: true,\n        title: loc('registration.form.title', 'login'),\n        save: loc('registration.form.submit', 'login'),\n        modelEvents : { 'invalid' : 'modifyErrors' },\n        hasSavingState: true,\n        customSavingState: {\n          start: 'startSaving',\n          stop: 'stopSaving',\n        },\n        modifyErrors: function(model, errorResp) {\n          // overwrite courage errorResp object to show custom error message\n          for (let formFieldName in errorResp) {\n            if (errorResp[formFieldName] === 'model.validation.field.string.minLength') {\n              errorResp[formFieldName] = loc('registration.model.validation.field.string.too.short', 'login', \n                [model.props[formFieldName].minLength]\n              );\n            } else if (errorResp[formFieldName] === 'model.validation.field.string.maxLength') {\n              errorResp[formFieldName] = loc('registration.model.validation.field.string.too.long', 'login', \n                [model.props[formFieldName].maxLength + 1]\n              );\n            }\n          }\n        },\n      });\n      const form = new RegistrationControllerForm(self.toJSON());\n\n      // add form\n      self.add(form);\n      // add footer\n      self.footer = new self.Footer(self.toJSON());\n      self.add(self.footer);\n      self.addListeners();\n      if (updatedSchema.error) {\n        self.showErrors(updatedSchema.error, true);\n      } else {\n        // add fields\n        updatedSchema.properties.each(function(schemaProperty) {\n          const inputOptions = RegistrationFormFactory.createInputOptions(schemaProperty);\n          const subSchemas = schemaProperty.get('subSchemas');\n          const name = schemaProperty.get('name');\n\n          form.addInput(inputOptions);\n          if (name === 'password' && subSchemas) {\n            form.add(SubSchema.extend({ id: 'subschemas-' + name, subSchemas: subSchemas }));\n          }\n        });\n        const requiredFieldsLabel = hbs('<span class=\"required-fields-label\">{{label}}</span>')({\n          label: loc('registration.required.fields.label', 'login'),\n        });\n\n        form.add(requiredFieldsLabel);\n      }\n    });\n    // fetch schema from API, returns a jqXHR. Wrap it in a Q\n    return Q(this.state.get('schema').fetch());\n  },\n  Footer: RegistrationControllerFooter,\n});\n"],"names":["RegistrationControllerFooter","View","extend","template","className","events","e","preventDefault","back","state","set","Enums","DIRECTION_BACK","options","appState","trigger","BaseLoginController","initialize","RegistrationControllerSchema","RegistrationSchema","settings","url","get","schema","getRegistrationApiUrl","defaultPolicyId","orgPolicyId","apiUrl","getRegistrationPolicyApi","policyId","doPostSubmit","model","self","callGlobalSuccess","REGISTRATION_COMPLETE","activationToken","loginModel","LoginModel","loginWithActivationToken","then","transaction","registerUser","postData","Object","keys","forEach","k","_","isNull","isUndefined","attributes","Backbone","Model","prototype","save","call","postSubmitData","postRegistrationSubmit","errors","showErrors","fail","err","responseJSON","errorCauses","length","errorCode","errorSummary","reason","location","isNotUniqueValue","renderIsNotUniqueError","renderLegacyLocationErrorIfNeeded","Util","triggerAfterError","RegistrationError","error","loc","$el","find","text","test","createRegistrationModel","modelProperties","RegistrationControllerModel","props","local","toJSON","data","apply","arguments","userProfile","relayState","parse","resp","preRegistrationSubmit","hideRegisterButton","callback","clone","errMsg","hide","fetchInitialData","on","updatedSchema","properties","createModelProperties","RegistrationControllerForm","Form","layout","autoSave","noCancelButton","title","modelEvents","hasSavingState","customSavingState","start","stop","modifyErrors","errorResp","formFieldName","minLength","maxLength","form","add","footer","Footer","addListeners","each","schemaProperty","inputOptions","RegistrationFormFactory","createInputOptions","subSchemas","name","addInput","SubSchema","id","requiredFieldsLabel","label","Q","fetch"],"mappings":"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"}
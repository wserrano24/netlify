{"version":3,"file":"SendEmailAndVerifyCodeForm.js","sources":["../../../../../../src/v1/views/mfa-verify/SendEmailAndVerifyCodeForm.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2019, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, Form, loc, View } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport ResendEmailView from 'v1/views/ResendEmailView';\nimport TextBox from 'v1/views/shared/TextBox';\n\nconst createEmailMaskElement = function() {\n  const email = this.model.get('email');\n  const emailTpl = hbs('<span class=\"mask-email\">{{email}}</span>');\n  return { factorEmail: emailTpl({ email }) };\n};\n\nconst SendEmailAndVerifyCodeFormVerifyEmailCodeForm = Form.extend({\n  layout: 'o-form-theme',\n  className: 'mfa-verify-email',\n  title: _.partial(loc, 'email.mfa.title', 'login'),\n  noButtonBar: false,\n  autoSave: true,\n  noCancelButton: true,\n  attributes: {\n    'data-se': 'factor-email',\n  },\n  save: function() {\n    return this.options.appState.get('isMfaChallenge')\n      ? loc('mfa.challenge.verify', 'login')\n      : loc('email.button.send', 'login');\n  },\n\n  events: Object.assign({}, Form.prototype.events, {\n    submit: function(e) {\n      e.preventDefault();\n      this.handleSubmit();\n    },\n  }),\n\n  handleSubmit() {\n    this.clearErrors();\n    if (this.options.appState.get('isMfaChallenge')) {\n      if (this.isValid()) {\n        this.model.save();\n      }\n    } else {\n      // Send email and switch to verification view\n      this.model.set('answer', '');\n      this.model.save().then(this.renderChallengView.bind(this));\n    }\n  },\n\n  initialize: function() {\n    Form.prototype.initialize.apply(this, arguments);\n\n    // render 'Send Email' page at first place\n    this.add(\n      View.extend({\n        attributes: {\n          'data-se': 'mfa-send-email-content',\n        },\n        className: 'mfa-send-email-content',\n        template: hbs('{{{i18n code=\"email.mfa.description\" bundle=\"login\" arguments=\"factorEmail\"}}}'),\n        getTemplateData: createEmailMaskElement,\n      })\n    );\n  },\n\n  renderChallengView: function() {\n    this.removeChildren();\n    this.add(\n      View.extend({\n        className: 'mfa-email-sent-content',\n        attributes: {\n          'data-se': 'mfa-email-sent-content',\n        },\n        // Why use `{{{` for the description?\n        // - factorEmail is actually an HTML fragment which\n        //   is created via another handlebar template and used for bold the email address.\n        template: hbs('{{{i18n code=\"email.mfa.email.sent.description\" bundle=\"login\" arguments=\"factorEmail\"}}}'),\n        getTemplateData: createEmailMaskElement,\n      })\n    );\n\n    this.add(ResendEmailView);\n\n    this.addInput({\n      label: loc('email.code.label', 'login'),\n      'label-top': true,\n      name: 'answer',\n      input: TextBox,\n      wide: true,\n      type: 'tel',\n    });\n    if (this.options.appState.get('allowRememberDevice')) {\n      this.addInput({\n        label: false,\n        'label-top': true,\n        placeholder: this.options.appState.get('rememberDeviceLabel'),\n        className: 'margin-btm-0',\n        name: 'rememberDevice',\n        type: 'checkbox',\n      });\n    }\n    this.render();\n  },\n});\n\nexport default SendEmailAndVerifyCodeFormVerifyEmailCodeForm;\n"],"names":["createEmailMaskElement","email","model","get","emailTpl","factorEmail","SendEmailAndVerifyCodeFormVerifyEmailCodeForm","Form","extend","layout","className","title","_","partial","loc","noButtonBar","autoSave","noCancelButton","attributes","save","options","appState","events","Object","assign","prototype","submit","e","preventDefault","handleSubmit","clearErrors","isValid","set","then","renderChallengView","bind","initialize","apply","arguments","add","View","template","getTemplateData","removeChildren","ResendEmailView","addInput","label","name","input","TextBox","wide","type","placeholder","render"],"mappings":"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"}
{"version":3,"file":"FactorsDropDown.js","sources":["../../../../../../../src/v1/views/mfa-verify/dropdown/FactorsDropDown.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, $, loc, internal } from 'okta';\nimport FactorUtil from 'util/FactorUtil';\nimport Factor from 'v1//models/Factor';\nimport FactorsDropDownOptions from './FactorsDropDownOptions';\nconst { BaseDropDown } = internal.views.components;\n\n$(document).click(function(e) {\n  const $target = $(e.target);\n  const isDropdown = $target.closest('.option-selected').length > 0 && $target.closest('.dropdown').length > 0;\n\n  if (!isDropdown) {\n    $('.dropdown .options').hide();\n    $('.dropdown a.option-selected').attr('aria-expanded', false);\n  }\n});\n\nexport default BaseDropDown.extend({\n  className: 'bg-helper icon-button',\n  screenReaderText: function() {\n    const factors = this.options.appState.get('factors');\n    let factor;\n    let factorLabel;\n\n    if (factors) {\n      factor = FactorUtil.findFactorInFactorsArray(factors, this.options.provider, this.options.factorType);\n    } else {\n      factor = new Factor.Model(this.options.appState.get('factor'), this.toJSON());\n    }\n    factorLabel = factor.get('factorLabel');\n    return loc('mfa.factors.dropdown.sr.text', 'login', [factorLabel]);\n  },\n  events: {\n    'click a.option-selected': function(e) {\n      e.preventDefault();\n      if (_.result(this, 'disabled')) {\n        e.stopPropagation();\n      } else {\n        const expanded = this.$('.options').toggle().is(':visible');\n\n        this.$('a.option-selected').attr('aria-expanded', expanded);\n        if (expanded) {\n          this.$('#okta-dropdown-options').find('li.factor-option:first a').focus();\n        }\n      }\n    },\n    'click .dropdown-disabled': function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n    },\n  },\n  initialize: function() {\n    this.addOption(FactorsDropDownOptions.getDropdownOption('TITLE'));\n    const factorsList = this.options.appState.get('factors');\n    const multiplePushFactors = factorsList.hasMultipleFactorsOfSameType('push');\n\n    factorsList.each(function(factor) {\n      // Do not add okta totp if there are multiple okta push (each push will have an inline totp)\n      if (!(factor.get('factorType') === 'token:software:totp' && multiplePushFactors)) {\n        this.addOption(FactorsDropDownOptions.getDropdownOption(factor.get('factorName')), { model: factor });\n        this.listenTo(this.last(), 'options:toggle', function() {\n          this.$('.options').hide();\n          this.$('a.option-selected').attr('aria-expanded', false);\n        });\n      }\n    }, this);\n  },\n});\n"],"names":["BaseDropDown","internal","views","components","$","document","click","e","$target","target","isDropdown","closest","length","hide","attr","extend","className","screenReaderText","factors","options","appState","get","factor","factorLabel","FactorUtil","findFactorInFactorsArray","provider","factorType","Factor","Model","toJSON","loc","events","preventDefault","_","result","stopPropagation","expanded","toggle","is","find","focus","initialize","addOption","FactorsDropDownOptions","getDropdownOption","factorsList","multiplePushFactors","hasMultipleFactorsOfSameType","each","model","listenTo","last"],"mappings":"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"}
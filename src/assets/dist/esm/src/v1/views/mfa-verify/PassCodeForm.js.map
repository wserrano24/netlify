{"version":3,"file":"PassCodeForm.js","sources":["../../../../../../src/v1/views/mfa-verify/PassCodeForm.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint complexity: [2, 7] */\nimport { _, loc, Form, createButton, View } from 'okta';\nimport hbs from 'handlebars-inline-precompile';\nimport Q from 'q';\nimport Enums from 'util/Enums';\nimport TextBox from 'v1/views/shared/TextBox';\nconst subtitleTpl = hbs('({{subtitle}})');\nconst PassCodeFormwarningTemplate = View.extend({\n  className: 'okta-form-infobox-warning infobox infobox-warning login-timeout-warning',\n  attributes: {\n    'aria-live': 'polite',\n  },\n  template: hbs`\n      <span class=\"icon warning-16\"></span>\n      <p>{{{warning}}}</p>\n    `,\n});\n\nfunction getFormAndButtonDetails(factorType) {\n  switch (factorType) {\n  case 'sms':\n    return {\n      buttonDataSe: 'sms-send-code',\n      buttonClassName: 'sms-request-button',\n      formSubmit: loc('mfa.sendCode', 'login'),\n      formRetry: loc('mfa.resendCode', 'login'),\n      formSubmitted: loc('mfa.sent', 'login'),\n      subtitle: subtitleTpl({ subtitle: this.model.get('phoneNumber') }),\n      warning: loc('factor.sms.time.warning', 'login'),\n    };\n  case 'call':\n    return {\n      buttonDataSe: 'make-call',\n      buttonClassName: 'call-request-button',\n      formSubmit: loc('mfa.call', 'login'),\n      formRetry: loc('mfa.redial', 'login'),\n      formSubmitted: loc('mfa.calling', 'login'),\n      subtitle: subtitleTpl({ subtitle: this.model.get('phoneNumber') }),\n      warning: loc('factor.call.time.warning', 'login'),\n    };\n  case 'email':\n    return {\n      buttonDataSe: 'email-send-code',\n      buttonClassName: 'email-request-button',\n      formSubmit: loc('mfa.sendEmail', 'login'),\n      formRetry: loc('mfa.resendEmail', 'login'),\n      formSubmitted: loc('mfa.sent', 'login'),\n      subtitle: subtitleTpl({ subtitle: this.model.get('email') }),\n    };\n  default:\n    return {\n      buttonDataSe: '',\n      buttonClassName: '',\n      formSubmit: '',\n      formRetry: '',\n      formSubmitted: '',\n    };\n  }\n}\n\nexport default Form.extend({\n  className: 'mfa-verify-passcode',\n  autoSave: true,\n  noCancelButton: true,\n  save: _.partial(loc, 'mfa.challenge.verify', 'login'),\n  scrollOnError: false,\n  layout: 'o-form-theme',\n\n  disableSubmitButton: function() {\n    return this.model.appState.get('isMfaChallenge') && this.model.get('answer');\n  },\n\n  showWarning: function(msg) {\n    this.clearWarnings();\n    this.add(PassCodeFormwarningTemplate, '.o-form-error-container', { options: { warning: msg } });\n  },\n  clearWarnings: function() {\n    this.$('.okta-form-infobox-warning').remove();\n  },\n\n  initialize: function() {\n    const form = this;\n\n    this.title = this.model.get('factorLabel');\n\n    const factorType = this.model.get('factorType');\n    const formAndButtonDetails = getFormAndButtonDetails.call(this, factorType);\n    const warningDetails = formAndButtonDetails.warning;\n\n    this.$el.attr('data-se', 'factor-' + factorType);\n\n    this.subtitle = formAndButtonDetails.subtitle;\n    this.listenTo(this.model, 'error', function() {\n      this.clearErrors();\n    });\n    this.addInput({\n      label: loc('mfa.challenge.enterCode.placeholder', 'login'),\n      'label-top': true,\n      className: 'o-form-fieldset o-form-label-top auth-passcode',\n      name: 'answer',\n      input: TextBox,\n      type: 'tel',\n    });\n    this.add(\n      createButton({\n        attributes: { 'data-se': formAndButtonDetails.buttonDataSe },\n        className: 'button ' + formAndButtonDetails.buttonClassName,\n        title: formAndButtonDetails.formSubmit,\n        click: function() {\n          form.clearErrors();\n          this.disable();\n          form.clearWarnings();\n          this.options.title = formAndButtonDetails.formSubmitted;\n          this.render();\n          // To send an OTP to the device, make the same request but use\n          // an empty passCode\n          this.model.set('answer', '');\n          this.model\n            .save()\n            .then(function() {\n              // render and focus on the passcode input field.\n              form.getInputs().first().render().focus();\n              return Q.delay(Enums.API_RATE_LIMIT);\n            })\n            .then(() => {\n              this.options.title = formAndButtonDetails.formRetry;\n              this.enable();\n              if (factorType === 'call' || factorType === 'sms') {\n                form.showWarning(warningDetails);\n              }\n              this.render();\n            });\n        },\n      })\n    );\n    if (this.options.appState.get('allowRememberDevice')) {\n      this.addInput({\n        label: false,\n        'label-top': true,\n        placeholder: this.options.appState.get('rememberDeviceLabel'),\n        className: 'margin-btm-0',\n        name: 'rememberDevice',\n        type: 'checkbox',\n      });\n    }\n  },\n});\n"],"names":["subtitleTpl","PassCodeFormwarningTemplate","View","extend","className","attributes","template","getFormAndButtonDetails","factorType","buttonDataSe","buttonClassName","formSubmit","loc","formRetry","formSubmitted","subtitle","model","get","warning","Form","autoSave","noCancelButton","save","_","partial","scrollOnError","layout","disableSubmitButton","appState","showWarning","msg","clearWarnings","add","options","$","remove","initialize","form","title","formAndButtonDetails","call","warningDetails","$el","attr","listenTo","clearErrors","addInput","label","name","input","TextBox","type","createButton","click","disable","render","set","then","getInputs","first","focus","Q","delay","Enums","API_RATE_LIMIT","enable","placeholder"],"mappings":"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"}
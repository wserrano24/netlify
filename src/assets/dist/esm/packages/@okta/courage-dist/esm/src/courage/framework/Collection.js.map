{"version":3,"file":"Collection.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/framework/Collection.js"],"sourcesContent":["import oktaUnderscore from '../util/underscore-wrapper.js';\nimport Backbone from '../vendor/lib/backbone.js';\n\nvar STATE = '__STATE__';\nvar FETCH_DATA = 'FETCH_DATA';\nvar PAGINATION_DATA = 'PAGINATION_DATA';\nvar DEFAULT_PARAMS = 'DEFAULT_PARAMS';\nvar LINK_BY_HEADER = 'LINK_BY_HEADER';\nvar XHR = 'XHR'; // ################################################\n// # Source: https://gist.github.com/deiu/9335803\n// ################################################\n// unquote string (utility)\n\nfunction unquote(value) {\n  if (value.charAt(0) === '\"' && value.charAt(value.length - 1) === '\"') {\n    return value.substring(1, value.length - 1);\n  }\n\n  return value;\n}\n/*\nparse a Link header\nLink:<https://example.org/.meta>; rel=meta\nvar r = parseLinkHeader(xhr.getResponseHeader('Link');\nr['meta']['href'] outputs https://example.org/.meta\n*/\n\n\nfunction parseLinkHeader(header) {\n  /* eslint max-statements: 0 */\n  var linkexp = /<[^>]*>\\s*(\\s*;\\s*[^()<>@,;:\"/[\\]?={} \\t]+=(([^()<>@,;:\"/[\\]?={} \\t]+)|(\"[^\"]*\")))*(,|$)/g;\n  var paramexp = /[^()<>@,;:\"/[\\]?={} \\t]+=(([^()<>@,;:\"/[\\]?={} \\t]+)|(\"[^\"]*\"))/g;\n  var matches = header.match(linkexp);\n  var rels = {};\n\n  for (var i = 0; i < matches.length; i++) {\n    var split = matches[i].split('>');\n    var href = split[0].substring(1);\n    var link = {\n      href: undefined,\n      rel: undefined\n    };\n    link.href = href;\n    var s = split[1].match(paramexp);\n\n    for (var j = 0; j < s.length; j++) {\n      var paramsplit = s[j].split('=');\n      var name = paramsplit[0];\n      link[name] = unquote(paramsplit[1]);\n    }\n\n    if (link.rel !== undefined) {\n      rels[link.rel] = link;\n    }\n  }\n\n  return rels;\n}\n/*\n * Sets the next page URL on the collection from link headers\n * See: http://www.rfc-editor.org/rfc/rfc5988.txt\n *\n * This method is looking for a link header with `rel=\"next\"`\n * An set's it as the next page's URL.\n *\n * If it doesn't find a next page, and current page is set by a link header\n * it assumes we are at the last page and deletes the current `next`\n */\n\n\nfunction setLinkHeadersPagination(collection, xhr) {\n  try {\n    var links = parseLinkHeader(xhr.getResponseHeader('link'));\n    collection[STATE].set(LINK_BY_HEADER, true);\n    collection.setPagination(links['next'].href);\n  } catch (e) {\n    if (collection[STATE].get(LINK_BY_HEADER)) {\n      collection.setPagination(null);\n    }\n  }\n}\n\nfunction parseQuery(url) {\n  var params = {};\n  var rawQueryStr = url && url.split('?')[1];\n  var queryString = rawQueryStr && decodeURIComponent(rawQueryStr.split('#')[0]).replace(/\\+/g, ' ');\n  var props = queryString ? queryString.split('&') : [];\n\n  for (var i = 0; i < props.length; i++) {\n    var parts = props[i].split('=');\n    params[parts.shift()] = parts.join('=');\n  }\n\n  return params;\n} // ################################################\n// # /Source\n// ################################################\n//\n\n\nconst collectionProps =\n/** @lends src/framework/Collection.prototype */\n{\n  /**\n   * Default fetch parameters\n   * @type {Object|Function}\n   */\n  params: {},\n  preinitialize: function (models, options) {\n    const state = new Backbone.Model();\n\n    const defaultParams = oktaUnderscore.defaults(options && options.params || {}, oktaUnderscore.result(this, 'params') || {});\n\n    state.set(DEFAULT_PARAMS, defaultParams);\n    this[STATE] = state; // Adds support for child class to convert to ES6 Class.\n    // After conversion, `this.model` has to be a pure function to return Model Class.\n    // The changes below is trying to distinguish the ambiguity between a Class and normal function,\n    // as both are JavaScript function essentially.\n    // There are three ways to define class for `this.model`\n    // 1. Object properties: `model: BaseModel.extend({..})`\n    // 2. Function constructor:\n    // See example from\n    // - appversions/src/models/CustomType.js\n    // - appversions/src/models/EnumType.js\n    // - appversions/src/models/SignOnMode.js\n    // - authn-factors/src/models/Feature.js\n    // - shared/src/models/SamlAttribute.js\n    // 3. Function that returns a class.\n    //    model: function() { return BaseModel.extend({..}); }\n    //\n    // option 1 and 2 exists in code base today\n    // option 3 is introduced to support child class to convert to ES6 class.\n    // TODO: think of remove following check\n    // The reason for `this.model !== Backbone.Model` is because `this.model` is default to `Backbone.Model`\n    // set at Backbone.Collection.\n\n    if (oktaUnderscore.isFunction(this.model) && this.model.length === 0 && this.model.isCourageModel !== true) {\n      this.model = oktaUnderscore.result(this, 'model');\n    }\n\n    Backbone.Collection.prototype.preinitialize.apply(this, arguments);\n  },\n\n  /**\n   * See [Backbone Collection.sync](http://backbonejs.org/#Collection-sync).\n   */\n  sync: function (method, collection, options) {\n    var self = this;\n    var success = options.success;\n\n    options.success = function (resp, status, xhr) {\n      // its important to set the pagination data *before* we call the success callback\n      // because we want the pagination data to be ready when the collection triggers the `sync` event\n      setLinkHeadersPagination(self, xhr);\n      success.apply(null, arguments);\n    };\n\n    return Backbone.Collection.prototype.sync.call(this, method, collection, options);\n  },\n\n  /**\n   * See [Backbone Collection.fetch](http://backbonejs.org/#Collection-fetch).\n   */\n  fetch: function (options) {\n    options || (options = {});\n    var state = this[STATE];\n    var xhr = state.get(XHR);\n    options.data = oktaUnderscore.extend({}, state.get(DEFAULT_PARAMS), options.data || {});\n    options.fromFetch = true;\n    state.set(FETCH_DATA, options.data);\n\n    if (xhr && xhr.abort && options.abort !== false) {\n      xhr.abort();\n    }\n\n    xhr = Backbone.Collection.prototype.fetch.call(this, options);\n    state.set(XHR, xhr);\n    return xhr;\n  },\n\n  /**\n   * Set pagination data to get to the next page\n   * @param {Mixed} params\n   * @param {Object} [options]\n   * @param {Boolean} [options.fromFetch] should we include data from the previous fetch call in this object\n   * @example\n   * collection.setPagination({q: 'foo', page: '2'}); //=> {q: 'foo', page: '2'}\n   *\n   * collection.setPagination('/path/to/resource?q=baz&page=4'); //=> {q: 'baz', page: '4'}\n   *\n   * collection.setPagination('/path/to/resource'); //=> {}\n   *\n   * collection.fetch({data: {q: 'foo'}});\n   * collection.setPagination({page: 2}, {fromFetch: true}); //=> {q: 'foo', page: 2}\n   *\n   * any \"falsy\" value resets pagination\n   * collection.setPagination(); //=> {}\n   * collection.setPagination(null); //=> {}\n   * collection.setPagination(false); //=> {}\n   * collection.setPagination(''); //=> {}\n   * collection.setPagination(0); //=> {}\n   * @protected\n   */\n  setPagination: function (params, options) {\n    /* eslint complexity: [2, 8] */\n    if (oktaUnderscore.isString(params) && params) {\n      params = parseQuery(params);\n    }\n\n    if (!oktaUnderscore.isObject(params) || oktaUnderscore.isArray(params) || !oktaUnderscore.size(params)) {\n      params = null;\n    } else if (options && options.fromFetch) {\n      params = oktaUnderscore.extend({}, this.getFetchData(), params);\n    }\n\n    this[STATE].set(PAGINATION_DATA, params);\n  },\n\n  /**\n   * Returns the `data` parameters applied in th most recent `fetch` call\n   * It will include parameters set by {@link #params} and optios.params passed to the constructor\n   * @return {Object}\n   * @protected\n   */\n  getFetchData: function () {\n    return this[STATE].get(FETCH_DATA) || {};\n  },\n\n  /**\n   * Data object for constructing a request to fetch the next page\n   * @return {Object}\n   * @protected\n   */\n  getPaginationData: function () {\n    return this[STATE].get(PAGINATION_DATA) || {};\n  },\n\n  /**\n   * Does this collection have more data on the server (e.g is there a next \"page\")\n   * @return {Boolean}\n   */\n  hasMore: function () {\n    return oktaUnderscore.size(this.getPaginationData()) > 0;\n  },\n\n  /**\n   * Get the next page from the server\n   * @return {Object} xhr returned by {@link #fetch}\n   */\n  fetchMore: function () {\n    if (!this.hasMore()) {\n      throw new Error('Invalid Request');\n    }\n\n    return this.fetch({\n      data: this.getPaginationData(),\n      add: true,\n      remove: false,\n      update: true\n    });\n  },\n\n  /**\n   * See [Backbone Collection.reset](http://backbonejs.org/#Collection-reset).\n   */\n  reset: function (models, options) {\n    options || (options = {}); // only reset the pagination when reset is being called explicitly.\n    // this is to avoid link headers pagination being overriden and reset when\n    // fetching the collection using `collection.fetch({reset: true})`\n\n    if (!options.fromFetch) {\n      this.setPagination(null);\n    }\n\n    return Backbone.Collection.prototype.reset.apply(this, arguments);\n  },\n  // we want \"where\" to be able to search through derived properties as well\n  where: function (attrs, first) {\n    if (oktaUnderscore.isEmpty(attrs)) {\n      return first ? void 0 : [];\n    }\n\n    return this[first ? 'find' : 'filter'](function (model) {\n      for (var key in attrs) {\n        if (attrs[key] !== model.get(key)) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  },\n\n  /**\n   * See [Backbone Collection.create](http://backbonejs.org/#Collection-create).\n   */\n  create: function (model, options) {\n    options || (options = {});\n\n    if (!oktaUnderscore.result(model, 'urlRoot')) {\n      options.url = oktaUnderscore.result(this, 'url');\n    }\n\n    return Backbone.Collection.prototype.create.call(this, model, options);\n  },\n  // Use Object.create instead of {} on _byId to avoid __proto__ functions to return\n  // This can be removed once the issue has addressed in backbone framework\n  // https://github.com/jashkenas/backbone/pull/4225\n  _reset: function () {\n    Backbone.Collection.prototype['_reset'].call(this);\n    this._byId = Object.create(null);\n  }\n};\n/**\n *\n * Archer.Collection is a standard [Backbone.Collection](http://backbonejs.org/#Collection) with pre-set `data`\n * parameters and built in pagination - works with [http link headers](https://tools.ietf.org/html/rfc5988)\n * out of the box:\n *\n * @class src/framework/Collection\n * @extends external:Backbone.Collection\n * @example\n * var Users = Archer.Collection.extend({\n *   url: '/api/v1/users'\n *   params: {expand: true}\n * });\n * var users = new Users(null, {params: {type: 'new'}}),\n *     $button = this.$('a.fetch-more');\n *\n * $button.click(function () {\n *   users.fetchMore();\n * });\n *\n * this.listenTo(users, 'sync', function () {\n *   $button.toggle(users.hasMore());\n * });\n *\n * collection.fetch(); //=> '/api/v1/users?expand=true&type=new'\n */\n\nconst Collection = Backbone.Collection.extend(collectionProps);\n/**\n * It's used for distinguishing the ambiguity from _.isFunction()\n * which returns True for both a JavaScript Class constructor function\n * and normal function. With this flag, we can tell a function is actually\n * a Collection Class.\n * This flag is added in order to support the type of a parameter can be\n * either a Class or pure function that returns a Class.\n */\n\nCollection.isCourageCollection = true;\n\nexport { Collection as default };\n"],"names":["STATE","FETCH_DATA","PAGINATION_DATA","DEFAULT_PARAMS","LINK_BY_HEADER","XHR","unquote","value","charAt","length","substring","parseLinkHeader","header","linkexp","paramexp","matches","match","rels","i","split","href","link","undefined","rel","s","j","paramsplit","name","setLinkHeadersPagination","collection","xhr","links","getResponseHeader","set","setPagination","e","get","parseQuery","url","params","rawQueryStr","queryString","decodeURIComponent","replace","props","parts","shift","join","collectionProps","preinitialize","models","options","state","Backbone","Model","defaultParams","oktaUnderscore","defaults","result","isFunction","model","isCourageModel","Collection","prototype","apply","arguments","sync","method","self","success","resp","status","call","fetch","data","extend","fromFetch","abort","isString","isObject","isArray","size","getFetchData","getPaginationData","hasMore","fetchMore","Error","add","remove","update","reset","where","attrs","first","isEmpty","key","create","_reset","_byId","Object","isCourageCollection"],"mappings":"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"}
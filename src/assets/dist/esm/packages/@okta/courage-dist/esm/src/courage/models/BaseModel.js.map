{"version":3,"file":"BaseModel.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/models/BaseModel.js"],"sourcesContent":["import oktaUnderscore from '../util/underscore-wrapper.js';\nimport Model from './Model.js';\n\nconst hasProps = function (model) {\n  const local = oktaUnderscore.omit(model.local, oktaUnderscore.keys(model._builtInLocalProps));\n\n  return oktaUnderscore.size(model.props) + oktaUnderscore.size(local) > 0;\n};\n\nconst props =\n/** @lends module:Okta.BaseModel.prototype */\n{\n  /**\n   * @type {Boolean}\n   */\n  flat: false,\n  constructor: function () {\n    Model.apply(this, arguments);\n    this.on('sync', this._setSynced);\n  },\n  allows: function () {\n    if (hasProps(this)) {\n      return Model.prototype.allows.apply(this, arguments);\n    } else {\n      return true;\n    }\n  },\n  // bw compatibility support for old computed properties\n  set: function (key, val) {\n    let attrs;\n\n    if (typeof key === 'object') {\n      attrs = key;\n    } else {\n      (attrs = {})[key] = val;\n    } // computed properties\n\n\n    oktaUnderscore(attrs).each(function (fn, attr) {\n      if (!fn || !oktaUnderscore.isArray(fn.__attributes)) {\n        return;\n      }\n\n      this.on('change:' + fn.__attributes.join(' change:'), function () {\n        const val = this.get(attr);\n\n        if (val !== this['__schema__'].computedProperties[attr]) {\n          this['__schema__'].computedProperties[attr] = val;\n          this.trigger('change:' + attr, val);\n        }\n      }, this);\n    }, this);\n\n    return Model.prototype.set.apply(this, arguments);\n  },\n\n  /**\n   * Get the current value of an attribute from the model. For example: `note.get(\"title\")`\n   *\n   * See [Model.get](http://backbonejs.org/#Model-get)\n   * @param {String} attribute\n   * @return {Mixed} The value of the model attribute\n   */\n  get: function () {\n    const value = Model.prototype.get.apply(this, arguments);\n\n    if (oktaUnderscore.isFunction(value)) {\n      return value.apply(this, oktaUnderscore.map(value.__attributes || [], this.get, this));\n    }\n\n    return value;\n  },\n\n  /**\n   * Return a shallow copy of the model's attributes for JSON stringification.\n   * This can be used for persistence, serialization, or for augmentation before being sent to the server.\n   * The name of this method is a bit confusing, as it doesn't actually return a JSON string â€”\n   *  but I'm afraid that it's the way that the JavaScript API for JSON.stringify works.\n   *\n   * ```javascript\n   * var artist = new Model({\n   *   firstName: \"Wassily\",\n   *   lastName: \"Kandinsky\"\n   * });\n   *\n   * artist.set({birthday: \"December 16, 1866\"});\n   * alert(JSON.stringify(artist)); // {\"firstName\":\"Wassily\",\"lastName\":\"Kandinsky\",\"birthday\":\"December 16, 1866\"}\n   * ```\n   * See [Model.toJSON](http://backbonejs.org/#Model-toJSON)\n   * @param  {Object} options\n   * @return {Object}\n   */\n  toJSON: function (options) {\n    options || (options = {});\n    const res = Model.prototype.toJSON.apply(this, arguments); // cleanup computed properties\n\n    oktaUnderscore(res).each(function (value, key) {\n      if (typeof value === 'function') {\n        if (options.verbose) {\n          res[key] = this.get(key);\n        } else {\n          delete res[key];\n        }\n      }\n    }, this); // cleanup private properties\n\n\n    if (!options.verbose) {\n      oktaUnderscore(res).each(function (value, key) {\n        if (/^__\\w+__$/.test(key)) {\n          delete res[key];\n        }\n      });\n    }\n\n    return res;\n  },\n  sanitizeAttributes: function (attributes) {\n    const attrs = {};\n\n    oktaUnderscore.each(attributes, function (value, key) {\n      if (!oktaUnderscore.isFunction(value)) {\n        attrs[key] = value;\n      }\n    });\n\n    return attrs;\n  },\n  reset: function (options) {\n    this.clear(options);\n    this.set(this.sanitizeAttributes(this.defaults), options);\n  },\n  clear: function (options) {\n    const attrs = {};\n\n    oktaUnderscore.each(this.sanitizeAttributes(this.attributes), function (value, key) {\n      attrs[key] = void 0;\n    });\n\n    return this.set(attrs, oktaUnderscore.extend({}, options, {\n      unset: true\n    }));\n  },\n\n  /**\n   * @private\n   */\n  _setSynced: function (newModel) {\n    this._syncedData = newModel && oktaUnderscore.isFunction(newModel.toJSON) ? newModel.toJSON() : {};\n  },\n\n  /**\n   * @private\n   */\n  _getSynced: function () {\n    return this._syncedData;\n  },\n  isSynced: function () {\n    return oktaUnderscore.isEqual(this._getSynced(), this.toJSON());\n  }\n};\nconst statics =\n/** @lends module:Okta.BaseModel.prototype */\n{\n  /**\n   * @static\n   *\n   * Example:\n   *\n   * ```javascript\n   * var Model = BaseModel.extend({\n   *   defaults: {\n   *     name: BaseModel.ComputedProperty(['fname', 'lname'], function (fname, lname) {\n   *       return fname + ' ' + lname;\n   *     })\n   *   }\n   * });\n   * var model = new Model({fname: 'Joe', lname: 'Doe'});\n   * model.get('name'); // Joe Doe\n   * model.toJSON(); // {fname: 'Joe', lname: 'Doe'}\n   * ```\n   *\n   * @param {Array} attributes (optional) - an array of the attribute names this method depends on\n   * @param {Function} callback the function that computes the value of the property\n   *\n   * @deprecated Use {@link #derived} instead\n   */\n  ComputedProperty: function (attributes, fn) {\n    // First parameter is optional\n    if (!fn && typeof attributes === 'function') {\n      fn = attributes;\n    } else {\n      fn.__attributes = attributes;\n    }\n\n    return fn;\n  }\n};\n/**\n * @class module:Okta.BaseModel\n * @extends module:Okta.Model\n * @deprecated Use {@link module:Okta.Model|Okta.Model} instead\n * @example\n * var Model = BaseModel.extend({\n *   defaults: {\n *     name: BaseModel.ComputedProperty(['fname', 'lname'], function (fname, lname) {\n *       return fname + ' ' + lname;\n *     })\n *   }\n * });\n * var model = new Model({fname: 'Joe', lname: 'Doe'});\n * model.get('name'); //=> \"Joe Doe\"\n * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n *\n * model.set('__private__', 'private property');\n * model.get('__private__'); //=> \"private property\"\n * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n */\n\nvar BaseModel = Model.extend(props, statics);\n\nexport { BaseModel as default };\n"],"names":["hasProps","model","local","oktaUnderscore","omit","keys","_builtInLocalProps","size","props","flat","constructor","Model","apply","arguments","on","_setSynced","allows","prototype","set","key","val","attrs","each","fn","attr","isArray","__attributes","join","get","computedProperties","trigger","value","isFunction","map","toJSON","options","res","verbose","test","sanitizeAttributes","attributes","reset","clear","defaults","extend","unset","newModel","_syncedData","_getSynced","isSynced","isEqual","statics","ComputedProperty","BaseModel"],"mappings":"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"}
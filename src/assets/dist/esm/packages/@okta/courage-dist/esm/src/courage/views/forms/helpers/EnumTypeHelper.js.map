{"version":3,"file":"EnumTypeHelper.js","sources":["../../../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/views/forms/helpers/EnumTypeHelper.js"],"sourcesContent":["import oktaJQueryStatic from '../../../util/jquery-wrapper.js';\nimport oktaUnderscore from '../../../util/underscore-wrapper.js';\nimport SchemaUtils from '../../../util/SchemaUtil.js';\nimport StringUtil from '../../../util/StringUtil.js';\n\n/* eslint max-statements: 0 */\nconst NAME = 'name';\nconst ENUM_KEY_PREFIX = '_enum_';\n/**\n * Generate Input Options in order to create an input in an Form for Enum type attribute.\n * @param {Object} config informations for creating input options\n *   config.name        schema property name\n *   config.title       schema property title\n *   config.readOnly    create an read only input?\n *   config.explain     sub-title to the input\n *   config.enumValues  list of enum values for creating input options (Dropdown/SimpleCheckBoxSet)\n *   config.displayType display type of schema property\n *\n * @return {Object} inputOptions options for create an Input view. (Dropdown/SimpleCheckBoxSet)\n *\n */\n\nfunction getEnumInputOptions(config) {\n  const enumOneOf = convertToOneOf(config.enumValues);\n  const inputOptions = {\n    name: config.name,\n    label: config.title,\n    readOnly: config.readOnly,\n    customExplain: config.explain,\n    params: {\n      enumOneOf: enumOneOf\n    },\n    options: getDropdownOptionsFromOneOf(enumOneOf)\n  }; // input type\n\n  if (SchemaUtils.isArrayDataType(config.displayType)) {\n    inputOptions.type = 'checkboxset';\n    inputOptions.to = valuesToEnumObjects;\n    inputOptions.from = enumObjectsToValues;\n  } else {\n    inputOptions.type = 'select';\n    inputOptions.to = valueToEnumObject;\n    inputOptions.from = enumObjectToValue;\n  }\n\n  inputOptions.input = null;\n  return inputOptions;\n}\n\nfunction getDropdownOptions(values) {\n  return oktaUnderscore.isArray(values) ? getDropdownOptionsFromOneOf(convertToOneOf(values)) : {};\n}\n\nfunction getDropdownOptionsFromOneOf(values) {\n  if (!isOneOfEnumObject(values)) {\n    return {};\n  }\n\n  return oktaUnderscore.reduce(values, function (options, value, index) {\n    options[convertIndexToEnumIndex(index)] = value.title;\n    return options;\n  }, {});\n}\n\nfunction convertToOneOf(values) {\n  // assume this is a legacy enum array and convert to oneOf object\n  if (!oktaUnderscore.all(values, oktaJQueryStatic.isPlainObject)) {\n    return convertEnumToOneOf(values); // we assume object without const and title is an enum object which need special conversion\n  } else if (!isOneOfEnumObject(values)) {\n    return convertEnumObjectToOneOf(values);\n  }\n\n  return values;\n}\n\nfunction isOneOfEnumObject(values) {\n  return oktaUnderscore.isArray(values) && oktaUnderscore.all(values, function (value) {\n    return oktaUnderscore.has(value, 'const') && oktaUnderscore.has(value, 'title');\n  });\n}\n\nfunction convertEnumToOneOf(values) {\n  return oktaUnderscore.map(values, function (value) {\n    return {\n      const: value,\n      title: valueToTitle(value)\n    };\n  });\n}\n\nfunction valueToTitle(value) {\n  if (oktaUnderscore.isObject(value)) {\n    return JSON.stringify(value);\n  }\n\n  if (oktaUnderscore.isNumber(value)) {\n    return value + '';\n  }\n\n  return value;\n}\n\nfunction convertEnumObjectToOneOf(values) {\n  const findKey = oktaUnderscore.partial(oktaUnderscore.has, oktaUnderscore, NAME); // If all object found the key NAME, use the NAME's value as display name\n\n\n  if (oktaUnderscore.all(values, findKey)) {\n    return oktaUnderscore.chain(values).filter(function (value) {\n      return oktaJQueryStatic.isPlainObject(value) && oktaUnderscore.has(value, NAME);\n    }).map(function (value) {\n      return {\n        const: value,\n        title: value[NAME]\n      };\n    }).value();\n  } // Assume a legacy object array does not need special handling and just convert to const/title enum\n\n\n  return convertEnumToOneOf(values);\n}\n\nfunction convertIndexToEnumIndex(index) {\n  return `${ENUM_KEY_PREFIX}${index}`;\n}\n\nfunction enumObjectToValue(obj) {\n  const index = oktaUnderscore.findIndex(this.options.params.enumOneOf, function (oneOfObj) {\n    return oktaUnderscore.isObject(obj) ? oktaUnderscore.isEqual(oneOfObj.const, obj) : oneOfObj.const === obj;\n  }); // Cannot rely on comparator in findIndex when compare objects so need special handling\n\n\n  return index > -1 ? convertIndexToEnumIndex(index) : obj;\n}\n\nfunction valueToEnumObject(val) {\n  if (!oktaUnderscore.isString(val) || val.indexOf(ENUM_KEY_PREFIX) !== 0) {\n    return val;\n  }\n\n  const index = val.replace(ENUM_KEY_PREFIX, '');\n  const enumValue = this.options.params && oktaUnderscore.isArray(this.options.params.enumOneOf) ? this.options.params.enumOneOf[index] : null; // @see `getEnumInputOptions` how enumValues has been set.\n\n  return oktaUnderscore.has(enumValue, 'const') ? enumValue.const : enumValue;\n}\n\nfunction valuesToEnumObjects(values) {\n  return oktaUnderscore.map(values, valueToEnumObject.bind(this));\n}\n\nfunction enumObjectsToValues(values) {\n  return oktaUnderscore.map(values, enumObjectToValue.bind(this));\n}\n\nfunction isStringConstraint(value) {\n  return oktaUnderscore.isString(value) && oktaJQueryStatic.trim(value) !== '';\n}\n\nfunction isNumberConstraint(value) {\n  return oktaUnderscore.isNumber(value) || oktaUnderscore.isNumber(StringUtil.parseFloat(oktaJQueryStatic.trim(value)));\n}\n\nfunction isIntegerConstraint(value) {\n  const integer = oktaUnderscore.isNumber(value) ? value : StringUtil.parseInt(oktaJQueryStatic.trim(value));\n  return typeof integer === 'number' && isFinite(integer) && Math.floor(integer) === integer;\n}\n\nfunction isObjectConstraint(value) {\n  if (oktaUnderscore.isObject(value) && !oktaUnderscore.isArray(value)) {\n    return true;\n  }\n\n  const object = StringUtil.parseObject(oktaJQueryStatic.trim(value));\n  return oktaUnderscore.isObject(object) && !oktaUnderscore.isArray(object);\n}\n\nfunction isConstraintValueMatchType(value, type) {\n  switch (type) {\n    case SchemaUtils.STRING:\n      return isStringConstraint(value);\n\n    case SchemaUtils.NUMBER:\n      return isNumberConstraint(value);\n\n    case SchemaUtils.INTEGER:\n      return isIntegerConstraint(value);\n\n    case SchemaUtils.OBJECT:\n      return isObjectConstraint(value);\n  }\n}\n\nvar EnumTypeHelper = {\n  getEnumInputOptions: getEnumInputOptions,\n  getDropdownOptions: getDropdownOptions,\n  convertToOneOf: convertToOneOf,\n  isConstraintValueMatchType: isConstraintValueMatchType\n};\n\nexport { EnumTypeHelper as default };\n"],"names":["NAME","ENUM_KEY_PREFIX","getEnumInputOptions","config","enumOneOf","convertToOneOf","enumValues","inputOptions","name","label","title","readOnly","customExplain","explain","params","options","getDropdownOptionsFromOneOf","SchemaUtils","isArrayDataType","displayType","type","to","valuesToEnumObjects","from","enumObjectsToValues","valueToEnumObject","enumObjectToValue","input","getDropdownOptions","values","oktaUnderscore","isArray","isOneOfEnumObject","reduce","value","index","convertIndexToEnumIndex","all","oktaJQueryStatic","isPlainObject","convertEnumToOneOf","convertEnumObjectToOneOf","has","map","const","valueToTitle","isObject","JSON","stringify","isNumber","findKey","partial","chain","filter","obj","findIndex","oneOfObj","isEqual","val","isString","indexOf","replace","enumValue","bind","isStringConstraint","trim","isNumberConstraint","StringUtil","parseFloat","isIntegerConstraint","integer","parseInt","isFinite","Math","floor","isObjectConstraint","object","parseObject","isConstraintValueMatchType","STRING","NUMBER","INTEGER","OBJECT","EnumTypeHelper"],"mappings":"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"}
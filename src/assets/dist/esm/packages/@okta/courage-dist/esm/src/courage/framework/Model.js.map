{"version":3,"file":"Model.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/framework/Model.js"],"sourcesContent":["import oktaUnderscore from '../util/underscore-wrapper.js';\nimport Backbone from '../vendor/lib/backbone.js';\nimport Logger from '../util/Logger.js';\n\nfunction isModelPropertySchema(obj) {\n  return obj && obj.type || obj.deps;\n}\n\n/**\n   * Archer.Model is a standard [Backbone.Model](http://backbonejs.org/#Model) with a few additions:\n   *\n   * - {@link src/framework/Model#derived Derived properties}\n   * - {@link src/framework/Model#props Built in schema validation}\n   * - {@link src/framework/Model#local Private properties (with schema validation)}\n   * - {@link src/framework/Model#flat Flattening of nested objects}\n   *\n   * Both derived and private properties are filtered out when sending the data to the server.\n   *\n   * See [Backbone.Model](http://backbonejs.org/#Model-constructor).\n   *\n   * @class src/framework/Model\n   * @extends external:Backbone.Model\n   * @param {Object} [attributes] - Initial model attributes (data)\n   * @param {Object} [options] - Options hash\n   * @example\n   * var Person = Archer.Model.extend({\n   *   props: {\n   *     'fname': 'string',\n   *     'lname': 'string'\n   *   },\n   *   local: {\n   *     isLoggedIn: 'boolean'\n   *   },\n   *   derived: {\n   *     name: {\n   *       deps: ['fname', 'lname'],\n   *       fn: function (fname, lname) {\n   *         return fname + ' ' + lname;\n   *       }\n   *     }\n   *   }\n   * });\n   * var model = new Person({fname: 'Joe', lname: 'Doe'});\n   * model.get('name'); //=> \"Joe Doe\"\n   * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n   *\n   * model.set('isLoggedIn', true);\n   * model.get('isLoggedIn'); //=> true\n   * model.toJSON(); //=> {fname: 'Joe', lname: 'Doe'}\n   */\nlet Model;\nconst statics = {\n  ERROR_BLANK: 'model.validation.field.blank',\n  ERROR_WRONG_TYPE: 'model.validation.field.wrong.type',\n  ERROR_NOT_ALLOWED: 'model.validation.field.value.not.allowed',\n  ERROR_INVALID: 'model.validation.field.invalid',\n  ERROR_IARRAY_UNIQUE: 'model.validation.field.array.unique',\n  ERROR_INVALID_FORMAT_EMAIL: 'model.validation.field.invalid.format.email',\n  ERROR_INVALID_FORMAT_URI: 'model.validation.field.invalid.format.uri',\n  ERROR_INVALID_FORMAT_IPV4: 'model.validation.field.invalid.format.ipv4',\n  ERROR_INVALID_FORMAT_HOSTNAME: 'model.validation.field.invalid.format.hostname',\n  ERROR_STRING_STRING_MIN_LENGTH: 'model.validation.field.string.minLength',\n  ERROR_STRING_STRING_MAX_LENGTH: 'model.validation.field.string.maxLength'\n};\n\nfunction flatten(value, objectTypeFields, key, target) {\n  var filter = oktaUnderscore.contains(objectTypeFields, key);\n\n  target || (target = {});\n\n  if (!filter && oktaUnderscore.isObject(value) && !oktaUnderscore.isArray(value) && !oktaUnderscore.isFunction(value)) {\n    oktaUnderscore.each(value, function (val, i) {\n      flatten(val, objectTypeFields, key ? key + '.' + i : i, target);\n    });\n  } // Case where target is an empty object. Guard against returning {undefined: undefined}.\n  else if (key !== undefined) {\n    target[key] = value;\n  }\n\n  return target;\n}\n\nfunction unflatten(data) {\n  oktaUnderscore.each(data, function (value, key, data) {\n    if (key.indexOf('.') === -1) {\n      return;\n    }\n\n    var part;\n    var ref = data;\n    var parts = key.split('.');\n\n    while ((part = parts.shift()) !== undefined) {\n      if (!ref[part]) {\n        ref[part] = parts.length ? {} : value;\n      }\n\n      ref = ref[part];\n    }\n\n    delete data[key];\n  });\n\n  return data;\n}\n\nfunction createMessage(field, msg) {\n  var obj = {};\n  obj[field.name] = msg;\n  return obj;\n}\n\nfunction normalizeSchemaDef(field, name) {\n  var target;\n\n  if (oktaUnderscore.isString(field)) {\n    target = {\n      type: field\n    };\n  } else if (oktaUnderscore.isArray(field)) {\n    target = {\n      type: field[0],\n      required: field[1],\n      value: field[2]\n    };\n  } else {\n    target = oktaUnderscore.clone(field);\n  }\n\n  oktaUnderscore.defaults(target, {\n    required: false,\n    name: name\n  });\n\n  return target;\n}\n\nfunction capitalize(string) {\n  return string.toLowerCase().replace(/\\b[a-z]/g, function (letter) {\n    return letter.toUpperCase();\n  });\n}\n\nfunction _validateRegex(value, pattern, error) {\n  if (!pattern.test(value)) {\n    return error;\n  }\n}\n\nvar StringFormatValidators = {\n  /*eslint max-len: 0 */\n  email: function (value) {\n    // Taken from  http://emailregex.com/ on 2017-03-06.\n    var pattern = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_EMAIL);\n  },\n  uri: function (value) {\n    // source: https://mathiasbynens.be/demo/url-regex\n    var pattern = /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_URI);\n  },\n  ipv4: function (value) {\n    // source: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9780596802837/ch07s16.html\n    var pattern = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_IPV4);\n  },\n  hostname: function (value) {\n    // source: http://www.regextester.com/23\n    var pattern = /^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/;\n    return _validateRegex(value, pattern, Model.ERROR_INVALID_FORMAT_HOSTNAME);\n  }\n};\n\nfunction validateStringFormat(field, value) {\n  var validator = StringFormatValidators[field.format];\n\n  if (field.format && !validator) {\n    throw new TypeError(field.format + ' is not a supported string format');\n  }\n\n  return validator && validator(value);\n}\n\nfunction validateString(field, value) {\n  var createMessageWith = oktaUnderscore.partial(createMessage, field);\n\n  var invalidFormat = validateStringFormat(field, value);\n\n  if (invalidFormat) {\n    return createMessageWith(invalidFormat);\n  }\n\n  if (value && field.minLength && value.length < field.minLength) {\n    return createMessageWith(Model.ERROR_STRING_STRING_MIN_LENGTH);\n  }\n\n  if (value && field.maxLength && value.length > field.maxLength) {\n    return createMessageWith(Model.ERROR_STRING_STRING_MAX_LENGTH);\n  }\n}\n\nfunction validateField(field, value) {\n  /* eslint complexity: [2, 25], max-statements: [2, 30] */\n  var createMessageWith = oktaUnderscore.partial(createMessage, field);\n\n  var isDefined = !oktaUnderscore.isUndefined(value) && !oktaUnderscore.isNull(value);\n  var checkType;\n  var errorMessage; // If using an array validator, perform the validation\n\n  if (Array.isArray(field.validate)) {\n    const output = [];\n    let foundError = false;\n    let result;\n    field.validate.forEach(item => {\n      if (!value) {\n        result = false;\n      } else {\n        switch (item.type.toLowerCase()) {\n          case 'regex':\n            result = new RegExp(item.value.pattern, item.value.flags || '').test(value);\n            break;\n\n          default:\n            result = false;\n        }\n      } // Append the result.\n\n\n      foundError = foundError || !result;\n      output.push({\n        // eslint-disable-next-line no-prototype-builtins\n        message: item.hasOwnProperty('message') ? item.message : '',\n        passed: result\n      });\n    });\n\n    if (foundError) {\n      return createMessageWith(output);\n    }\n\n    return;\n  } // check required fields\n\n\n  if (field.required && (!isDefined || oktaUnderscore.isNull(value) || value === '')) {\n    return createMessageWith(Model.ERROR_BLANK);\n  } // check type\n\n\n  checkType = oktaUnderscore['is' + capitalize(field.type)];\n\n  if (isDefined && field.type !== 'any' && (!oktaUnderscore.isFunction(checkType) || !checkType(value))) {\n    return createMessageWith(Model.ERROR_WRONG_TYPE);\n  } // validate string format\n\n\n  if (value && field.type === 'string') {\n    var error = validateString(field, value);\n\n    if (error) {\n      return error;\n    }\n  } // check pre set values (enum)\n\n\n  if (isDefined && field.values && !oktaUnderscore.contains(field.values, value)) {\n    return createMessageWith(Model.ERROR_NOT_ALLOWED);\n  } // check validate method\n\n\n  if (oktaUnderscore.isFunction(field.validate)) {\n    var result = field.validate(value);\n\n    if (oktaUnderscore.isString(result) && result) {\n      return createMessageWith(result);\n    } else if (result === false) {\n      return createMessageWith(Model.ERROR_INVALID);\n    }\n  } // check array items\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n\n  if (isDefined && field.type === 'array' && (errorMessage = validateArrayField(field, value))) {\n    return createMessageWith(errorMessage);\n  }\n}\n\nfunction validateArrayField(field, arr) {\n  if (field.minItems && arr.length < field.minItems) {\n    return 'model.validation.field.array.minItems';\n  } else if (field.maxItems && arr.length > field.maxItems) {\n    return 'model.validation.field.array.maxItems';\n  } else if (field.uniqueItems && arr.length > oktaUnderscore.uniq(arr).length) {\n    return Model.ERROR_IARRAY_UNIQUE;\n  } else if (field.items) {\n    /* eslint max-depth: [2, 3] */\n    var arrayField = normalizeSchemaDef(field.items, 'placeholder');\n\n    for (var i = 0; i < arr.length; i++) {\n      var value = arr[i];\n      var error = validateField(arrayField, value);\n\n      if (error) {\n        return error['placeholder'];\n      }\n    }\n  }\n}\n\nconst props =\n/** @lends src/framework/Model.prototype */\n{\n  /**\n     * Pass props as an object to extend, describing the observable properties of your model. The props\n     * properties should not be set on an instance, as this won't define new properties, they should only be passed to\n     * extend.\n     * Properties can be defined in three different ways:\n     *\n     * - As a string with the expected dataType. One of string, number, boolean, array, object, date, or any.\n     * Eg: `name: 'string'`.\n     * - An array of `[dataType, required, default]`\n     * - An object `{type: 'string', format: '', required: true, value: '', values: [], validate: function() {}`\n     *   - `value` will be the value that the property will be set to if it is undefined, either by not being set during\n     *   initialization, or by being explicitly set to undefined.\n     *   - `format` is a json-schame derived string format. Supported formats are: `email`, `uri`, `hostname` and `ipv4`.\n     *   - If `required` is true, one of two things will happen. If a default is set for the property, the property will\n     *   start with that value. If a default is not set for the property, validation will fail\n     *   - If `values` array is passed, then you'll be able to change a property to one of those values only.\n     *   - If `validate` is defined, it should return false or a custom message string when the validation fails.\n     *   - If the type is defined as `array`, the array elements could be defined by `minItems` (Number),\n     *   `uniqueItems` (Boolean) and `items` (a field definition such as this one that will validate each array member)\n     *   To the `validate` method\n     *   - Trying to set a property to an invalid type will raise an exception.\n     *\n     * @type {Mixed|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     name: 'string',\n     *     age: 'number',\n     *     paying: ['boolean', true, false], //required attribute, defaulted to false\n     *     type: {\n     *       type: 'string',\n     *       values: ['regular-hero', 'super-hero', 'mega-hero']\n     *     },\n     *     likes: {\n     *       type: 'string',\n     *       validate: function (value) {\n     *         return /^[\\w]+ing$/.test(value)\n     *       }\n     *     }\n     *   }\n     * });\n     */\n  props: {},\n\n  /**\n     * Derived properties (also known as computed properties) are properties of the model that depend on the\n     * other (props, local or even derived properties to determine their value. Best demonstrated with an example:\n     *\n     * Each derived property, is defined as an object with the current properties:\n     *\n     * - `deps` {Array} - An array of property names which the derived property depends on.\n     * - `fn` {Function} - A function which returns the value of the computed property. It is called in the context of\n     * the current object, so that this is set correctly.\n     * - `cache` {Boolean} -  - Whether to cache the property. Uncached properties are computed every time they are\n     * accessed. Useful if it depends on the current time for example. Defaults to `true`.\n     *\n     * Derived properties are retrieved and fire change events just like any other property. They cannot be set\n     * directly.\n     * @type {Object|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     firstName: 'string',\n     *     lastName: 'string'\n     *   },\n     *   derived: {\n     *     fullName: {\n     *       deps: ['firstName', 'lastName'],\n     *       fn: function (firstName, lastName) {\n     *         return firstName + ' ' + lastName;\n     *       }\n     *     }\n     *   }\n     * });\n     *\n     * var person = new Person({ firstName: 'Phil', lastName: 'Roberts' })\n     * console.log(person.get('fullName')) //=> \"Phil Roberts\"\n     *\n     * person.set('firstName', 'Bob');\n     * console.log(person.get('fullName')) //=> \"Bob Roberts\"\n     */\n  derived: {},\n\n  /**\n     * local properties are defined and work in exactly the same way as {@link src/framework/Model#props|props}, but generally only exist for\n     * the lifetime of the page.\n     * They would not typically be persisted to the server, and are not returned by calls to {@link src/framework/Model#toJSON|toJSON}.\n     *\n     * @type {Object|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     name: 'string',\n     *   },\n     *   local: {\n     *     isLoggedIn: 'boolean'\n     *   }\n     * );\n     */\n  local: {},\n\n  /**\n     * Flatten the payload into dot notation string keys:\n     *\n     * @type {Boolean|Function}\n     * @example\n     * var Person = Model.extend({\n     *   props: {\n     *     'profile.fname': 'string',\n     *     'profile.lname': 'string',\n     *     'profile.languages': 'object'\n     *   },\n     *   flat: true\n     * });\n     * var person = new Person({'profile': {\n     *                            'fname': 'John',\n     *                            'lname': 'Doe',\n     *                            'languages': {name: \"English\", value: \"EN\"}\n     *                         }}, {parse: true});\n     * person.get('profile'); //=> undefined\n     * person.get('profile.fname'); //=> 'John'\n     * person.get('profile.lname'); //=> 'Doe'\n     * person.get('profile.languages'); //=> {name: \"English\", value: \"EN\"}\n     * person.get('profile.languages.name'); //=> undefined\n     * person.toJSON(); //=> {'profile': {'fname': 'John'} }\n     */\n  flat: true,\n\n  /**\n     * @deprecated\n     * @alias Backbone.Model#defaults\n     */\n  defaults: {},\n  // FIXME: preinitialize takes parameter `attributes` and `options`, which inherit from constructor.\n  preinitialize: function (options, ...rest) {\n    this.options = options || {};\n    var schema = this['__schema__'] = {};\n    var objectTypeFields = [];\n    schema.computedProperties = {};\n    schema.props = oktaUnderscore.clone(oktaUnderscore.result(this, 'props') || {});\n    schema.derived = oktaUnderscore.clone(oktaUnderscore.result(this, 'derived') || {});\n    schema.local = oktaUnderscore.clone(oktaUnderscore.result(this, 'local') || {});\n    var defaults = {};\n\n    oktaUnderscore.each(oktaUnderscore.extend({}, schema.props, schema.local), function (options, name) {\n      var schemaDef = normalizeSchemaDef(options, name);\n\n      if (!oktaUnderscore.isUndefined(schemaDef.value)) {\n        defaults[name] = schemaDef.value;\n      }\n\n      if (schemaDef.type === 'object') {\n        objectTypeFields.push(name);\n      }\n    }, this);\n\n    if (oktaUnderscore.size(defaults)) {\n      var localDefaults = oktaUnderscore.result(this, 'defaults');\n\n      this.defaults = function () {\n        return oktaUnderscore.defaults({}, defaults, localDefaults);\n      };\n    } // override `validate`\n\n\n    this.validate = oktaUnderscore.wrap(this.validate, function (validate) {\n      var args = oktaUnderscore.rest(arguments);\n\n      var res = oktaUnderscore.extend(this._validateSchema.apply(this, args), validate.apply(this, args));\n\n      return oktaUnderscore.size(res) && res || undefined;\n    }); // override `parse`\n\n    this.parse = oktaUnderscore.wrap(this.parse, function (parse) {\n      var target = parse.apply(this, oktaUnderscore.rest(arguments));\n\n      if (oktaUnderscore.result(this, 'flat')) {\n        target = flatten(target, objectTypeFields);\n      }\n\n      return target;\n    });\n    Backbone.Model.prototype.preinitialize.call(this, options, ...rest);\n  },\n  // FIXME:\n  // constructor takes parameter `attributes` and `options`.\n  constructor: function () {\n    Backbone.Model.apply(this, arguments);\n    var schema = this['__schema__'];\n\n    oktaUnderscore.each(schema.derived, function (options, name) {\n      schema.computedProperties[name] = this.__getDerivedValue(name); // set initial value;\n\n      var deps = isModelPropertySchema(options) ? options.deps || [] : [];\n\n      if (deps.length) {\n        this.on('cache:clear change:' + deps.join(' change:'), function () {\n          var value = this.__getDerivedValue(name);\n\n          if (value !== schema.computedProperties[name]) {\n            schema.computedProperties[name] = value;\n            this.trigger('change:' + name, this, value);\n          }\n        }, this);\n      }\n    }, this);\n\n    this.on('sync', function () {\n      this.__syncedData = this.toJSON();\n    }, this);\n  },\n  validate: function () {},\n\n  /**\n     * Check if the schema settings allow this field to exist in the model\n     * @param  {String} key\n     * @return {Boolean}\n     */\n  allows: function (key) {\n    var schema = this['__schema__'];\n\n    var all = oktaUnderscore.extend({}, schema.props, schema.local);\n\n    if (!oktaUnderscore.has(all, key)) {\n      Logger.warn('Field not defined in schema', key);\n    }\n\n    return true;\n  },\n\n  /**\n     * Returns the schema for the specific property\n     *\n     * @param propName - The name of the property\n     * @returns {*} | null\n     */\n  getPropertySchema: function (propName) {\n    var schema = this['__schema__'];\n    return oktaUnderscore.reduce([schema.props, schema.local], function (result, options) {\n      return result || normalizeSchemaDef(options[propName], propName);\n    }, null);\n  },\n  set: function (key, val) {\n    var attrs;\n\n    if (typeof key === 'object') {\n      attrs = key;\n    } else {\n      (attrs = {})[key] = val;\n    } // Don't override a computed properties\n\n\n    oktaUnderscore.each(attrs, function (value, key) {\n      if (oktaUnderscore.has(this['__schema__'].derived, key)) {\n        throw new Error(`overriding derived properties is not supported: ${key}`);\n      }\n    }, this); // Schema validation\n\n\n    var errorFields = [];\n\n    oktaUnderscore.each(attrs, function (value, key) {\n      this.allows(key) || errorFields.push(key);\n    }, this);\n\n    if (errorFields.length) {\n      throw new Error(`field not allowed: ${errorFields.join(', ')}`);\n    }\n\n    return Backbone.Model.prototype.set.apply(this, arguments);\n  },\n  get: function (attr) {\n    var schema = this['__schema__'];\n\n    if (oktaUnderscore.has(schema.derived, attr)) {\n      if (schema.derived[attr].cache !== false) {\n        return schema.computedProperties[attr];\n      } else {\n        return this.__getDerivedValue(attr);\n      }\n    }\n\n    return Backbone.Model.prototype.get.apply(this, arguments);\n  },\n\n  /**\n     * Return a shallow copy of the model's attributes for JSON stringification.\n     * This can be used for persistence, serialization, or for augmentation before being sent to the server.\n     * The name of this method is a bit confusing, as it doesn't actually return a JSON string â€”\n     * but I'm afraid that it's the way that the JavaScript API for JSON.stringify works.\n     *\n     * See [Backbone.Model.toJSON](http://backbonejs.org/#Model-toJSON)\n     *\n     * @param  {Object} options\n     * @return {Object}\n     * @example\n     * var artist = new Model({\n     *   firstName: 'Wassily',\n     *   lastName: 'Kandinsky'\n     * });\n     *\n     * artist.set({birthday: 'December 16, 1866'});\n     * JSON.stringify(artist); //=> {'firstName':'Wassily','lastName':'Kandinsky','birthday':'December 16, 1866'}\n     */\n  toJSON: function (options) {\n    options || (options = {});\n\n    var res = oktaUnderscore.clone(Backbone.Model.prototype.toJSON.apply(this, arguments));\n\n    var schema = this['__schema__']; // cleanup local properties\n\n    if (!options.verbose) {\n      res = oktaUnderscore.omit(res, oktaUnderscore.keys(schema.local));\n    } else {\n      // add derived properties\n      oktaUnderscore.each(schema.derived, function (options, name) {\n        res[name] = this.get(name);\n      }, this);\n    }\n\n    if (this.flat) {\n      res = unflatten(res);\n    }\n\n    return res;\n  },\n\n  /**\n     * Removes all attributes from the model, including the id attribute.\n     * Fires a `\"change\"` event unless `silent` is passed as an option.\n     * Sets the default values to the model\n     * @param {Object} [options]\n     */\n  reset: function (options) {\n    this.clear(options);\n    this.set(oktaUnderscore.result(this, 'defaults'), options);\n  },\n\n  /**\n     * Is the data on the model has local modifications since the last sync event?\n     * @return {Boolean} is the model in sync with the server\n     */\n  isSynced: function () {\n    return oktaUnderscore.isEqual(this.__syncedData, this.toJSON());\n  },\n\n  /**\n     * validate a specific field in the model.\n     * @param  {String} key\n     * @return {Object} returns `{fieldName: errorMessage}` if invalid, otherwise undefined.\n     * @readonly\n     */\n  validateField: function (key) {\n    var schema = key && this.getPropertySchema(key);\n    return schema && validateField(schema, this.get(key));\n  },\n\n  /**\n     * Runs local schema validation. Invoked internally by {@link src/framework/Model#validate|validate}.\n     * @return {Object}\n     * @protected\n     */\n  _validateSchema: function () {\n    var schema = this['__schema__'];\n    return oktaUnderscore.reduce(oktaUnderscore.extend({}, schema.props, schema.local), function (memo, options, name) {\n      return oktaUnderscore.extend(memo, this.validateField(name) || {});\n    }, {}, this);\n  },\n  __getDerivedValue: function (name) {\n    var options = this['__schema__'].derived[name];\n\n    if (oktaUnderscore.isString(options)) {\n      var key = options;\n      options = {\n        deps: [key],\n        fn: function () {\n          return this.get(key);\n        }\n      };\n    }\n\n    var deps = options.deps || [];\n    return options.fn.apply(this, oktaUnderscore.map(deps, this.get, this));\n  }\n};\nModel = Backbone.Model.extend(props, statics);\n/**\n * It's used for distinguishing the ambiguity from _.isFunction()\n * which returns True for both a JavaScript Class constructor function\n * and normal function. With this flag, we can tell a function is actually\n * a Model Class.\n * This flag is added in order to support the type of a parameter can be\n * either a Class or pure function that returns a Class.\n */\n\nModel.isCourageModel = true;\nvar FrameworkModel = Model;\n\nexport { FrameworkModel as default, isModelPropertySchema };\n"],"names":["isModelPropertySchema","obj","type","deps","Model","statics","ERROR_BLANK","ERROR_WRONG_TYPE","ERROR_NOT_ALLOWED","ERROR_INVALID","ERROR_IARRAY_UNIQUE","ERROR_INVALID_FORMAT_EMAIL","ERROR_INVALID_FORMAT_URI","ERROR_INVALID_FORMAT_IPV4","ERROR_INVALID_FORMAT_HOSTNAME","ERROR_STRING_STRING_MIN_LENGTH","ERROR_STRING_STRING_MAX_LENGTH","flatten","value","objectTypeFields","key","target","filter","oktaUnderscore","contains","isObject","isArray","isFunction","each","val","i","undefined","unflatten","data","indexOf","part","ref","parts","split","shift","length","createMessage","field","msg","name","normalizeSchemaDef","isString","required","clone","defaults","capitalize","string","toLowerCase","replace","letter","toUpperCase","_validateRegex","pattern","error","test","StringFormatValidators","email","uri","ipv4","hostname","validateStringFormat","validator","format","TypeError","validateString","createMessageWith","partial","invalidFormat","minLength","maxLength","validateField","isDefined","isUndefined","isNull","checkType","errorMessage","Array","validate","output","foundError","result","forEach","item","RegExp","flags","push","message","hasOwnProperty","passed","values","validateArrayField","arr","minItems","maxItems","uniqueItems","uniq","items","arrayField","props","derived","local","flat","preinitialize","options","rest","schema","computedProperties","extend","schemaDef","size","localDefaults","wrap","args","arguments","res","_validateSchema","apply","parse","Backbone","prototype","call","constructor","__getDerivedValue","on","join","trigger","__syncedData","toJSON","allows","all","has","getPropertySchema","propName","reduce","set","attrs","Error","errorFields","get","attr","cache","verbose","omit","keys","reset","clear","isSynced","isEqual","memo","fn","map","isCourageModel","FrameworkModel"],"mappings":"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cAAc,CAAC6E,IAAf,CAAoBJ,GAApB,CAAA,CAAyBxD,MAA/D,EAAuE;AAC5E,IAAOpC,OAAAA,KAAK,CAACM,mBAAb,CAAA;AACD,GAFM,MAEA,IAAIgC,KAAK,CAAC2D,KAAV,EAAiB;AACtB;AACA,IAAIC,IAAAA,UAAU,GAAGzD,kBAAkB,CAACH,KAAK,CAAC2D,KAAP,EAAc,aAAd,CAAnC,CAAA;;AAEA,IAAA,KAAK,IAAIvE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkE,GAAG,CAACxD,MAAxB,EAAgCV,CAAC,EAAjC,EAAqC;AACnC,MAAA,IAAIZ,KAAK,GAAG8E,GAAG,CAAClE,CAAD,CAAf,CAAA;AACA,MAAA,IAAI4B,KAAK,GAAGiB,aAAa,CAAC2B,UAAD,EAAapF,KAAb,CAAzB,CAAA;;AAEA,MAAA,IAAIwC,KAAJ,EAAW;AACT,QAAOA,OAAAA,KAAK,CAAC,aAAD,CAAZ,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AACF,CAAA;;AAED,MAAM6C,KAAK;AACX;AACA;AACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEA,EAAAA,KAAK,EAAE,EA3CT;;AA6CE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,OAAO,EAAE,EAlFX;;AAoFE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,KAAK,EAAE,EApGT;;AAsGE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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"}
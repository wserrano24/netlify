{"version":3,"file":"BaseController.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/util/BaseController.js"],"sourcesContent":["import oktaJQueryStatic from './jquery-wrapper.js';\nimport oktaUnderscore from './underscore-wrapper.js';\nimport BaseRouter from './BaseRouter.js';\nimport SettingsModel from './SettingsModel.js';\nimport StateMachine from './StateMachine.js';\nimport BaseView from '../views/BaseView.js';\n\nfunction clean(obj) {\n  const res = {};\n\n  oktaUnderscore.each(obj, function (value, key) {\n    if (!oktaUnderscore.isNull(value)) {\n      res[key] = value;\n    }\n  });\n\n  return res;\n}\n\nconst proto =\n/** @lends module:Okta.Controller.prototype */\n{\n  preinitialize: function (options = {}) {\n    // If 'state' is passed down as options, use it, else create a 'new StateMachine()'\n    this.state = oktaUnderscore.result(this, 'state');\n    const hasStateBeenInitialized = this.state instanceof StateMachine || options.state instanceof StateMachine;\n\n    if (!hasStateBeenInitialized) {\n      const stateData = oktaUnderscore.defaults(clean(options.state), this.state || {}); // TODO:\n      // `framework/View.js set `this.state = options.state.`.\n      // Therefore we could consider to do\n      // 1. `options.state = new StateMachine()`\n      // 2. remove `delete options.state`\n\n\n      this.state = new StateMachine(stateData);\n      delete options.state;\n    }\n\n    if (!options.settings) {\n      // allow the controller to live without a router\n      options.settings = new SettingsModel(oktaUnderscore.omit(options || {}, 'el'));\n      this.listen('notification', BaseRouter.prototype._notify);\n      this.listen('confirmation', BaseRouter.prototype._confirm);\n    }\n\n    BaseView.prototype.preinitialize.call(this, options);\n  },\n  constructor: function (options = {}) {\n    BaseView.call(this, options);\n    this.listenTo(this.state, '__invoke__', function () {\n      const args = oktaUnderscore.toArray(arguments);\n\n      const method = args.shift();\n\n      if (oktaUnderscore.isFunction(this[method])) {\n        this[method].apply(this, args);\n      }\n    });\n    let MainView; // if `this.View` is already a Backbone View\n\n    if (this.View && this.View.isCourageView) {\n      MainView = this.View;\n    } // if `this.View` is a pure function that returns a Backbone View\n    else if (oktaUnderscore.result(this, 'View') && oktaUnderscore.result(this, 'View').isCourageView) {\n      MainView = oktaUnderscore.result(this, 'View');\n    }\n\n    if (MainView) {\n      this.add(new MainView(this.toJSON()));\n    }\n  },\n\n  /**\n   * The default values of our application state\n   * @type {Object}\n   * @default {}\n   */\n  state: {},\n\n  /**\n   * The main view this controller operate on\n   * @type {module:Okta.View}\n   * @default null\n   */\n  View: null,\n\n  /**\n   * Renders the {@link module:Okta.Controller#View|main view} after the DOM is ready\n   * in case the controller is the root component of the page (e.g there's no router)\n   */\n  render: function () {\n    const args = arguments;\n    const self = this;\n    oktaJQueryStatic(function () {\n      BaseView.prototype.render.apply(self, args);\n    });\n    return this;\n  },\n\n  /**\n   * Creates the view constructor options\n   * @param {Object} [options] Extra options\n   * @return {Object} The view constructor options\n   */\n  toJSON: function (options) {\n    return oktaUnderscore.extend(oktaUnderscore.pick(this, 'state', 'settings', 'collection', 'model'), options || {});\n  },\n\n  /**\n   * Removes the child views, empty the DOM element and stop listening to events\n   */\n  remove: function () {\n    this.removeChildren();\n    this.stopListening();\n    this.$el.empty();\n    return this;\n  }\n};\n/**\n * A Controller is our application control flow component.\n *\n * Typically it will:\n * - Initialize the models, controller and main views\n * - Listen to events\n * - Create, read, update and delete models\n * - Create modal dialogs, confirmation dialogs and alert dialogs\n * - Control the application flow\n *\n * The constructor is responsible for:\n * - Create the application state object\n * - Assign or creates the application settings object\n * - Create an instance of the main view with the relevant parameters\n *\n * See:\n * [Hello World Tutorial](https://github.com/okta/courage/wiki/Hello-World),\n * [Test Spec](https://github.com/okta/okta-ui/blob/master/packages/courage/test/spec/util/BaseController_spec.js)\n *\n * @class module:Okta.Controller\n * @param {Object} options Options Hash\n * @param {SettingsModel} [options.settings] Application Settings Model\n * @param {String} options.el a jQuery selector string stating where to attach the controller in the DOM\n */\n\nvar BaseController = BaseView.extend(proto);\n\nexport { BaseController as default };\n"],"names":["clean","obj","res","oktaUnderscore","each","value","key","isNull","proto","preinitialize","options","state","result","hasStateBeenInitialized","StateMachine","stateData","defaults","settings","SettingsModel","omit","listen","BaseRouter","prototype","_notify","_confirm","BaseView","call","constructor","listenTo","args","toArray","arguments","method","shift","isFunction","apply","MainView","View","isCourageView","add","toJSON","render","self","oktaJQueryStatic","extend","pick","remove","removeChildren","stopListening","$el","empty","BaseController"],"mappings":"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"}
{"version":3,"file":"BaseRouter.js","sources":["../../../../../../../../../packages/@okta/courage-dist/esm/src/courage/util/BaseRouter.js"],"sourcesContent":["import Backbone from '../vendor/lib/backbone.js';\nimport ConfirmationDialog from '../../empty.js';\nimport oktaJQueryStatic from './jquery-wrapper.js';\nimport oktaUnderscore from './underscore-wrapper.js';\nimport Logger from './Logger.js';\nimport SettingsModel from './SettingsModel.js';\nimport Notification from '../views/components/Notification.js';\n\nfunction getRoute(router, route) {\n  const root = oktaUnderscore.result(router, 'root') || '';\n\n  if (root && oktaUnderscore.isString(route)) {\n    return [root, route].join('/').replace(/\\/{2,}/g, '/');\n  }\n\n  return route;\n}\n/**\n * BaseRouter is a standard [Backbone.Router](http://backbonejs.org/#Router)\n * with a few additions:\n * - Explicit mapping between routes and controllers\n * - Support for rendering notification and confirmation dialogs\n *\n * Checkout the [Hello World Tutorial](https://github.com/okta/courage/wiki/Hello-World)\n * for a step-by-step guide to using this.\n *\n * @class module:Okta.Router\n * @extends external:Backbone.Router\n * @param {Object} options options hash\n * @param {String} options.el a jQuery selector string stating where to attach the controller in the DOM\n */\n\n\nconst props =\n/** @lends module:Okta.Router.prototype */\n{\n  /**\n   * The root URL for the router. When setting {@link http://backbonejs.org/#Router-routes|routes},\n   * it will be prepended to each route.\n   * @type {String|Function}\n   */\n  root: '',\n  listen: Notification.prototype.listen,\n  constructor: function (options = {}) {\n    this.el = options.el;\n    /**\n     * Make sure `this.settings` has been set before invoke super - `Backbone.Router.apply`,\n     * which will invoke `this.initialize`, which could use `this.settings`.\n     *\n     * In theory we can set `this.settings` in `this.initialize` and assume `child.initialize`\n     * will invoke `super.initialize` first. But in reality, `child.initialize` doesn't call\n     * `super.initialize` at all.\n     */\n\n    this.settings = new SettingsModel(oktaUnderscore.omit(options, 'el'));\n\n    if (options.root) {\n      this.root = options.root;\n    }\n\n    Backbone.Router.apply(this, arguments);\n    this.listen('notification', this._notify);\n    this.listen('confirmation', this._confirm);\n  },\n\n  /**\n   * Fires up a confirmation dialog\n   *\n   * @param  {Object} options Options Hash\n   * @param  {String} options.title The title\n   * @param  {Array<string>} buttonOrder The order of the buttons\n   * @param  {String} options.subtitle The explain text\n   * @param  {String} options.save The text for the save button\n   * @param  {Function} options.ok The callback function to run when hitting \"OK\"\n   * @param  {String} options.cancel The text for the cancel button\n   * @param  {Function} options.cancelFn The callback function to run when hitting \"Cancel\"\n   * @param  {Boolean} options.noCancelButton Don't render the cancel button (useful for alert dialogs)\n   * @param  {Boolean} options.noSubmitButton Don't render the primary button (useful for alert dialogs)\n   * @private\n   *\n   * @return {Okta.View} the dialog view\n   */\n  _confirm: function (options = {}) {\n    const Dialog = ConfirmationDialog.extend(oktaUnderscore.pick(options, 'title', 'subtitle', 'save', 'ok', 'cancel', 'cancelFn', 'noCancelButton', 'noSubmitButton', 'content', 'danger', 'type', 'closeOnOverlayClick', 'buttonOrder'));\n    const dialog = new Dialog({\n      model: this.settings\n    }); // The model is here because itsa part of the BaseForm paradigm.\n    // It will be ignored in the context of a confirmation dialog.\n\n    dialog.render();\n    return dialog; // test hook\n  },\n\n  /**\n   * Fires up a notification banner\n   *\n   * @param  {Object} options Options Hash\n   * @return {Okta.View} the notification view\n   * @private\n   */\n  _notify: function (options) {\n    const notification = new Notification(options);\n    oktaJQueryStatic('#content').prepend(notification.render().el);\n    return notification; // test hook\n  },\n\n  /**\n   * Renders a Controller\n   * This will initialize new instance of a controller and call render on it\n   *\n   * @param  {Okta.Controller} Controller The controller Class we which to render\n   * @param  {Object} [options] Extra options to the controller constructor\n   */\n  render: function (Controller, options) {\n    this.unload();\n    options = oktaUnderscore.extend(oktaUnderscore.pick(this, 'settings', 'el'), options || {});\n    this.controller = new Controller(options);\n    this.controller.render();\n  },\n\n  /**\n   * Starts the backbone history object\n   *\n   * Waits for the dom to be ready before calling `Backbone.history.start()` (IE issue).\n   *\n   * See [Backbone History](http://backbonejs.org/#History) for more information.\n   */\n  start: function (...args) {\n    oktaJQueryStatic(function () {\n      if (Backbone.History.started) {\n        Logger.error('History has already been started');\n        return;\n      }\n\n      Backbone.history.start(...args);\n    });\n  },\n\n  /**\n   * Removes active controller and frees up event listeners\n   */\n  unload: function () {\n    if (this.controller) {\n      this.stopListening(this.controller);\n      this.stopListening(this.controller.state);\n      this.controller.remove();\n    }\n  },\n  route: function (route, name, callback) {\n    return Backbone.Router.prototype.route.call(this, getRoute(this, route), name, callback);\n  },\n  navigate: function (fragment, options) {\n    return Backbone.Router.prototype.navigate.call(this, getRoute(this, fragment), options);\n  }\n};\nvar BaseRouter = Backbone.Router.extend(props);\n\nexport { BaseRouter as default };\n"],"names":["getRoute","router","route","root","oktaUnderscore","result","isString","join","replace","props","listen","Notification","prototype","constructor","options","el","settings","SettingsModel","omit","Backbone","Router","apply","arguments","_notify","_confirm","Dialog","ConfirmationDialog","extend","pick","dialog","model","render","notification","oktaJQueryStatic","prepend","Controller","unload","controller","start","args","History","started","Logger","error","history","stopListening","state","remove","name","callback","call","navigate","fragment","BaseRouter"],"mappings":"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"}